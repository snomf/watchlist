<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="icon.png">
    <title>Watchlist</title>
    <meta name="description"
        content="Watchlist lets you and your friends track your progress through your favorite movies and shows together, syncing your watched status and ratings across devices in real time. The site automatically fetches movie and show details, displays posters, and updates your stats as you watch, making it easy to organize a group marathon from start to finish.">
    <meta property="og:title" content="Watchlist">
    <meta property="og:description" content="Journey through the MCU">
    <meta property="og:image" content="welcome-banner.png">
    <meta property="og:url" content="https://marvelmarathon.netlify.app/">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/src/theme.css?v=2">
    <link rel="stylesheet" href="/output.css?v=2">
</head>

<body class="font-sans text-text-primary bg-bg-primary">


    <div id="wallpaper-overlay" class="fixed inset-0 bg-black/50 pointer-events-none z-[-1]"></div>

    <!-- Allen Easter Egg -->
    <img id="allen-easter-egg" src="https://static.tvtropes.org/pmwiki/pub/images/alan_28sf29.png"
        class="fixed hidden transition-transform duration-500 cursor-pointer z-10"
        style="width: 150px; bottom: 0; right: 20%; transform-origin: bottom center;">

    <div id="loading-spinner" class="fixed inset-0 bg-bg-primary flex flex-col justify-center items-center z-[60]">
        <div class="animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-accent-primary"></div>
        <p id="loading-fact" class="text-text-primary text-lg mt-8 text-center px-4"></p>
    </div>

    <div class="sticky top-0 z-50">
        <div id="banner" class="hidden bg-white text-black p-2 text-center relative">
            <p>Change your avatar! Find other updates in the new NOTI button.</p>
            <button id="close-banner-btn" class="absolute top-0 right-0 p-2">&times;</button>
        </div>
        <nav class="px-4 py-2">
            <div class="container mx-auto flex items-center justify-between h-16">
                <div class="flex items-center gap-2">
                    <div id="logo-container" class="nav-pill flex items-center cursor-pointer">
                        <img src="icon.png" alt="Logo" class="h-8 w-8 mr-2">
                        <span class="font-bold text-white text-lg">Watchlist</span>
                        <!-- Icon removed -->
                    </div>
                    <div class="nav-pill notification-pill hidden">
                        <button id="notification-btn"
                            class="relative text-gray-300 hover:text-white focus:outline-none focus:text-white">
                            <i class="fas fa-bell"></i>
                            <span id="notification-count"
                                class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full"
                                style="display: none;"></span>
                        </button>
                    </div>
                </div>
                <div class="nav-pill user-pill">
                    <div class="relative">
                        <button id="user-menu-btn" class="flex items-center text-sm text-white focus:outline-none">
                            <div id="user-avatar-container" class="flex -space-x-2">
                                <div id="user1-avatar-nav" class="w-8 h-8 rounded-full"></div>
                                <div id="user2-avatar-nav" class="w-8 h-8 rounded-full"></div>
                            </div>
                            <span id="device-name" class="ml-2 font-semibold">User</span>
                        </button>
                        <div id="user-menu"
                            class="hidden absolute right-0 mt-2 w-48 bg-bg-secondary rounded-md shadow-lg py-1 z-50">
                            <a href="profile.html"
                                class="block px-4 py-2 text-sm text-text-primary hover:bg-bg-tertiary">
                                <i class="fas fa-user-circle mr-2"></i>Profiles
                            </a>
                            <a href="#" id="settings-btn"
                                class="block px-4 py-2 text-sm text-text-primary hover:bg-bg-tertiary">
                                <i class="fas fa-cog mr-2"></i>Settings
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </div>

    <div id="notification-modal" class="fixed inset-0 z-[55] hidden items-center justify-center p-4"
        style="backdrop-filter: blur(8px);">
        <div class="modal-backdrop fixed inset-0" onclick="closeNotificationModal()"></div>
        <div
            class="bg-bg-secondary rounded-lg shadow-xl z-50 w-full md:w-1/2 mx-auto modal-content relative max-h-full overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">Notifications</h2>
                    <div class="flex items-center space-x-4">
                        <a href="profile.html" class="text-text-muted hover:text-text-primary transition"
                            title="Profiles">
                            <i class="fas fa-user-circle text-xl"></i>
                        </a>
                        <button id="notification-settings-btn"
                            class="text-text-muted hover:text-text-primary transition" title="Settings">
                            <i class="fas fa-cog text-xl"></i>
                        </button>
                    </div> <button id="close-notification-modal-btn"
                        class="text-text-primary hover:text-accent-primary transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="flex justify-between items-center mb-4">
                <span id="unread-count" class="text-sm text-text-muted"></span>
                <button id="mark-all-as-read-btn" class="text-sm text-accent-primary hover:underline">Mark all as
                    read</button>
            </div>
            <div id="notification-filter-bar" class="flex items-center bg-bg-secondary rounded-full p-1 mb-4">
                <button data-filter="all"
                    class="notification-filter-btn px-4 py-2 text-sm font-semibold rounded-full transition btn-active">All</button>
                <button data-filter="feature"
                    class="notification-filter-btn px-4 py-2 text-sm font-semibold rounded-full transition">New
                    Features</button>
                <button data-filter="update"
                    class="notification-filter-btn px-4 py-2 text-sm font-semibold rounded-full transition">Updates</button>
                <button data-filter="announcement"
                    class="notification-filter-btn px-4 py-2 text-sm font-semibold rounded-full transition">Announcements</button>
            </div>
            <div id="notification-list" class="space-y-4 max-h-96 overflow-y-auto">
            </div>
        </div>
    </div>
    </div>

    <div class="container mx-auto p-4 md:p-8 relative z-0">
        <div class="flex justify-center items-center mb-6 gap-2 px-2 sm:px-0">
            <input type="text" id="search-bar"
                class="bg-bg-secondary text-text-primary rounded-full px-4 py-2 w-full max-w-md shadow-md"
                placeholder="Search for movies or shows...">
            <button id="home-btn"
                class="hidden bg-bg-secondary text-text-primary rounded-full p-2 w-10 h-10 flex-shrink-0 shadow-md">
                <i class="fas fa-home"></i>
            </button>
        </div>

        <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-6">
            <!-- Filters and Sort -->
            <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 flex-1">
                <div id="filter-controls"
                    class="flex items-center bg-bg-secondary rounded-full p-1 overflow-x-auto scrollbar-hide flex-shrink-0">
                    <button data-filter="all"
                        class="filter-btn btn-active px-4 py-2 text-sm font-semibold rounded-full transition whitespace-nowrap">All</button>
                    <button data-filter="movie"
                        class="filter-btn px-4 py-2 text-sm font-semibold rounded-full transition whitespace-nowrap">Movies</button>
                    <button data-filter="tv"
                        class="filter-btn px-4 py-2 text-sm font-semibold rounded-full transition whitespace-nowrap">TV
                        Shows</button>
                </div>
                <div class="relative flex-shrink-0">
                    <select id="sort-select"
                        class="bg-bg-secondary text-text-primary rounded-full px-4 py-2 appearance-none w-full sm:w-auto">
                        <option value="default">Default</option>
                        <option value="alphabetical">Alphabetical (A-Z)</option>
                        <option value="release_date">Release Date (Newest)</option>
                        <option value="length">Length (Longest)</option>
                    </select>
                    <i
                        class="fas fa-sort absolute right-3 top-1/2 transform -translate-y-1/2 text-text-muted pointer-events-none"></i>
                </div>
            </div>
            <!-- Random and View Controls -->
            <div class="flex items-center gap-2 justify-between sm:justify-end md:justify-start">
                <button id="random-movie-btn"
                    class="bg-accent-secondary hover:bg-accent-primary text-text-primary font-semibold px-4 py-2 rounded-full transition flex items-center gap-2">
                    <i class="fas fa-dice"></i> <span class="hidden sm:inline">Feeling Lucky?</span>
                </button>
                <div id="view-controls" class="flex items-center bg-bg-secondary rounded-full p-1">
                    <button data-view="grid" class="view-btn btn-active px-4 py-2 rounded-full transition"><i
                            class="fas fa-th-large"></i></button>
                    <button data-view="list" class="view-btn px-4 py-2 rounded-full transition"><i
                            class="fas fa-list"></i></button>
                </div>
            </div>
        </div>

        <div id="content-area">
            <!-- Currently Watching Section -->
            <div id="currently-watching-section" class="mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">Currently Watching</h2>
                    <button id="edit-currently-watching-btn"
                        class="text-text-primary hover:text-accent-primary transition p-2 flex-shrink-0">
                        <i class="fas fa-pencil-alt"></i>
                    </button>
                </div>
                <div class="relative">
                    <div id="currently-watching-carousel" class="flex overflow-x-auto gap-6 pb-4">
                        <!-- Carousel items will be dynamically inserted here -->
                    </div>
                </div>
            </div>

            <!-- Want to Watch Section -->
            <div id="want-to-watch-section" class="mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">Want to Watch</h2>
                    <button id="edit-want-to-watch-btn"
                        class="text-text-primary hover:text-accent-primary transition p-2 flex-shrink-0">
                        <i class="fas fa-pencil-alt"></i>
                    </button>
                </div>
                <div class="relative">
                    <div id="want-to-watch-carousel" class="flex overflow-x-auto gap-6 pb-4">
                        <!-- Carousel items will be dynamically inserted here -->
                    </div>
                </div>
            </div>
            <h2 id="watched-items-header" class="text-2xl font-bold mb-4">Watched Items</h2>
            <div id="movie-grid"
                class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6">
                <!-- Media items will be dynamically inserted here -->
            </div>
            <div id="movie-list" class="hidden">
                <!-- List items will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <div id="movie-modal" class="fixed inset-0 hidden items-center justify-center modal-hidden p-4 z-[55]"
        style="backdrop-filter: blur(8px);">
        <div
            class="movie-modal-content bg-bg-secondary rounded-2xl shadow-xl w-full md:w-3/4 mx-auto flex flex-col max-h-[90vh] relative">
            <!-- Close Button (Sticky) -->
            <button id="close-modal-btn"
                class="absolute top-6 right-6 text-text-primary hover:text-accent-primary transition bg-white/10 backdrop-blur-sm rounded-full p-2 z-50">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                    </path>
                </svg>
            </button>

            <!-- Scrollable Content Area -->
            <div id="movie-modal-scrollable-content" class="overflow-y-auto flex-1 relative">
                <!-- Header with Backdrop and Manage Flairs Button (Scrolls with content) -->
                <div class="relative rounded-t-2xl overflow-hidden">
                    <div class="relative">
                        <img id="modal-backdrop-image" src="" class="w-full h-48 md:h-72 object-cover"
                            onerror="this.onerror=null;this.src='https://placehold.co/800x400/111827/ef4444?text=Image+Not+Found';">
                        <div
                            class="absolute inset-0 bg-gradient-to-t from-bg-secondary to-transparent pointer-events-none">
                        </div>
                        <img id="iron-man-walker" src="/iron-man-walking.gif" class="hidden absolute bottom-0 left-0"
                            style="width: 100px; height: auto;">

                        <div id="modal-title-container" class="absolute bottom-4 left-4"></div>
                        <div class="absolute top-4 left-4 flex items-center space-x-2" id="mood-controls">
                            <button id="add-mood-btn"
                                class="bg-blue-600 hover:bg-blue-700 text-text-primary font-bold py-2 px-4 rounded-full transition flex items-center justify-center">
                                <i class="fas fa-plus mr-2"></i>
                                <span>Add Reaction</span>
                            </button>
                            <div id="modal-mood-display" class="flex space-x-2">
                            </div>
                            <button id="remove-mood-btn"
                                class="text-xs text-text-secondary hover:text-danger transition hidden ml-2">Remove
                                Reaction</button>
                        </div>
                        <div class="absolute top-6 right-16 flex items-center space-x-2">
                            <button id="manage-flairs-btn"
                                class="text-text-primary hover:text-accent-primary transition bg-white/10 backdrop-blur-sm rounded-full p-2 z-30 transition-opacity duration-300 cursor-pointer"
                                title="Manage Flairs">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z">
                                    </path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Marvel Marathon Special Display -->
                <div id="marvel-marathon-display"
                    class="hidden flex-col items-center justify-center p-8 text-center space-y-6 min-h-[300px]">
                    <img src="/mm-logo.png" alt="Marvel Marathon" class="w-32 h-auto animate-pulse">
                    <div class="space-y-2">
                        <h3 class="text-2xl font-bold text-red-500">Marvel Marathon Exclusive</h3>
                        <p class="text-text-secondary max-w-md mx-auto">
                            This movie can be found in Marvel Marathon and can be edited there.
                        </p>
                        <a href="https://mm.juainny.com/" target="_blank"
                            class="inline-block mt-4 text-accent-primary hover:text-accent-secondary underline font-semibold transition">
                            Visit Marvel Marathon
                        </a>
                    </div>
                </div>

                <div id="normal-modal-content" class="block">
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-2">
                            <h2 id="modal-title" class="text-3xl font-bold"></h2>
                            <div id="modal-flairs-container" class="flex flex-wrap gap-1 justify-end mt-1"></div>
                        </div>
                        <div class="mb-4 flex justify-start">
                            <div id="modal-stats-pill"
                                class="flex items-center space-x-3 text-sm text-text-muted bg-black/20 backdrop-blur-sm rounded-full px-4 py-2 select-none cursor-pointer hover:bg-black/30 transition">
                                <span id="modal-release-year"></span>
                                <span>‚Ä¢</span>
                                <span id="modal-runtime"></span>
                                <span>‚Ä¢</span>
                                <span id="modal-content-rating"></span>
                                <span class="ml-2 cursor-pointer" id="title-tooltip" title="">
                                    <i class="fas fa-question-circle text-text-muted"></i>
                                </span>
                            </div>
                        </div>
                        <div class="flex items-center gap-4 my-4">
                            <div class="relative">
                                <button id="favorite-btn"
                                    class="bg-yellow-500 hover:bg-yellow-600 text-text-primary font-bold py-2 px-4 rounded-full transition flex items-center justify-center">
                                    <i class="fas fa-star mr-2"></i>
                                    <span>Favorite</span>
                                </button>
                                <div id="user-selection-menu"
                                    class="hidden absolute top-full mt-2 w-48 bg-bg-tertiary p-2 rounded-lg shadow-lg z-10">
                                    <button id="user1-btn"
                                        class="block w-full text-left px-4 py-2 text-text-primary hover:bg-bg-secondary rounded">Juainny</button>
                                    <button id="user2-btn"
                                        class="block w-full text-left px-4 py-2 text-text-primary hover:bg-bg-secondary rounded">Erick</button>
                                    <button id="remove-all-btn"
                                        class="block w-full text-left px-4 py-2 text-danger hover:bg-bg-secondary rounded">Remove
                                        All Favorites</button>
                                </div>
                            </div>
                            <a id="modal-imdb-link" href="#" target="_blank"
                                class="flex items-center space-x-2 text-yellow-400 hover:text-yellow-300">
                                <i class="fab fa-imdb fa-2x"></i>
                                <span id="modal-score" class="text-lg font-bold"></span>
                            </a>
                        </div>
                        <p id="modal-overview" class="text-text-secondary mb-6">Overview goes here...</p>

                        <div id="end-time-calculator" class="text-sm text-text-muted my-4">
                            <p>If you start at <span id="start-time-hour" class="font-bold cursor-pointer"></span>:<span
                                    id="start-time-minute" class="font-bold cursor-pointer"></span>, you would end at
                                <span id="end-time" class="font-bold"></span>.
                            </p>
                        </div>

                        <div class="border-t border-border-primary pt-4 space-y-4">
                            <div id="tv-progress-section" class="hidden">
                                <h3 class="text-lg font-semibold mb-2">Episode Progress</h3>
                                <div id="tv-progress-container" class="bg-bg-tertiary rounded-lg">
                                    <!-- Seasons and episodes will be dynamically inserted here -->
                                </div>
                            </div>
                            <div id="notes-section" class="hidden">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="text-lg font-semibold">Post-Watch Ratings</h3>
                                    <button id="remove-rating-btn"
                                        class="text-xs text-text-muted hover:text-danger transition hidden">Remove All
                                        Ratings</button>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-bg-tertiary p-4 rounded-lg">
                                        <div class="flex items-center mb-2 group cursor-pointer"
                                            id="juainny-profile-link">
                                            <div id="juainny-avatar"
                                                class="w-10 h-10 rounded-full mr-3 flex items-center justify-center text-xl font-bold text-white transition-transform group-hover:scale-105">
                                                J</div>
                                            <h4
                                                class="text-md font-semibold text-text-secondary group-hover:text-accent-primary transition-colors">
                                                Juainny's Rating</h4>
                                        </div>
                                        <div id="juainny-rating-container">
                                            <!-- Star rating component will be injected here -->
                                        </div>
                                        <div id="juainny-notes" contenteditable="true"
                                            class="mt-2 block w-full rounded-md bg-bg-primary border border-border-primary shadow-sm focus:border-accent-primary focus:ring-accent-primary sm:text-sm text-text-primary p-2 min-h-[4rem] max-h-[12rem] overflow-y-auto">
                                        </div>
                                    </div>
                                    <div class="bg-bg-tertiary p-4 rounded-lg">
                                        <div class="flex items-center mb-2 group cursor-pointer"
                                            id="erick-profile-link">
                                            <div id="erick-avatar"
                                                class="w-10 h-10 rounded-full mr-3 flex items-center justify-center text-xl font-bold text-white transition-transform group-hover:scale-105">
                                                E</div>
                                            <h4
                                                class="text-md font-semibold text-text-secondary group-hover:text-accent-primary transition-colors">
                                                Erick's Rating</h4>
                                        </div>
                                        <div id="erick-rating-container">
                                            <!-- Star rating component will be injected here -->
                                        </div>
                                        <div id="erick-notes" contenteditable="true"
                                            class="mt-2 block w-full rounded-md bg-bg-primary border border-border-primary shadow-sm focus:border-accent-primary focus:ring-accent-primary sm:text-sm text-text-primary p-2 min-h-[4rem] max-h-[12rem] overflow-y-auto">
                                        </div>
                                    </div>
                                </div>

                                <!-- Willow's Thoughts Section -->
                                <div id="willow-summary-section"
                                    class="mt-6 bg-gradient-to-r from-teal-900/30 to-emerald-900/30 p-4 rounded-lg border border-teal-500/30 relative overflow-hidden">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div class="w-8 h-8 flex items-center justify-center overflow-hidden">
                                            <img src="/willow-logo.png" alt="Willow"
                                                class="w-full h-full object-contain">
                                        </div>
                                        <h3 class="text-lg font-bold text-teal-400">Willow's Thoughts</h3>
                                    </div>
                                    <p id="willow-summary-text"
                                        class="text-text-secondary text-sm leading-relaxed italic">
                                        Willow is analyzing your thoughts...
                                    </p>
                                    <button id="regenerate-summary-btn"
                                        class="absolute top-4 right-4 text-teal-400 hover:text-teal-300 transition"
                                        title="Regenerate Summary">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="flex flex-col gap-2">
                                <button id="currently-watching-btn"
                                    class="w-full bg-blue-600 hover:opacity-80 text-text-primary font-bold py-3 px-4 rounded-lg transition">
                                    Currently Watching
                                </button>
                                <button id="remove-currently-watching-btn"
                                    class="hidden w-full bg-danger hover:opacity-80 text-text-primary font-bold py-3 px-4 rounded-lg transition">
                                    Remove from Currently Watching
                                </button>
                                <div class="flex gap-2">
                                    <button id="toggle-watched-btn"
                                        class="w-full bg-success hover:opacity-80 text-text-primary font-bold py-3 px-4 rounded-lg transition">
                                        Mark as Watched
                                    </button>
                                    <button id="bookmark-btn"
                                        class="w-auto bg-gray-600 hover:opacity-80 text-text-primary font-bold py-3 px-4 rounded-lg transition">
                                        <i class="fas fa-bookmark"></i>
                                    </button>
                                    <button id="toggle-rejected-btn"
                                        class="w-auto bg-danger hover:opacity-80 text-text-primary font-bold py-3 px-4 rounded-lg transition">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Willow Chat FAB -->
    <button id="willow-fab"
        class="fixed bottom-6 right-6 w-16 h-16 bg-transparent hover:scale-110 transition-transform z-[50] group focus:outline-none">
        <img src="/willow-logo.png" alt="Ask Willow"
            class="w-full h-full object-contain drop-shadow-2xl filter hover:brightness-110">
        <div
            class="absolute bottom-full right-0 mb-2 w-max bg-black/80 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
            Ask Willow
        </div>
    </button>

    <!-- Willow Chat Modal - REDESIGNED -->
    <div id="willow-chat-modal" class="fixed inset-0 z-[60] hidden pointer-events-none">
        <!-- Semi-transparent backdrop -->
        <div class="modal-backdrop fixed inset-0 bg-black/30 pointer-events-auto backdrop-blur-sm"
            onclick="toggleWillowChat()"></div>

        <!-- Chat container - bottom-right, expands upward -->
        <div class="fixed bottom-4 right-4 flex flex-col pointer-events-auto transform transition-all duration-300 origin-bottom-right"
            id="willow-chat-container"
            style="max-height: min(600px, calc(100vh - 100px)); width: min(400px, calc(100vw - 2rem));">

            <!-- Chat Card with rounded corners -->
            <div
                class="bg-bg-secondary rounded-2xl shadow-2xl border border-white/10 flex flex-col h-full overflow-hidden">
                <!-- Compact Header -->
                <div
                    class="bg-gradient-to-r from-teal-600/90 to-emerald-600/90 backdrop-blur-md p-3 flex justify-between items-center border-b border-white/20">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 flex items-center justify-center overflow-hidden">
                            <img src="/willow-logo.png" alt="Willow" class="w-full h-full object-contain">
                        </div>
                        <div>
                            <h3 class="text-white font-bold text-sm">Willow</h3>
                            <p class="text-teal-100 text-xs">AI Assistant</p>
                        </div>
                    </div>
                    <button onclick="toggleWillowChat()"
                        class="text-white/80 hover:text-white transition w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Chat Messages - Scrollable -->
                <div id="willow-chat-messages"
                    class="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar bg-bg-primary/50"
                    style="min-height: 300px;">
                    <!-- Welcome Message -->
                    <div class="flex items-start gap-2">
                        <div class="w-8 h-8 flex-shrink-0 flex items-center justify-center overflow-hidden">
                            <img src="/willow-logo.png" alt="Willow" class="w-full h-full object-contain">
                        </div>
                        <div
                            class="bg-bg-tertiary p-3 rounded-2xl rounded-tl-none text-text-primary text-sm shadow-sm max-w-[85%]">
                            Hi! I'm Willow. I can help you find something to watch or answer questions. What's on your
                            mind?
                        </div>
                    </div>
                </div>

                <!-- Input Area - Fixed at bottom with rounded pill -->
                <div class="p-3 bg-bg-secondary border-t border-white/10">
                    <form id="willow-chat-form" class="flex gap-2">
                        <input type="text" id="willow-chat-input" placeholder="Ask Willow anything..."
                            class="flex-1 px-4 py-2.5 rounded-full bg-bg-tertiary text-text-primary placeholder-text-muted border border-white/10 focus:border-teal-500 focus:outline-none focus:ring-2 focus:ring-teal-500/50 text-sm transition">
                        <button type="submit"
                            class="w-10 h-10 rounded-full bg-gradient-to-r from-teal-600 to-emerald-600 text-white flex items-center justify-center hover:shadow-lg hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                            </svg>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="mood-modal-container"></div>
    <div id="tooltip" class="hidden absolute bg-gray-900 text-white text-sm rounded-lg px-2 py-1 z-50"></div>
    <div id="info-tooltip" class="hidden absolute bg-gray-900 text-white text-sm rounded-lg px-2 py-1 z-50">
        this little site sysncs across both of our devices (so hard to make) and has posters (so hard to get).
    </div>

    <div id="confirmation-modal" class="fixed inset-0 z-[60] hidden items-center justify-center p-4"
        style="backdrop-filter: blur(5px); background-color: rgba(0,0,0,0.7);">
        <div class="bg-bg-secondary rounded-lg shadow-xl w-full max-w-md p-6 border border-border-primary">
            <h3 id="confirmation-title" class="text-xl font-bold mb-4 text-white">Confirm Action</h3>
            <p id="confirmation-message" class="text-text-secondary mb-6">Are you sure?</p>
            <div class="flex flex-col gap-3">
                <button id="confirm-series-only-btn"
                    class="bg-accent-primary hover:bg-accent-secondary text-white font-bold py-3 px-6 rounded-lg transition shadow-lg">
                    Mark Series as Watched (Only)
                </button>
                <button id="confirm-all-episodes-btn"
                    class="bg-gray-700 hover:bg-gray-600 text-gray-300 font-semibold py-2 px-4 rounded-lg transition text-sm">
                    Mark All Episodes & Seasons Watched
                </button>
                <button id="cancel-confirmation-btn"
                    class="bg-transparent hover:bg-white/10 text-text-muted hover:text-white font-semibold py-2 px-4 rounded-lg transition text-sm">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Favorite Removal Modal -->
    <div id="favorite-removal-modal" class="fixed inset-0 z-[60] hidden items-center justify-center p-4"
        style="backdrop-filter: blur(5px); background-color: rgba(0,0,0,0.7);">
        <div class="bg-bg-secondary rounded-lg shadow-xl w-full max-w-md p-6 border border-border-primary">
            <h3 class="text-xl font-bold mb-4 text-white">Too Many Favorites!</h3>
            <p class="text-text-secondary mb-6">You can only have 3 favorites. Please remove one to continue:</p>

            <div id="favorite-removal-list" class="space-y-2 mb-6 max-h-64 overflow-y-auto">
                <!-- Favorites will be dynamically inserted here -->
            </div>

            <button id="cancel-favorite-removal-btn"
                class="w-full bg-transparent hover:bg-white/10 text-text-muted hover:text-white font-semibold py-2 px-4 rounded-lg transition">
                Cancel
            </button>
        </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
    <script type="module" src="/src/supabase-client.js"></script>
    <script type="module" src="/src/features/ratings.js"></script>
    <script type="module" src="/src/settings.js"></script>
    <script type="module" src="/src/app.js"></script>


    <!-- Flair Management Modal -->
    <!-- Flair Management Modal -->
    <div id="flair-modal"
        class="fixed inset-0 hidden items-center justify-center modal-hidden p-4 z-[60] bg-black/50 backdrop-blur-sm">
        <div
            class="bg-bg-secondary rounded-2xl shadow-xl w-full md:w-2/3 lg:w-1/2 max-h-[90vh] overflow-y-auto p-6 space-y-6 relative">

            <!-- Close Button -->
            <button id="close-flair-modal-btn"
                class="absolute top-4 right-4 text-text-primary hover:text-accent-primary transition">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                    </path>
                </svg>
            </button>

            <!-- Header -->
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold text-text-primary">MANAGE FLAIRS</h2>
            </div>

            <!-- Current Flairs (Assigned to this media) -->
            <div>
                <h3 class="text-lg font-semibold mb-2 text-text-secondary">Assigned Flairs</h3>
                <div id="current-flairs-list"
                    class="flex flex-wrap gap-2 min-h-[3rem] bg-bg-tertiary p-4 rounded-lg border border-border-primary border-dashed">
                    <!-- Injected by JS -->
                </div>
            </div>

            <!-- Available Flairs (All flairs) -->
            <div>
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-lg font-semibold text-text-secondary">Available Flairs</h3>
                    <button id="toggle-create-flair-btn"
                        class="text-sm text-accent-primary hover:underline font-semibold">+ Create New</button>
                </div>
                <div id="available-flairs-list" class="flex flex-wrap gap-2 max-h-48 overflow-y-auto p-1">
                    <!-- Injected by JS -->
                </div>
            </div>

            <!-- Create/Edit Flair Form -->
            <div id="create-flair-form"
                class="hidden bg-bg-tertiary p-4 rounded-lg border border-border-primary space-y-4">
                <div class="flex justify-between items-center">
                    <h3 id="flair-form-title" class="text-lg font-bold text-text-primary">NEW FLAIR</h3>
                    <button id="delete-flair-btn" class="hidden text-danger hover:text-red-400"><i
                            class="fas fa-trash"></i></button>
                </div>
                <input type="hidden" id="edit-flair-id">

                <div>
                    <label class="block text-sm font-medium text-text-muted mb-1">Name</label>
                    <input type="text" id="new-flair-name"
                        class="w-full bg-bg-primary border border-border-primary rounded px-3 py-2 text-text-primary focus:border-accent-primary outline-none"
                        placeholder="e.g., Masterpiece">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-text-muted mb-1">Color</label>
                        <input type="color" id="new-flair-color"
                            class="w-full h-10 bg-bg-primary border border-border-primary rounded cursor-pointer"
                            value="#ef4444">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-text-muted mb-1">Icon (Emoji)</label>
                        <input type="text" id="new-flair-icon"
                            class="w-full bg-bg-primary border border-border-primary rounded px-3 py-2 text-text-primary focus:border-accent-primary outline-none"
                            placeholder="üî•">
                    </div>
                </div>

                <div class="flex gap-2 pt-2">
                    <button id="save-new-flair-btn"
                        class="flex-1 bg-accent-primary hover:bg-accent-secondary text-white font-bold py-2 rounded transition">Create
                        Flair</button>
                    <button id="cancel-edit-flair-btn"
                        class="flex-1 bg-transparent hover:bg-white/10 text-text-muted hover:text-white font-semibold py-2 rounded transition border border-border-primary">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>
    </div>

    <!-- Welcome Modal -->
    <div id="welcome-modal" class="fixed inset-0 z-[70] hidden items-center justify-center p-4"
        style="backdrop-filter: blur(8px); background-color: rgba(0,0,0,0.6);">
        <div
            class="bg-bg-secondary rounded-2xl shadow-2xl w-full max-w-lg mx-auto overflow-hidden relative border border-border-primary flex flex-col max-h-[90vh]">
            <!-- Banner -->
            <div class="h-32 sm:h-40 w-full relative flex-shrink-0">
                <img src="/welcome-banner.png" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-bg-secondary to-transparent"></div>
                <button id="close-welcome-btn"
                    class="absolute top-4 right-4 text-white bg-black/30 hover:bg-black/50 rounded-full p-2 transition backdrop-blur-sm w-8 h-8 flex items-center justify-center">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Content -->
            <div class="p-6 overflow-y-auto custom-scrollbar flex-1">
                <h2 class="text-2xl font-bold text-text-primary mb-2 text-center">Welcome to Watchlist!</h2>
                <p class="text-text-muted text-center text-sm mb-6">A BIGGG upgrade for us ‚ù§Ô∏è</p>

                <div class="space-y-4 text-text-secondary text-sm leading-relaxed">
                    <p>
                        I created the <span class="text-accent-primary font-semibold">Marvel
                            Marathon</span> which you used a lot at first (you might you the same to this), same with
                        our notes, das not tea...
                        I see our notes app as a great way to keep track of what we watch, but it is time to elevate it,
                        with Watchlist.
                    </p>

                    <p>
                        Don't worry doe, I think believe that the notes app <img
                            src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/Apple_Notes_icon.svg/1200px-Apple_Notes_icon.svg.png"
                            class="inline-block w-5 h-5 align-text-bottom mx-1" style="vertical-align: middle;"> will be
                        used as a back up which is why I've made it nice and easy to look at our media in a familiar
                        list view, and copy a movie title by double clicking its logo and pasting in notes.
                    </p>

                    <div class="bg-bg-tertiary p-4 rounded-xl border border-border-primary space-y-3">
                        <p class="font-semibold text-text-primary">Just like our other website (but more) you can:</p>
                        <ul class="space-y-2">
                            <li class="flex items-center gap-3">
                                <div
                                    class="w-8 h-8 flex-shrink-0 flex items-center justify-center bg-bg-primary rounded-full border border-border-primary">
                                    <img src="/moods/happy.png" class="w-5 h-5 object-contain">
                                </div>
                                <span>Use reactions</span>
                            </li>
                            <li class="flex items-center gap-3">
                                <div
                                    class="w-8 h-8 flex-shrink-0 flex items-center justify-center bg-bg-primary rounded-full border border-border-primary text-blue-400">
                                    <i class="fas fa-comment"></i>
                                </div>
                                <span>Leave comments</span>
                            </li>
                            <li class="flex items-center gap-3">
                                <div
                                    class="w-8 h-8 flex-shrink-0 flex items-center justify-center bg-bg-primary rounded-full border border-border-primary text-yellow-400">
                                    <i class="fas fa-star"></i>
                                </div>
                                <span>Rate movies & shows</span>
                            </li>
                            <li class="flex items-center gap-3">
                                <div
                                    class="w-8 h-8 flex-shrink-0 flex items-center justify-center bg-bg-primary rounded-full border border-border-primary text-accent-primary">
                                    <i class="fas fa-tag"></i>
                                </div>
                                <span>Add flairs</span>
                            </li>
                            <li class="flex items-center gap-3">
                                <div
                                    class="w-8 h-8 flex-shrink-0 flex items-center justify-center bg-bg-primary rounded-full border border-border-primary">
                                    <img src="/willow-logo.png" class="w-5 h-5 object-contain">
                                </div>
                                <span>Use our handy AI that is actually useful</span>
                            </li>
                        </ul>
                    </div>

                    <p class="italic text-center mt-4 text-lg">
                        I hope you enjoy it BEB, I love you!
                    </p>

                    <!-- Signature -->
                    <div class="flex items-center justify-center gap-3 mt-4">
                        <div id="welcome-signature-avatar" class="w-10 h-10"></div>
                        <span class="text-xl text-text-primary font-bold" style="font-family: cursive;">- Juainny</span>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="p-4 border-t border-border-primary bg-bg-tertiary flex justify-center flex-shrink-0">
                <button id="dismiss-welcome-btn"
                    class="bg-accent-primary hover:bg-accent-secondary text-white font-bold py-3 px-8 rounded-full transition shadow-lg w-full sm:w-auto transform hover:scale-105">
                    Let's See! üöÄ
                </button>
            </div>
        </div>
    </div>

    <!-- Reaction Tooltip -->
    <div id="reaction-tooltip" class="fixed hidden z-[9999] pointer-events-none">
        <div class="bg-black/80 backdrop-blur-md text-white px-4 py-2 rounded-lg shadow-xl flex items-center gap-3">
            <div id="tooltip-avatar"></div>
            <span id="tooltip-text" class="text-sm font-medium whitespace-nowrap"></span>
        </div>
    </div>

    <footer class="relative z-0 text-center py-4 text-text-muted">
        <p>
            <a href="https://beta.mm.spidr.pw">Beta Site</a> | Vibe code with Gemini <img src="gemini.svg"
                alt="Gemini Logo" width="20" height="20"> ‚ù§Ô∏è
        </p>
    </footer>
    <!-- Settings Modal (Moved to root for stacking context) -->
    <div id="settings-modal" class="fixed inset-0 z-[60] hidden items-center justify-center modal-hidden p-4">
        <div class="modal-backdrop fixed inset-0" onclick="closeSettingsModal()"></div>
        <div
            class="bg-bg-secondary rounded-lg shadow-xl z-50 w-full md:w-1/2 mx-auto modal-content relative max-h-full overflow-y-auto">
            <button id="close-settings-modal-btn"
                class="absolute top-4 right-4 text-text-primary hover:text-accent-primary transition bg-white/10 backdrop-blur-sm rounded-full p-2 z-10">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                    </path>
                </svg>
            </button>
            <div class="p-6">
                <h2 class="text-2xl font-bold mb-4">Settings</h2>
                <div class="border border-border-primary rounded-lg p-4 mb-4">
                    <h3 class="text-lg font-semibold mb-2">Device Name</h3>
                    <input type="text" id="device-name-input"
                        class="w-full bg-bg-primary border-border-primary rounded-md text-center p-2"
                        placeholder="Enter device name">
                    <p class="text-xs text-text-muted mt-2">This will only change the text that appears next to
                        the user
                        avatars in the top bar on this device.</p>
                    <button id="reset-device-name-btn" class="text-xs text-accent-primary hover:underline mt-2">Reset
                        device name</button>
                </div>
                <div class="border border-border-primary rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-2">Theme</h3>
                    <div id="theme-picker" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button data-theme="night" class="theme-btn p-4 rounded-lg border-2 border-border-primary">Night
                            Mode</button>
                        <button data-theme="endgame"
                            class="theme-btn p-4 rounded-lg border-2 border-border-primary">Avengers
                            Endgame</button>
                        <button data-theme="smiling-friends"
                            class="theme-btn p-4 rounded-lg border-2 border-border-primary">Smiling
                            Friends</button>
                    </div>
                    <div class="border border-border-primary rounded-lg p-4 mt-4">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold">Hide Search Results Without Images</h3>
                            <label for="hide-search-images-toggle"
                                class="inline-flex relative items-center cursor-pointer">
                                <input type="checkbox" value="" id="hide-search-images-toggle" class="sr-only peer">
                                <div
                                    class="w-11 h-6 bg-bg-tertiary peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-accent-secondary rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent-primary">
                                </div>
                            </label>
                        </div>
                    </div>
                    <div class="border border-border-primary rounded-lg p-4 mb-4">
                        <h3 class="text-lg font-semibold mb-2">User Avatars</h3>
                        <div class="flex justify-around items-center">
                            <div class="flex flex-col items-center gap-2">
                                <div id="user1-avatar-preview"
                                    class="w-16 h-16 rounded-full border-2 border-transparent">
                                    <!-- Preview injected here -->
                                </div>
                                <span class="font-semibold">Juainny</span>
                                <button id="avatar-picker-user1-btn"
                                    class="text-xs bg-bg-tertiary hover:bg-bg-primary border border-border-primary px-3 py-1 rounded-full transition">Customize</button>
                            </div>
                            <div class="flex flex-col items-center gap-2">
                                <div id="user2-avatar-preview"
                                    class="w-16 h-16 rounded-full border-2 border-transparent">
                                    <!-- Preview injected here -->
                                </div>
                                <span class="font-semibold">Erick</span>
                                <button id="avatar-picker-user2-btn"
                                    class="text-xs bg-bg-tertiary hover:bg-bg-primary border border-border-primary px-3 py-1 rounded-full transition">Customize</button>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6">
                        <h3 class="text-lg font-semibold mb-2">Select a manual wallpaper</h3>
                        <div class="space-y-4">
                            <div class="flex flex-col space-y-4">
                                <label for="wallpaper-btn"
                                    class="text-text-secondary font-semibold text-sm mb-1">Wallpaper</label>
                                <button id="wallpaper-btn"
                                    class="w-full px-4 py-3 rounded-lg bg-bg-tertiary border border-border-primary text-text-primary hover:bg-bg-primary transition text-left">
                                    Click to select wallpaper
                                </button>
                                <button id="remove-wallpaper-btn"
                                    class="text-sm text-danger hover:underline self-start">Remove
                                    Wallpaper</button>
                            </div>
                        </div>
                    </div>
                    <div class="border border-border-primary rounded-lg p-4 mt-4">
                        <h3 class="text-lg font-semibold mb-2">Data Management</h3>
                        <div class="flex gap-4">
                            <button id="soft-refresh-btn"
                                class="flex-1 bg-accent-primary hover:bg-accent-secondary text-text-primary font-bold py-2 px-4 rounded-lg transition">Soft
                                Refresh</button>
                            <button id="emergency-refresh-btn"
                                class="flex-1 bg-danger hover:opacity-80 text-text-primary font-bold py-2 px-4 rounded-lg transition">Emergency
                                Refresh</button>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-between">
                        <button id="remove-wallpaper-btn"
                            class="bg-danger hover:opacity-80 text-text-primary font-bold py-2 px-4 rounded-lg transition">Remove
                            Wallpaper</button>
                        <div>
                            <button id="save-settings-btn"
                                class="bg-success hover:opacity-80 text-text-primary font-bold py-2 px-4 rounded-lg transition">Save</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Avatar Modal (Moved to root for stacking context) -->
        <div id="avatar-modal" class="fixed inset-0 z-[60] hidden items-center justify-center modal-hidden p-4">
            <div class="modal-backdrop fixed inset-0" id="close-avatar-modal-backdrop"></div>
            <div
                class="bg-bg-secondary rounded-lg shadow-xl z-50 w-full md:w-[480px] mx-auto modal-content relative flex flex-col max-h-[90vh]">
                <button id="close-avatar-modal-btn"
                    class="absolute top-4 right-4 text-text-primary hover:text-accent-primary transition bg-white/10 backdrop-blur-sm rounded-full p-2 z-10">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>

                <div class="p-6 overflow-y-auto custom-scrollbar">
                    <h2 class="text-2xl font-bold mb-6 text-center">Choose Avatar</h2>

                    <!-- Preview Section -->
                    <div class="flex justify-center mb-8">
                        <div id="avatar-preview-display"
                            class="w-32 h-32 rounded-full shadow-2xl border-4 border-bg-tertiary flex items-center justify-center text-4xl font-bold text-white relative overflow-hidden">
                            <!-- Content injected by JS -->
                            <span>J</span>
                        </div>
                    </div>

                    <!-- 1. Select User -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3">1. Select User</h3>
                        <div class="flex gap-4">
                            <button id="avatar-user-juainny"
                                class="flex-1 py-3 px-4 rounded-lg border-2 border-border-primary hover:border-accent-primary transition font-semibold text-center avatar-user-btn"
                                data-user="juainny">
                                Juainny
                            </button>
                            <button id="avatar-user-erick"
                                class="flex-1 py-3 px-4 rounded-lg border-2 border-border-primary hover:border-accent-primary transition font-semibold text-center avatar-user-btn"
                                data-user="erick">
                                Erick
                            </button>
                        </div>
                    </div>

                    <!-- Mode Toggle -->
                    <div class="flex bg-bg-tertiary rounded-lg p-1 mb-6">
                        <button id="avatar-mode-gradient"
                            class="flex-1 py-2 rounded-md text-sm font-semibold transition bg-bg-secondary text-text-primary shadow-sm avatar-mode-btn"
                            data-mode="gradient">Gradient Generator</button>
                        <button id="avatar-mode-image"
                            class="flex-1 py-2 rounded-md text-sm font-semibold transition text-text-muted hover:text-text-primary avatar-mode-btn"
                            data-mode="image">Custom Image URL</button>
                    </div>

                    <!-- Gradient Controls -->
                    <div id="avatar-gradient-controls">
                        <!-- 2. Select Colors -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold mb-3">2. Select Colors</h3>
                            <div class="grid grid-cols-2 gap-6">
                                <div>
                                    <label class="text-sm text-text-muted mb-2 block">Color 1</label>
                                    <div class="grid grid-cols-4 gap-2" id="color-picker-1">
                                        <!-- Colors injected by JS -->
                                    </div>
                                </div>
                                <div>
                                    <label class="text-sm text-text-muted mb-2 block">Color 2</label>
                                    <div class="grid grid-cols-4 gap-2" id="color-picker-2">
                                        <!-- Colors injected by JS -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 3. Select Icon -->
                        <div class="mb-8">
                            <h3 class="text-lg font-semibold mb-3">3. Select Icon</h3>
                            <div class="grid grid-cols-5 gap-3" id="icon-picker">
                                <!-- Icons injected by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Image Controls -->
                    <div id="avatar-image-controls" class="hidden mb-8">
                        <h3 class="text-lg font-semibold mb-3">Upload Image</h3>
                        <div class="flex flex-col items-center justify-center w-full mb-4">
                            <label for="avatar-file-input"
                                class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-border-primary rounded-lg cursor-pointer hover:bg-bg-tertiary transition">
                                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                    <svg class="w-8 h-8 mb-4 text-text-muted" aria-hidden="true"
                                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2" />
                                    </svg>
                                    <p class="mb-2 text-sm text-text-muted"><span class="font-semibold">Click to
                                            upload</span> or drag and drop</p>
                                    <p class="text-xs text-text-muted">SVG, PNG, JPG or GIF</p>
                                </div>
                                <input id="avatar-file-input" type="file" class="hidden" accept="image/*" />
                            </label>
                            <p id="avatar-file-name" class="text-sm text-text-primary mt-2 hidden"></p>
                        </div>

                        <div class="text-center text-text-muted text-sm mb-3">or</div>

                        <div>
                            <label class="text-sm text-text-muted mb-2 block">Enter Image URL</label>
                            <input type="text" id="avatar-url-input"
                                class="w-full bg-bg-tertiary border border-border-primary rounded-lg p-3 text-text-primary focus:border-accent-primary focus:ring-1 focus:ring-accent-primary outline-none transition"
                                placeholder="https://example.com/avatar.png">
                        </div>
                    </div>

                    <!-- Save Button -->
                    <button id="save-avatar-btn"
                        class="w-full bg-accent-primary hover:bg-accent-secondary text-white font-bold py-4 rounded-lg transition shadow-lg transform active:scale-95">
                        Save
                    </button>
                </div>
            </div>
        </div>

        <!-- Wallpaper Selector Modal -->
        <div id="wallpaper-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center"
            style="background-color: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px);">
            <div class="rounded-xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto"
                style="background-color: var(--color-bg-secondary); border: 1px solid var(--color-border-primary);">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold" style="color: var(--color-text-primary);">Select Wallpaper</h2>
                    <button id="close-wallpaper-modal" class="text-2xl" style="color: var(--color-text-muted);">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mb-4">
                    <input type="text" id="wallpaper-search" placeholder="Search media..."
                        class="w-full px-4 py-2 rounded-lg"
                        style="background-color: var(--color-bg-tertiary); border: 1px solid var(--color-border-primary); color: var(--color-text-primary);">
                </div>
                <div id="wallpaper-grid" class="grid grid-cols-2 gap-4 max-h-96 overflow-y-auto">
                    <!-- Wallpaper options will be injected here -->
                </div>
            </div>
        </div>

</body>

</html>