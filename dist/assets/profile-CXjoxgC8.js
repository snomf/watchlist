import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as y}from"./supabase-client-Dw9ZaCyq.js";let v="juainny";const x=new URLSearchParams(window.location.search),f=x.get("user");f&&(f==="juainny"||f==="erick")&&(v=f);let h={juainny:null,erick:null};async function B(){const{data:e}=await y.from("settings").select("*").eq("id",1).single();if(e){const t=e.theme||"night";document.documentElement.setAttribute("data-theme",t);const a=document.getElementById("wallpaper-overlay");e.wallpaper_url&&(document.body.style.backgroundImage=`url('${e.wallpaper_url}')`,document.body.style.backgroundSize="cover",document.body.style.backgroundPosition="center",document.body.style.backgroundRepeat="no-repeat",document.body.style.backgroundAttachment="fixed",a&&(a.style.display=t==="smiling-friends"?"none":"block")),e.juainny_avatar&&(h.juainny=typeof e.juainny_avatar=="string"?JSON.parse(e.juainny_avatar):e.juainny_avatar),e.erick_avatar&&(h.erick=typeof e.erick_avatar=="string"?JSON.parse(e.erick_avatar):e.erick_avatar);const n=localStorage.getItem("device_name"),r=document.getElementById("device-name");r&&(r.textContent=n||"User")}return e}function g(e,t=""){const a=h[e];if(!a)return`<div class="${t} rounded-full ${e==="juainny"?"bg-purple-500":"bg-blue-500"} flex items-center justify-center text-white font-bold">${e[0].toUpperCase()}</div>`;const{type:n,color1:r,color2:o,icon:s,imageUrl:m}=a;return n==="image"&&m?`
            <div class="${t} rounded-full relative overflow-hidden">
                <img src="${m}" class="w-full h-full object-cover">
            </div>
        `:`
        <div class="${t} rounded-full flex items-center justify-center relative overflow-hidden"
             style="background: linear-gradient(135deg, ${r}, ${o});">
            <img src="avatars/${s}" class="w-[60%] h-[60%] object-contain drop-shadow-sm">
        </div>
    `}document.addEventListener("DOMContentLoaded",async()=>{await B(),C(),_(),await L(v)});let b=[];function _(){const e=document.getElementById("edit-banner-btn"),t=document.getElementById("banner-modal"),a=document.getElementById("close-banner-modal"),n=document.getElementById("banner-search");e.addEventListener("click",async()=>{t.classList.remove("hidden"),await $()}),a.addEventListener("click",()=>{t.classList.add("hidden")}),t.addEventListener("click",r=>{r.target===t&&t.classList.add("hidden")}),n.addEventListener("input",r=>{I(r.target.value)})}async function $(){if(b.length===0){const{data:e,error:t}=await y.from("media").select("title, backdrop_path");if(t){console.error("Error fetching media for banners:",t);return}b=e.filter(a=>a.backdrop_path)}k(b)}function k(e){const t=document.getElementById("banner-grid");t.innerHTML="",e.forEach(a=>{const n=document.createElement("div");n.className="cursor-pointer rounded-lg overflow-hidden transition hover:scale-105",n.style.border="2px solid var(--color-border-primary)";const r=`https://image.tmdb.org/t/p/w500${a.backdrop_path}`;n.innerHTML=`
            <img src="${r}" class="w-full h-24 object-cover">
            <div class="p-2" style="background-color: var(--color-bg-tertiary);">
                <p class="text-sm font-semibold truncate" style="color: var(--color-text-primary);">${a.title}</p>
            </div>
        `,n.addEventListener("click",async()=>{await j(r)}),t.appendChild(n)})}function I(e){const t=b.filter(a=>a.title.toLowerCase().includes(e.toLowerCase()));k(t)}async function j(e){const t=`${v}_banner`,a={};a[t]=e;const{error:n}=await y.from("settings").update(a).eq("id",1);if(n){console.error("Error saving banner:",n),alert("Failed to save banner.");return}const r=document.getElementById("profile-banner"),o=document.getElementById("profile-banner-placeholder");r.src=e,r.classList.remove("hidden"),o.classList.add("hidden"),document.getElementById("banner-modal").classList.add("hidden")}function C(){const e=document.getElementById("view-juainny-btn"),t=document.getElementById("view-erick-btn");e.addEventListener("click",()=>E("juainny")),t.addEventListener("click",()=>E("erick"))}async function E(e){v!==e&&(v=e,await L(e))}async function L(e){const t=document.getElementById("view-juainny-btn"),a=document.getElementById("view-erick-btn"),n=["bg-accent-primary","text-white","border-transparent","shadow-lg","scale-105"],r=["bg-bg-tertiary","text-text-primary","border-border-primary","hover:bg-bg-primary","opacity-50"];e==="juainny"?(t.classList.add(...r),t.classList.remove(...n),a.classList.remove(...r),a.classList.add(...n)):(a.classList.add(...r),a.classList.remove(...n),t.classList.remove(...r),t.classList.add(...n));const o=document.getElementById("profile-name"),s=document.getElementById("profile-bio"),m=document.getElementById("profile-avatar-container"),i=document.getElementById("profile-banner"),d=document.getElementById("profile-banner-placeholder");o.textContent=e==="juainny"?"Juainny":"Erick";const{data:c}=await y.from("settings").select("*").eq("id",1).single();if(c){const p=e==="juainny"?c.juainny_bio:c.erick_bio;s.textContent=p||`No bio yet for ${e==="juainny"?"Juainny":"Erick"}.`;const w=e==="juainny"?c.juainny_banner:c.erick_banner;w?(i.src=w,i.classList.remove("hidden"),d.classList.add("hidden")):(i.classList.add("hidden"),d.classList.remove("hidden"))}const l=document.getElementById("user1-avatar-nav"),u=document.getElementById("user2-avatar-nav");l&&(l.innerHTML=g("juainny","w-full h-full")),u&&(u.innerHTML=g("erick","w-full h-full")),m.innerHTML=g(e,"w-full h-full"),N(e),await S(e)}function N(e){const t=document.getElementById("edit-bio-btn"),a=document.getElementById("bio-display-container"),n=document.getElementById("bio-edit-container"),r=document.getElementById("bio-input"),o=document.getElementById("cancel-bio-btn"),s=document.getElementById("save-bio-btn"),m=document.getElementById("profile-bio");a.classList.remove("hidden"),n.classList.add("hidden");const i=t.cloneNode(!0);t.parentNode.replaceChild(i,t);const d=s.cloneNode(!0);s.parentNode.replaceChild(d,s);const c=o.cloneNode(!0);o.parentNode.replaceChild(c,o),i.addEventListener("click",()=>{r.value=m.textContent.trim()===`No bio yet for ${e==="juainny"?"Juainny":"Erick"}.`?"":m.textContent.trim(),a.classList.add("hidden"),n.classList.remove("hidden"),r.focus()}),c.addEventListener("click",()=>{a.classList.remove("hidden"),n.classList.add("hidden")}),d.addEventListener("click",async()=>{const l=r.value.trim();m.textContent=l||`No bio yet for ${e==="juainny"?"Juainny":"Erick"}.`,a.classList.remove("hidden"),n.classList.add("hidden");const u={};u[`${e}_bio`]=l;const{error:p}=await y.from("settings").update(u).eq("id",1);p&&(console.error("Error saving bio:",p),alert("Failed to save bio. Please try again."))})}async function S(e){const t=document.getElementById("activity-feed");t.innerHTML='<div class="p-8 text-center text-text-muted"><i class="fas fa-spinner fa-spin text-2xl mb-2"></i><p>Loading activity...</p></div>';const{data:a,error:n}=await y.from("activity_log").select(`
            *,
            media:media_id (
                title, poster_path, backdrop_path, type
            )
        `).or(`user_id.eq.${e},user_id.eq.both`).order("created_at",{ascending:!1}).limit(50);if(n){console.error("Error fetching activity:",n),t.innerHTML='<div class="p-4 text-center text-danger">Failed to load activity.</div>';return}if(!a||a.length===0){t.innerHTML='<div class="p-8 text-center text-text-muted">No recent activity.</div>';return}t.innerHTML="",M(a).forEach(o=>{const s=T(o,e);t.appendChild(s)})}function M(e){const t=[];if(e.length===0)return t;let a={...e[0],count:1,timestamps:[e[0].created_at]};for(let n=1;n<e.length;n++){const r=e[n],o=a,s=r.user_id===o.user_id,m=r.action_type===o.action_type,i=r.media_id===o.media_id,d=new Date(r.created_at).toDateString(),c=new Date(o.created_at).toDateString();s&&m&&i&&d===c?(a.count++,a.timestamps.push(r.created_at)):(t.push(a),a={...r,count:1,timestamps:[r.created_at]})}return t.push(a),t}function T(e,t){const{action_type:a,details:n,created_at:r,media:o,count:s}=e,m=new Date(r).toLocaleDateString(void 0,{month:"short",day:"numeric"}),i=document.createElement("div");i.className="p-4 transition flex gap-4 items-start",i.style.borderBottom="1px solid var(--color-border-primary)",i.addEventListener("mouseenter",()=>{i.style.backgroundColor="var(--color-bg-tertiary)"}),i.addEventListener("mouseleave",()=>{i.style.backgroundColor=""});let d="fa-circle",c="var(--color-text-muted)",l="updated";switch(a){case"watched":d="fa-check-circle",c="var(--color-success)",l="watched";break;case"want_to_watch":d="fa-bookmark",c="var(--color-accent-primary)",l="wants to watch";break;case"favorite":d="fa-star",c="#facc15",l="favorited";break;case"reaction":d="fa-face-smile",c="var(--color-accent-primary)",l="reacted to";break;case"note_added":d="fa-sticky-note",c="#f59e0b",l=s>1?`added ${s} notes to`:"added a note to";break;case"rate":d="fa-star-half-alt",c="#fb923c",l="rated";break}const u=o.poster_path?`https://image.tmdb.org/t/p/w92${o.poster_path}`:"https://placehold.co/92x138?text=No+Image",p=o.title||"Unknown Title";return i.innerHTML=`
        <div class="flex-shrink-0 mt-1">
            <i class="fas ${d} text-xl" style="color: ${c};"></i>
        </div>
        <div class="flex-grow">
            <div class="flex justify-between items-start">
                <p style="color: var(--color-text-primary);">
                    <span class="font-semibold">${t==="juainny"?"Juainny":"Erick"}</span>
                    <span style="color: var(--color-text-muted);">${l}</span>
                    <span class="font-semibold" style="color: var(--color-accent-primary);">${p}</span>
                </p>
                <span class="text-xs whitespace-nowrap ml-2" style="color: var(--color-text-muted);">${m}</span>
            </div>
            ${n&&n.reaction?`
                <div class="mt-2 p-2 rounded-lg inline-block" style="background-color: var(--color-bg-primary); border: 1px solid var(--color-border-primary);">
                    <img src="moods/${n.reaction}" class="w-8 h-8 object-contain" alt="Reaction">
                </div>
            `:""}
            ${n&&n.note?`
                <div class="mt-2 p-3 rounded-lg text-sm italic" style="background-color: var(--color-bg-primary); border: 1px solid var(--color-border-primary); color: var(--color-text-secondary);">
                    "${n.note}"
                    ${s>1?`<span class="text-xs text-text-muted block mt-1">(and ${s-1} more updates)</span>`:""}
                </div>
            `:""}
             ${n&&n.rating?`
                <div class="mt-2 text-sm" style="color: var(--color-star-filled);">
                    ${"â˜…".repeat(Math.round(n.rating))} <span style="color: var(--color-text-muted);">(${n.rating}/5)</span>
                </div>
            `:""}
        </div>
        <div class="flex-shrink-0 w-12 h-18 rounded overflow-hidden shadow-sm ml-2">
            <img src="${u}" class="w-full h-full object-cover" alt="${p}">
        </div>
    `,i}
