import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as y}from"./supabase-client-Dw9ZaCyq.js";function Bn(e,t=0,n){const a=document.getElementById(e);if(!a)return;a.innerHTML=`
        <div class="star-rating-widget flex items-center gap-2">
            <div class="stars-wrapper flex">
                ${[...Array(10)].map((f,h)=>`
                    <div class="star-container" data-value="${h+1}">
                        <div class="star-half left" data-value="${h+.5}"></div>
                        <div class="star-half right" data-value="${h+1}"></div>
                        <i class="star-icon fas fa-star text-gray-500"></i>
                    </div>
                `).join("")}
            </div>
            <input type="number" step="0.5" min="0" max="10" class="rating-input-manual w-16 bg-bg-primary border-border-primary rounded-md text-center">
            <input type="hidden" class="rating-input-hidden" name="rating-${e}">
        </div>
    `;const r=a.querySelector(".stars-wrapper"),o=a.querySelector(".rating-input-manual"),s=a.querySelector(".rating-input-hidden"),i=Array.from(a.querySelectorAll(".star-container"));let l=parseFloat(t)||0;const c=f=>{const h=Math.round(f*2)/2;i.forEach(m=>{const d=parseFloat(m.dataset.value),p=m.querySelector(".star-icon");p.classList.remove("fas","fa-star","fa-star-half-alt","far","fa-star"),h>=d?(p.className="star-icon fas fa-star",p.style.color="var(--star-color, #fbbf24)"):h>=d-.5?(p.className="star-icon fas fa-star-half-alt",p.style.color="var(--star-color, #fbbf24)"):(p.className="star-icon far fa-star text-gray-500",p.style.color="")}),o.value=f.toFixed(1),s.value=f},u=f=>{l=f,c(l),n&&n(l)};i.forEach(f=>{[".left",".right"].forEach(h=>{const m=f.querySelector(h),d=parseFloat(m.dataset.value);m.addEventListener("mouseenter",()=>c(d)),m.addEventListener("click",()=>u(d))})}),r.addEventListener("mouseleave",()=>c(l)),o.addEventListener("change",()=>{let f=parseFloat(o.value);isNaN(f)&&(f=0),f=Math.max(0,Math.min(10,f)),u(f)}),u(l)}const xr="modulepreload",Cr=function(e){return"/"+e},Dn={},Rr=function(t,n,a){let r=Promise.resolve();if(n&&n.length>0){let l=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),i=s?.nonce||s?.getAttribute("nonce");r=l(n.map(c=>{if(c=Cr(c),c in Dn)return;Dn[c]=!0;const u=c.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":xr,u||(h.as="script"),h.crossOrigin="",h.href=c,i&&h.setAttribute("nonce",i),document.head.appendChild(h),u)return new Promise((m,d)=>{h.addEventListener("load",m),h.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(s){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=s,window.dispatchEvent(i),!i.defaultPrevented)throw s}return r.then(s=>{for(const i of s||[])i.status==="rejected"&&o(i.reason);return t().catch(o)})};let Ct=null;function ut(){const e=document.getElementById("allen-easter-egg");if(!e)return;if(Ct&&clearTimeout(Ct),document.documentElement.getAttribute("data-theme")!=="smiling-friends"){e.classList.add("hidden"),e.style.transform="scale(1)";return}const n=37e3,r=Math.floor(Math.random()*(9e4-n+1))+n;Ct=setTimeout(()=>{e.classList.remove("hidden"),e.style.transform="scale(1)"},r),e.onclick=()=>{e.style.transform="scale(0)",setTimeout(()=>{e.classList.add("hidden"),ut()},500)}}let ct=[];async function Br(){const e=document.getElementById("settings-modal");if(!e){console.error("Settings modal element not found!");return}try{await populateWallpaperSelector(),await Ye()}catch(n){console.error("Error preparing settings modal:",n)}document.body.style.overflow="hidden",e.classList.remove("hidden"),e.classList.remove("modal-hidden"),e.classList.add("flex");const t=document.querySelectorAll(".theme-btn");t.forEach(n=>{n.addEventListener("click",()=>{if(t.forEach(a=>a.classList.remove("border-accent-primary")),n.classList.add("border-accent-primary"),n.dataset.theme==="smiling-friends"){const a=document.getElementById("movie-banner-select"),r="https://images6.alphacoders.com/134/1346437.png";let o=Array.from(a.options).find(s=>s.value===r);o||(o=document.createElement("option"),o.value=r,o.textContent="Smiling Friends (Theme Default)",a.appendChild(o)),a.value=r}})})}function va(){const e=document.getElementById("settings-modal");e&&(e.classList.add("hidden"),e.classList.add("modal-hidden"),e.classList.remove("flex"),document.body.style.overflow="")}function Dr(){const e=document.getElementById("wallpaper-btn"),t=document.getElementById("wallpaper-modal"),n=document.getElementById("close-wallpaper-modal"),a=document.getElementById("wallpaper-search");!e||!t||(e.addEventListener("click",async()=>{t.classList.remove("hidden"),await Mr()}),n.addEventListener("click",()=>{t.classList.add("hidden")}),t.addEventListener("click",r=>{r.target===t&&t.classList.add("hidden")}),a.addEventListener("input",r=>{$r(r.target.value)}))}async function Mr(){if(ct.length===0){const{data:e,error:t}=await y.from("media").select("title, backdrop_path");if(t){console.error("Error fetching media for wallpapers:",t);return}ct=e.filter(n=>n.backdrop_path)}_a(ct)}function _a(e){const t=document.getElementById("wallpaper-grid");t&&(t.innerHTML="",e.forEach(n=>{const a=document.createElement("div");a.className="cursor-pointer rounded-lg overflow-hidden transition hover:scale-105",a.style.border="2px solid var(--color-border-primary)";const r=`https://image.tmdb.org/t/p/original${n.backdrop_path}`;a.innerHTML=`
            <img src="${r}" class="w-full h-24 object-cover">
            <div class="p-2" style="background-color: var(--color-bg-tertiary);">
                <p class="text-sm font-semibold truncate" style="color: var(--color-text-primary);">${n.title}</p>
            </div>
        `,a.addEventListener("click",async()=>{sn=r,await lt(),document.getElementById("wallpaper-modal").classList.add("hidden")}),t.appendChild(a)}))}function $r(e){const t=ct.filter(n=>n.title.toLowerCase().includes(e.toLowerCase()));_a(t)}let sn=null;async function lt(){const e=document.querySelector(".theme-btn.border-accent-primary"),t=e?e.dataset.theme:"night",n=sn||null,a=document.getElementById("device-name-input"),r=a?a.value.trim():"";r&&localStorage.setItem("device_name",r);const o=document.getElementById("device-name");o&&(o.textContent=r||"User");const{error:s}=await y.from("settings").update({theme:t,wallpaper_url:n}).eq("id",1);s?console.error("Error saving settings:",s):(await Ye(),va())}async function Ye(){const{data:e,error:t}=await y.from("settings").select("theme, wallpaper_url, hide_search_results_without_images, juainny_avatar, erick_avatar").eq("id",1).single();if(t||!e){console.error("Error loading settings:",t),document.documentElement.setAttribute("data-theme","night");return}const{theme:n,wallpaper_url:a,hide_search_results_without_images:r,juainny_avatar:o,erick_avatar:s}=e;document.documentElement.setAttribute("data-theme",n||"night"),o&&(Le.juainny=o),s&&(Le.erick=s);const i=(_,T)=>{const L=document.getElementById(T);L&&(L.innerHTML=G(_,"w-full h-full"))};i("juainny","user1-avatar-preview"),i("erick","user2-avatar-preview"),document.querySelectorAll(".theme-btn").forEach(_=>{_.dataset.theme===(n||"night")?_.classList.add("border-accent-primary"):_.classList.remove("border-accent-primary")}),document.getElementById("hide-search-images-toggle").checked=r;const c=document.getElementById("wallpaper-overlay");a?(document.body.style.backgroundImage=`url('${a}')`,document.body.style.backgroundSize="cover",document.body.style.backgroundPosition="center",document.body.style.backgroundRepeat="no-repeat",document.body.style.backgroundAttachment="fixed",c&&(n==="smiling-friends"?c.style.display="none":c.style.display="block")):(document.body.style.backgroundImage="none",document.body.style.backgroundSize="",document.body.style.backgroundPosition="",document.body.style.backgroundRepeat="",document.body.style.backgroundAttachment="",c&&(c.style.display="none")),typeof ut=="function"&&ut();const u=document.getElementById("movie-banner-select");u&&(u.value=a||"");const f=localStorage.getItem("device_name"),h=document.getElementById("device-name-input"),m=document.getElementById("device-name");h&&(h.value=f||""),m&&(m.textContent=f||"User");const d=document.getElementById("user1-avatar-nav"),p=document.getElementById("user2-avatar-nav");d&&(d.innerHTML=G("juainny","w-full h-full")),p&&(p.innerHTML=G("erick","w-full h-full"))}function Or(){const e=document.getElementById("settings-btn"),t=document.getElementById("close-settings-modal-btn"),n=document.getElementById("save-settings-btn"),a=document.getElementById("remove-wallpaper-btn");e?e.addEventListener("click",m=>{Br()}):console.error("Settings button NOT found in DOM during initialization."),t&&t.addEventListener("click",va),n&&n.addEventListener("click",lt);const r=document.getElementById("soft-refresh-btn"),o=document.getElementById("emergency-refresh-btn");r&&r.addEventListener("click",()=>{const m=new URL(window.location.href);m.searchParams.set("refresh","true"),window.location.href=m.toString()}),o&&o.addEventListener("click",()=>{const m=new URL(window.location.href);m.searchParams.set("hardrefresh","true"),window.location.href=m.toString()}),document.querySelectorAll(".theme-btn").forEach(m=>{m.addEventListener("click",()=>{const d=m.dataset.theme;document.documentElement.setAttribute("data-theme",d),document.querySelectorAll(".theme-btn").forEach(p=>p.classList.remove("border-accent-primary")),m.classList.add("border-accent-primary"),lt()})}),Dr(),a&&a.addEventListener("click",async()=>{sn=null,await lt()});const s=document.getElementById("avatar-picker-user1-btn"),i=document.getElementById("avatar-picker-user2-btn");s&&s.addEventListener("click",()=>Mn("juainny")),i&&i.addEventListener("click",()=>Mn("erick"));const l=document.getElementById("close-avatar-modal-btn"),c=document.getElementById("close-avatar-modal-backdrop"),u=document.getElementById("save-avatar-btn");l&&l.addEventListener("click",qt),c&&c.addEventListener("click",qt),u&&u.addEventListener("click",Ur),document.querySelectorAll(".avatar-user-btn").forEach(m=>{m.addEventListener("click",()=>{M.user=m.dataset.user,Le[M.user]?.imageUrl?M.mode=Le[M.user].type||"gradient":M.mode="gradient",Ve()})}),document.querySelectorAll(".avatar-mode-btn").forEach(m=>{m.addEventListener("click",()=>{M.mode=m.dataset.mode,Ve()})});const f=document.getElementById("avatar-file-input");f&&f.addEventListener("change",async m=>{const d=m.target.files[0];if(d){document.getElementById("avatar-file-name").textContent=d.name,document.getElementById("avatar-file-name").classList.remove("hidden");const p=await Hr(d);p&&(M.imageUrl=p,Wt())}});const h=document.getElementById("avatar-url-input");h&&h.addEventListener("input",m=>{const d=m.target.value.trim();d&&(f&&(f.value=""),document.getElementById("avatar-file-name").textContent="",document.getElementById("avatar-file-name").classList.add("hidden"),M.imageUrl=d,Wt())})}const Pr=["#ef4444","#f97316","#f59e0b","#84cc16","#10b981","#06b6d4","#3b82f6","#6366f1","#8b5cf6","#d946ef","#f43f5e","#1f2937"],Nr=["cat.png","headphones.png","sofa.png","spider.png","ticket.png"];let M={user:"juainny",mode:"gradient",color1:"#3b82f6",color2:"#8b5cf6",icon:"cat.png",imageUrl:null},Le={};async function Mn(e){const t=document.getElementById("avatar-modal");if(!t)return;await Ye();const n=Le[e];n?M={...n,user:e,mode:n.type||"gradient"}:M={user:e,mode:"gradient",color1:e==="juainny"?"#8b5cf6":"#3b82f6",color2:e==="juainny"?"#d946ef":"#06b6d4",icon:"cat.png",imageUrl:null},Fr(),jr(),Ve();const a=document.getElementById("avatar-file-input");a&&(a.value=""),document.getElementById("avatar-file-name").textContent="",document.getElementById("avatar-file-name").classList.add("hidden"),t.classList.remove("hidden"),t.classList.remove("modal-hidden"),t.classList.add("flex")}function qt(){const e=document.getElementById("avatar-modal");e&&(e.classList.add("hidden"),e.classList.add("modal-hidden"),e.classList.remove("flex"))}function Ve(){document.querySelectorAll(".avatar-user-btn").forEach(n=>{n.dataset.user===M.user?n.classList.add("border-accent-primary","bg-bg-tertiary"):n.classList.remove("border-accent-primary","bg-bg-tertiary")}),document.querySelectorAll(".avatar-mode-btn").forEach(n=>{n.dataset.mode===M.mode?(n.classList.add("bg-bg-secondary","text-text-primary","shadow-sm"),n.classList.remove("text-text-muted","hover:text-text-primary")):(n.classList.remove("bg-bg-secondary","text-text-primary","shadow-sm"),n.classList.add("text-text-muted","hover:text-text-primary"))});const e=document.getElementById("avatar-gradient-controls"),t=document.getElementById("avatar-image-controls");M.mode==="gradient"?(e.classList.remove("hidden"),t.classList.add("hidden")):(e.classList.add("hidden"),t.classList.remove("hidden")),document.querySelectorAll(".color-option").forEach(n=>{const a=n.dataset.type,r=n.dataset.color;M[a]===r?n.classList.add("ring-2","ring-white"):n.classList.remove("ring-2","ring-white")}),document.querySelectorAll(".icon-option").forEach(n=>{n.dataset.icon===M.icon?n.classList.add("border-accent-primary","bg-bg-tertiary"):n.classList.remove("border-accent-primary","bg-bg-tertiary")}),Wt()}function Fr(){const e=(t,n)=>{const a=document.getElementById(t);a&&(a.innerHTML="",Pr.forEach(r=>{const o=document.createElement("button");o.className="color-option w-8 h-8 rounded-full cursor-pointer transition transform hover:scale-110",o.style.backgroundColor=r,o.dataset.color=r,o.dataset.type=n,o.addEventListener("click",()=>{M[n]=r,Ve()}),a.appendChild(o)}))};e("color-picker-1","color1"),e("color-picker-2","color2")}function jr(){const e=document.getElementById("icon-picker");e&&(e.innerHTML="",Nr.forEach(t=>{const n=document.createElement("button");n.className="icon-option p-2 rounded-lg border-2 border-transparent hover:bg-bg-tertiary transition flex items-center justify-center",n.dataset.icon=t,n.innerHTML=`<img src="avatars/${t}" class="w-8 h-8 object-contain">`,n.addEventListener("click",()=>{M.icon=t,Ve()}),e.appendChild(n)}))}function Wt(){const e=document.getElementById("avatar-preview-display");if(!e)return;const{color1:t,color2:n,icon:a,user:r,mode:o,imageUrl:s}=M;o==="image"&&s?(e.style.background="none",e.innerHTML=`<img src="${s}" class="w-full h-full object-cover">`):(e.style.background=`linear-gradient(135deg, ${t}, ${n})`,a?e.innerHTML=`<img src="avatars/${a}" class="w-16 h-16 object-contain drop-shadow-md">`:e.innerHTML=`<span class="text-4xl font-bold text-white drop-shadow-md">${r[0].toUpperCase()}</span>`)}async function Hr(e){const t=`${Date.now()}-${e.name}`,{data:n,error:a}=await y.storage.from("images").upload(`avatars/${t}`,e);if(a)return console.error("Error uploading image:",a),alert("Failed to upload image. Please try again."),null;const{data:r}=y.storage.from("images").getPublicUrl(`avatars/${t}`);return r.publicUrl}async function Ur(){const{user:e,mode:t,color1:n,color2:a,icon:r,imageUrl:o}=M,s={type:t,color1:n,color2:a,icon:r,imageUrl:o};Le[e]=s;const i={};i[`${e}_avatar`]=s;const{error:l}=await y.from("settings").update(i).eq("id",1);if(l)console.error("Error saving avatar:",l),alert("Failed to save avatar. Please try again.");else{await Ye();const{refreshAllReactionAvatars:c}=await Rr(async()=>{const{refreshAllReactionAvatars:u}=await Promise.resolve().then(()=>Xl);return{refreshAllReactionAvatars:u}},void 0);c(),qt()}}function G(e,t="w-8 h-8"){const n=Le[e];if(!n)return`<div class="${t} rounded-full ${e==="juainny"?"bg-purple-500":"bg-blue-500"} flex items-center justify-center text-white font-bold border border-white/20 overflow-hidden">${e[0].toUpperCase()}</div>`;const{type:a,color1:r,color2:o,icon:s,imageUrl:i}=n;return a==="image"&&i?`
            <div class="${t} rounded-full border border-white/20 relative overflow-hidden">
                <img src="${i}" class="w-full h-full object-cover">
            </div>
        `:`
        <div class="${t} rounded-full flex items-center justify-center border border-white/20 relative overflow-hidden" 
             style="background: linear-gradient(135deg, ${r}, ${o});">
            <img src="avatars/${s}" class="w-[60%] h-[60%] object-contain drop-shadow-sm">
        </div>
    `}const qr=()=>{};var $n={};const Ea=function(e){const t=[];let n=0;for(let a=0;a<e.length;a++){let r=e.charCodeAt(a);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=r&63|128):(r&64512)===55296&&a+1<e.length&&(e.charCodeAt(a+1)&64512)===56320?(r=65536+((r&1023)<<10)+(e.charCodeAt(++a)&1023),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=r&63|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=r&63|128)}return t},Wr=function(e){const t=[];let n=0,a=0;for(;n<e.length;){const r=e[n++];if(r<128)t[a++]=String.fromCharCode(r);else if(r>191&&r<224){const o=e[n++];t[a++]=String.fromCharCode((r&31)<<6|o&63)}else if(r>239&&r<365){const o=e[n++],s=e[n++],i=e[n++],l=((r&7)<<18|(o&63)<<12|(s&63)<<6|i&63)-65536;t[a++]=String.fromCharCode(55296+(l>>10)),t[a++]=String.fromCharCode(56320+(l&1023))}else{const o=e[n++],s=e[n++];t[a++]=String.fromCharCode((r&15)<<12|(o&63)<<6|s&63)}}return t.join("")},cn={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let r=0;r<e.length;r+=3){const o=e[r],s=r+1<e.length,i=s?e[r+1]:0,l=r+2<e.length,c=l?e[r+2]:0,u=o>>2,f=(o&3)<<4|i>>4;let h=(i&15)<<2|c>>6,m=c&63;l||(m=64,s||(h=64)),a.push(n[u],n[f],n[h],n[m])}return a.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Ea(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):Wr(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let r=0;r<e.length;){const o=n[e.charAt(r++)],i=r<e.length?n[e.charAt(r)]:0;++r;const c=r<e.length?n[e.charAt(r)]:64;++r;const f=r<e.length?n[e.charAt(r)]:64;if(++r,o==null||i==null||c==null||f==null)throw new Vr;const h=o<<2|i>>4;if(a.push(h),c!==64){const m=i<<4&240|c>>2;if(a.push(m),f!==64){const d=c<<6&192|f;a.push(d)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Vr extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const zr=function(e){const t=Ea(e);return cn.encodeByteArray(t,!0)},Ia=function(e){return zr(e).replace(/\./g,"")},Gr=function(e){try{return cn.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function ka(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Kr=()=>ka().__FIREBASE_DEFAULTS__,Yr=()=>{if(typeof process>"u"||typeof $n>"u")return;const e=$n.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},Jr=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&Gr(e[1]);return t&&JSON.parse(t)},Xr=()=>{try{return qr()||Kr()||Yr()||Jr()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},Ta=()=>Xr()?.config;class ze{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,n)=>{this.resolve=t,this.reject=n})}wrapCallback(t){return(n,a)=>{n?this.reject(n):this.resolve(a),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(n):t(n,a))}}}function Qr(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function vt(){try{return typeof indexedDB=="object"}catch{return!1}}function La(){return new Promise((e,t)=>{try{let n=!0;const a="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(a);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(a),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{t(r.error?.message||"")}}catch(n){t(n)}})}function Zr(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}const eo="FirebaseError";class be extends Error{constructor(t,n,a){super(n),this.code=t,this.customData=a,this.name=eo,Object.setPrototypeOf(this,be.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Je.prototype.create)}}class Je{constructor(t,n,a){this.service=t,this.serviceName=n,this.errors=a}create(t,...n){const a=n[0]||{},r=`${this.service}/${t}`,o=this.errors[t],s=o?to(o,a):"Error",i=`${this.serviceName}: ${s} (${r}).`;return new be(r,i,a)}}function to(e,t){return e.replace(no,(n,a)=>{const r=t[a];return r!=null?String(r):`<${a}?>`})}const no=/\{\$([^}]+)}/g;function ft(e,t){if(e===t)return!0;const n=Object.keys(e),a=Object.keys(t);for(const r of n){if(!a.includes(r))return!1;const o=e[r],s=t[r];if(On(o)&&On(s)){if(!ft(o,s))return!1}else if(o!==s)return!1}for(const r of a)if(!n.includes(r))return!1;return!0}function On(e){return e!==null&&typeof e=="object"}const ao=1e3,ro=2,oo=14400*1e3,so=.5;function Vt(e,t=ao,n=ro){const a=t*Math.pow(n,e),r=Math.round(so*a*(Math.random()-.5)*2);return Math.min(oo,a+r)}function Xe(e){return e&&e._delegate?e._delegate:e}class Z{constructor(t,n,a){this.name=t,this.instanceFactory=n,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const we="[DEFAULT]";class io{constructor(t,n){this.name=t,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const n=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(n)){const a=new ze;if(this.instancesDeferred.set(n,a),this.isInitialized(n)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:n});r&&a.resolve(r)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(t){const n=this.normalizeInstanceIdentifier(t?.identifier),a=t?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(r){if(a)return null;throw r}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(lo(t))try{this.getOrInitializeService({instanceIdentifier:we})}catch{}for(const[n,a]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:r});a.resolve(o)}catch{}}}}clearInstance(t=we){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...t.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=we){return this.instances.has(t)}getOptions(t=we){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:n={}}=t,a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:a,options:n});for(const[o,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(o);a===i&&s.resolve(r)}return r}onInit(t,n){const a=this.normalizeInstanceIdentifier(n),r=this.onInitCallbacks.get(a)??new Set;r.add(t),this.onInitCallbacks.set(a,r);const o=this.instances.get(a);return o&&t(o,a),()=>{r.delete(t)}}invokeOnInitCallbacks(t,n){const a=this.onInitCallbacks.get(n);if(a)for(const r of a)try{r(t,n)}catch{}}getOrInitializeService({instanceIdentifier:t,options:n={}}){let a=this.instances.get(t);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:co(t),options:n}),this.instances.set(t,a),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(a,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,a)}catch{}return a||null}normalizeInstanceIdentifier(t=we){return this.component?this.component.multipleInstances?t:we:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function co(e){return e===we?void 0:e}function lo(e){return e.instantiationMode==="EAGER"}class uo{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const n=this.getProvider(t.name);if(n.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);n.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const n=new io(t,this);return this.providers.set(t,n),n}getProviders(){return Array.from(this.providers.values())}}var x;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(x||(x={}));const fo={debug:x.DEBUG,verbose:x.VERBOSE,info:x.INFO,warn:x.WARN,error:x.ERROR,silent:x.SILENT},mo=x.INFO,ho={[x.DEBUG]:"log",[x.VERBOSE]:"log",[x.INFO]:"info",[x.WARN]:"warn",[x.ERROR]:"error"},po=(e,t,...n)=>{if(t<e.logLevel)return;const a=new Date().toISOString(),r=ho[t];if(r)console[r](`[${a}]  ${e.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class _t{constructor(t){this.name=t,this._logLevel=mo,this._logHandler=po,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in x))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?fo[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,x.DEBUG,...t),this._logHandler(this,x.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,x.VERBOSE,...t),this._logHandler(this,x.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,x.INFO,...t),this._logHandler(this,x.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,x.WARN,...t),this._logHandler(this,x.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,x.ERROR,...t),this._logHandler(this,x.ERROR,...t)}}const go=(e,t)=>t.some(n=>e instanceof n);let Pn,Nn;function yo(){return Pn||(Pn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function bo(){return Nn||(Nn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Sa=new WeakMap,zt=new WeakMap,Aa=new WeakMap,Rt=new WeakMap,ln=new WeakMap;function wo(e){const t=new Promise((n,a)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{n(pe(e.result)),r()},s=()=>{a(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",s)});return t.then(n=>{n instanceof IDBCursor&&Sa.set(n,e)}).catch(()=>{}),ln.set(t,e),t}function vo(e){if(zt.has(e))return;const t=new Promise((n,a)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{n(),r()},s=()=>{a(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)});zt.set(e,t)}let Gt={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return zt.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Aa.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return pe(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function _o(e){Gt=e(Gt)}function Eo(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const a=e.call(Bt(this),t,...n);return Aa.set(a,t.sort?t.sort():[t]),pe(a)}:bo().includes(e)?function(...t){return e.apply(Bt(this),t),pe(Sa.get(this))}:function(...t){return pe(e.apply(Bt(this),t))}}function Io(e){return typeof e=="function"?Eo(e):(e instanceof IDBTransaction&&vo(e),go(e,yo())?new Proxy(e,Gt):e)}function pe(e){if(e instanceof IDBRequest)return wo(e);if(Rt.has(e))return Rt.get(e);const t=Io(e);return t!==e&&(Rt.set(e,t),ln.set(t,e)),t}const Bt=e=>ln.get(e);function xa(e,t,{blocked:n,upgrade:a,blocking:r,terminated:o}={}){const s=indexedDB.open(e,t),i=pe(s);return a&&s.addEventListener("upgradeneeded",l=>{a(pe(s.result),l.oldVersion,l.newVersion,pe(s.transaction),l)}),n&&s.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),i.then(l=>{o&&l.addEventListener("close",()=>o()),r&&l.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),i}const ko=["get","getKey","getAll","getAllKeys","count"],To=["put","add","delete","clear"],Dt=new Map;function Fn(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(Dt.get(t))return Dt.get(t);const n=t.replace(/FromIndex$/,""),a=t!==n,r=To.includes(n);if(!(n in(a?IDBIndex:IDBObjectStore).prototype)||!(r||ko.includes(n)))return;const o=async function(s,...i){const l=this.transaction(s,r?"readwrite":"readonly");let c=l.store;return a&&(c=c.index(i.shift())),(await Promise.all([c[n](...i),r&&l.done]))[0]};return Dt.set(t,o),o}_o(e=>({...e,get:(t,n,a)=>Fn(t,n)||e.get(t,n,a),has:(t,n)=>!!Fn(t,n)||e.has(t,n)}));class Lo{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(So(n)){const a=n.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(n=>n).join(" ")}}function So(e){return e.getComponent()?.type==="VERSION"}const Kt="@firebase/app",jn="0.14.6";const ie=new _t("@firebase/app"),Ao="@firebase/app-compat",xo="@firebase/analytics-compat",Co="@firebase/analytics",Ro="@firebase/app-check-compat",Bo="@firebase/app-check",Do="@firebase/auth",Mo="@firebase/auth-compat",$o="@firebase/database",Oo="@firebase/data-connect",Po="@firebase/database-compat",No="@firebase/functions",Fo="@firebase/functions-compat",jo="@firebase/installations",Ho="@firebase/installations-compat",Uo="@firebase/messaging",qo="@firebase/messaging-compat",Wo="@firebase/performance",Vo="@firebase/performance-compat",zo="@firebase/remote-config",Go="@firebase/remote-config-compat",Ko="@firebase/storage",Yo="@firebase/storage-compat",Jo="@firebase/firestore",Xo="@firebase/ai",Qo="@firebase/firestore-compat",Zo="firebase";const Yt="[DEFAULT]",es={[Kt]:"fire-core",[Ao]:"fire-core-compat",[Co]:"fire-analytics",[xo]:"fire-analytics-compat",[Bo]:"fire-app-check",[Ro]:"fire-app-check-compat",[Do]:"fire-auth",[Mo]:"fire-auth-compat",[$o]:"fire-rtdb",[Oo]:"fire-data-connect",[Po]:"fire-rtdb-compat",[No]:"fire-fn",[Fo]:"fire-fn-compat",[jo]:"fire-iid",[Ho]:"fire-iid-compat",[Uo]:"fire-fcm",[qo]:"fire-fcm-compat",[Wo]:"fire-perf",[Vo]:"fire-perf-compat",[zo]:"fire-rc",[Go]:"fire-rc-compat",[Ko]:"fire-gcs",[Yo]:"fire-gcs-compat",[Jo]:"fire-fst",[Qo]:"fire-fst-compat",[Xo]:"fire-vertex","fire-js":"fire-js",[Zo]:"fire-js-all"};const mt=new Map,ts=new Map,Jt=new Map;function Hn(e,t){try{e.container.addComponent(t)}catch(n){ie.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function se(e){const t=e.name;if(Jt.has(t))return ie.debug(`There were multiple attempts to register component ${t}.`),!1;Jt.set(t,e);for(const n of mt.values())Hn(n,e);for(const n of ts.values())Hn(n,e);return!0}function xe(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function ns(e){return e==null?!1:e.settings!==void 0}const as={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ge=new Je("app","Firebase",as);class rs{constructor(t,n,a){this._isDeleted=!1,this._options={...t},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Z("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ge.create("app-deleted",{appName:this._name})}}function Ca(e,t={}){let n=e;typeof t!="object"&&(t={name:t});const a={name:Yt,automaticDataCollectionEnabled:!0,...t},r=a.name;if(typeof r!="string"||!r)throw ge.create("bad-app-name",{appName:String(r)});if(n||(n=Ta()),!n)throw ge.create("no-options");const o=mt.get(r);if(o){if(ft(n,o.options)&&ft(a,o.config))return o;throw ge.create("duplicate-app",{appName:r})}const s=new uo(r);for(const l of Jt.values())s.addComponent(l);const i=new rs(n,a,s);return mt.set(r,i),i}function dn(e=Yt){const t=mt.get(e);if(!t&&e===Yt&&Ta())return Ca();if(!t)throw ge.create("no-app",{appName:e});return t}function Q(e,t,n){let a=es[e]??e;n&&(a+=`-${n}`);const r=a.match(/\s|\//),o=t.match(/\s|\//);if(r||o){const s=[`Unable to register library "${a}" with version "${t}":`];r&&s.push(`library name "${a}" contains illegal characters (whitespace or "/")`),r&&o&&s.push("and"),o&&s.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ie.warn(s.join(" "));return}se(new Z(`${a}-version`,()=>({library:a,version:t}),"VERSION"))}const os="firebase-heartbeat-database",ss=1,Ge="firebase-heartbeat-store";let Mt=null;function Ra(){return Mt||(Mt=xa(os,ss,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(Ge)}catch(n){console.warn(n)}}}}).catch(e=>{throw ge.create("idb-open",{originalErrorMessage:e.message})})),Mt}async function is(e){try{const n=(await Ra()).transaction(Ge),a=await n.objectStore(Ge).get(Ba(e));return await n.done,a}catch(t){if(t instanceof be)ie.warn(t.message);else{const n=ge.create("idb-get",{originalErrorMessage:t?.message});ie.warn(n.message)}}}async function Un(e,t){try{const a=(await Ra()).transaction(Ge,"readwrite");await a.objectStore(Ge).put(t,Ba(e)),await a.done}catch(n){if(n instanceof be)ie.warn(n.message);else{const a=ge.create("idb-set",{originalErrorMessage:n?.message});ie.warn(a.message)}}}function Ba(e){return`${e.name}!${e.options.appId}`}const cs=1024,ls=30;class ds{constructor(t){this.container=t,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new fs(n),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=qn();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(r=>r.date===a))return;if(this._heartbeatsCache.heartbeats.push({date:a,agent:n}),this._heartbeatsCache.heartbeats.length>ls){const r=ms(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){ie.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=qn(),{heartbeatsToSend:n,unsentEntries:a}=us(this._heartbeatsCache.heartbeats),r=Ia(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,a.length>0?(this._heartbeatsCache.heartbeats=a,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(t){return ie.warn(t),""}}}function qn(){return new Date().toISOString().substring(0,10)}function us(e,t=cs){const n=[];let a=e.slice();for(const r of e){const o=n.find(s=>s.agent===r.agent);if(o){if(o.dates.push(r.date),Wn(n)>t){o.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Wn(n)>t){n.pop();break}a=a.slice(1)}return{heartbeatsToSend:n,unsentEntries:a}}class fs{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return vt()?La().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await is(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const a=await this.read();return Un(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const a=await this.read();return Un(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...t.heartbeats]})}else return}}function Wn(e){return Ia(JSON.stringify({version:2,heartbeats:e})).length}function ms(e){if(e.length===0)return-1;let t=0,n=e[0].date;for(let a=1;a<e.length;a++)e[a].date<n&&(n=e[a].date,t=a);return t}function hs(e){se(new Z("platform-logger",t=>new Lo(t),"PRIVATE")),se(new Z("heartbeat",t=>new ds(t),"PRIVATE")),Q(Kt,jn,e),Q(Kt,jn,"esm2020"),Q("fire-js","")}hs("");var ps="firebase",gs="12.6.0";Q(ps,gs,"app");const Da="@firebase/installations",un="0.6.19";const Ma=1e4,$a=`w:${un}`,Oa="FIS_v2",ys="https://firebaseinstallations.googleapis.com/v1",bs=3600*1e3,ws="installations",vs="Installations";const _s={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Se=new Je(ws,vs,_s);function Pa(e){return e instanceof be&&e.code.includes("request-failed")}function Na({projectId:e}){return`${ys}/projects/${e}/installations`}function Fa(e){return{token:e.token,requestStatus:2,expiresIn:Is(e.expiresIn),creationTime:Date.now()}}async function ja(e,t){const a=(await t.json()).error;return Se.create("request-failed",{requestName:e,serverCode:a.code,serverMessage:a.message,serverStatus:a.status})}function Ha({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function Es(e,{refreshToken:t}){const n=Ha(e);return n.append("Authorization",ks(t)),n}async function Ua(e){const t=await e();return t.status>=500&&t.status<600?e():t}function Is(e){return Number(e.replace("s","000"))}function ks(e){return`${Oa} ${e}`}async function Ts({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const a=Na(e),r=Ha(e),o=t.getImmediate({optional:!0});if(o){const c=await o.getHeartbeatsHeader();c&&r.append("x-firebase-client",c)}const s={fid:n,authVersion:Oa,appId:e.appId,sdkVersion:$a},i={method:"POST",headers:r,body:JSON.stringify(s)},l=await Ua(()=>fetch(a,i));if(l.ok){const c=await l.json();return{fid:c.fid||n,registrationStatus:2,refreshToken:c.refreshToken,authToken:Fa(c.authToken)}}else throw await ja("Create Installation",l)}function qa(e){return new Promise(t=>{setTimeout(t,e)})}function Ls(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")}const Ss=/^[cdef][\w-]{21}$/,Xt="";function As(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const n=xs(e);return Ss.test(n)?n:Xt}catch{return Xt}}function xs(e){return Ls(e).substr(0,22)}function Et(e){return`${e.appName}!${e.appId}`}const Wa=new Map;function Va(e,t){const n=Et(e);za(n,t),Cs(n,t)}function za(e,t){const n=Wa.get(e);if(n)for(const a of n)a(t)}function Cs(e,t){const n=Rs();n&&n.postMessage({key:e,fid:t}),Bs()}let Ie=null;function Rs(){return!Ie&&"BroadcastChannel"in self&&(Ie=new BroadcastChannel("[Firebase] FID Change"),Ie.onmessage=e=>{za(e.data.key,e.data.fid)}),Ie}function Bs(){Wa.size===0&&Ie&&(Ie.close(),Ie=null)}const Ds="firebase-installations-database",Ms=1,Ae="firebase-installations-store";let $t=null;function fn(){return $t||($t=xa(Ds,Ms,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(Ae)}}})),$t}async function ht(e,t){const n=Et(e),r=(await fn()).transaction(Ae,"readwrite"),o=r.objectStore(Ae),s=await o.get(n);return await o.put(t,n),await r.done,(!s||s.fid!==t.fid)&&Va(e,t.fid),t}async function Ga(e){const t=Et(e),a=(await fn()).transaction(Ae,"readwrite");await a.objectStore(Ae).delete(t),await a.done}async function It(e,t){const n=Et(e),r=(await fn()).transaction(Ae,"readwrite"),o=r.objectStore(Ae),s=await o.get(n),i=t(s);return i===void 0?await o.delete(n):await o.put(i,n),await r.done,i&&(!s||s.fid!==i.fid)&&Va(e,i.fid),i}async function mn(e){let t;const n=await It(e.appConfig,a=>{const r=$s(a),o=Os(e,r);return t=o.registrationPromise,o.installationEntry});return n.fid===Xt?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}function $s(e){const t=e||{fid:As(),registrationStatus:0};return Ka(t)}function Os(e,t){if(t.registrationStatus===0){if(!navigator.onLine){const r=Promise.reject(Se.create("app-offline"));return{installationEntry:t,registrationPromise:r}}const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},a=Ps(e,n);return{installationEntry:n,registrationPromise:a}}else return t.registrationStatus===1?{installationEntry:t,registrationPromise:Ns(e)}:{installationEntry:t}}async function Ps(e,t){try{const n=await Ts(e,t);return ht(e.appConfig,n)}catch(n){throw Pa(n)&&n.customData.serverCode===409?await Ga(e.appConfig):await ht(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}async function Ns(e){let t=await Vn(e.appConfig);for(;t.registrationStatus===1;)await qa(100),t=await Vn(e.appConfig);if(t.registrationStatus===0){const{installationEntry:n,registrationPromise:a}=await mn(e);return a||n}return t}function Vn(e){return It(e,t=>{if(!t)throw Se.create("installation-not-found");return Ka(t)})}function Ka(e){return Fs(e)?{fid:e.fid,registrationStatus:0}:e}function Fs(e){return e.registrationStatus===1&&e.registrationTime+Ma<Date.now()}async function js({appConfig:e,heartbeatServiceProvider:t},n){const a=Hs(e,n),r=Es(e,n),o=t.getImmediate({optional:!0});if(o){const c=await o.getHeartbeatsHeader();c&&r.append("x-firebase-client",c)}const s={installation:{sdkVersion:$a,appId:e.appId}},i={method:"POST",headers:r,body:JSON.stringify(s)},l=await Ua(()=>fetch(a,i));if(l.ok){const c=await l.json();return Fa(c)}else throw await ja("Generate Auth Token",l)}function Hs(e,{fid:t}){return`${Na(e)}/${t}/authTokens:generate`}async function hn(e,t=!1){let n;const a=await It(e.appConfig,o=>{if(!Ya(o))throw Se.create("not-registered");const s=o.authToken;if(!t&&Ws(s))return o;if(s.requestStatus===1)return n=Us(e,t),o;{if(!navigator.onLine)throw Se.create("app-offline");const i=zs(o);return n=qs(e,i),i}});return n?await n:a.authToken}async function Us(e,t){let n=await zn(e.appConfig);for(;n.authToken.requestStatus===1;)await qa(100),n=await zn(e.appConfig);const a=n.authToken;return a.requestStatus===0?hn(e,t):a}function zn(e){return It(e,t=>{if(!Ya(t))throw Se.create("not-registered");const n=t.authToken;return Gs(n)?{...t,authToken:{requestStatus:0}}:t})}async function qs(e,t){try{const n=await js(e,t),a={...t,authToken:n};return await ht(e.appConfig,a),n}catch(n){if(Pa(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await Ga(e.appConfig);else{const a={...t,authToken:{requestStatus:0}};await ht(e.appConfig,a)}throw n}}function Ya(e){return e!==void 0&&e.registrationStatus===2}function Ws(e){return e.requestStatus===2&&!Vs(e)}function Vs(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+bs}function zs(e){const t={requestStatus:1,requestTime:Date.now()};return{...e,authToken:t}}function Gs(e){return e.requestStatus===1&&e.requestTime+Ma<Date.now()}async function Ks(e){const t=e,{installationEntry:n,registrationPromise:a}=await mn(t);return a?a.catch(console.error):hn(t).catch(console.error),n.fid}async function Ys(e,t=!1){const n=e;return await Js(n),(await hn(n,t)).token}async function Js(e){const{registrationPromise:t}=await mn(e);t&&await t}function Xs(e){if(!e||!e.options)throw Ot("App Configuration");if(!e.name)throw Ot("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw Ot(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}function Ot(e){return Se.create("missing-app-config-values",{valueName:e})}const Ja="installations",Qs="installations-internal",Zs=e=>{const t=e.getProvider("app").getImmediate(),n=Xs(t),a=xe(t,"heartbeat");return{app:t,appConfig:n,heartbeatServiceProvider:a,_delete:()=>Promise.resolve()}},ei=e=>{const t=e.getProvider("app").getImmediate(),n=xe(t,Ja).getImmediate();return{getId:()=>Ks(n),getToken:r=>Ys(n,r)}};function ti(){se(new Z(Ja,Zs,"PUBLIC")),se(new Z(Qs,ei,"PRIVATE"))}ti();Q(Da,un);Q(Da,un,"esm2020");const pt="analytics",ni="firebase_id",ai="origin",ri=60*1e3,oi="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",pn="https://www.googletagmanager.com/gtag/js";const H=new _t("@firebase/analytics");const si={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},K=new Je("analytics","Analytics",si);function ii(e){if(!e.startsWith(pn)){const t=K.create("invalid-gtag-resource",{gtagURL:e});return H.warn(t.message),""}return e}function Xa(e){return Promise.all(e.map(t=>t.catch(n=>n)))}function ci(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(e,t)),n}function li(e,t){const n=ci("firebase-js-sdk-policy",{createScriptURL:ii}),a=document.createElement("script"),r=`${pn}?l=${e}&id=${t}`;a.src=n?n?.createScriptURL(r):r,a.async=!0,document.head.appendChild(a)}function di(e){let t=[];return Array.isArray(window[e])?t=window[e]:window[e]=t,t}async function ui(e,t,n,a,r,o){const s=a[r];try{if(s)await t[s];else{const l=(await Xa(n)).find(c=>c.measurementId===r);l&&await t[l.appId]}}catch(i){H.error(i)}e("config",r,o)}async function fi(e,t,n,a,r){try{let o=[];if(r&&r.send_to){let s=r.send_to;Array.isArray(s)||(s=[s]);const i=await Xa(n);for(const l of s){const c=i.find(f=>f.measurementId===l),u=c&&t[c.appId];if(u)o.push(u);else{o=[];break}}}o.length===0&&(o=Object.values(t)),await Promise.all(o),e("event",a,r||{})}catch(o){H.error(o)}}function mi(e,t,n,a){async function r(o,...s){try{if(o==="event"){const[i,l]=s;await fi(e,t,n,i,l)}else if(o==="config"){const[i,l]=s;await ui(e,t,n,a,i,l)}else if(o==="consent"){const[i,l]=s;e("consent",i,l)}else if(o==="get"){const[i,l,c]=s;e("get",i,l,c)}else if(o==="set"){const[i]=s;e("set",i)}else e(o,...s)}catch(i){H.error(i)}}return r}function hi(e,t,n,a,r){let o=function(...s){window[a].push(arguments)};return window[r]&&typeof window[r]=="function"&&(o=window[r]),window[r]=mi(o,e,t,n),{gtagCore:o,wrappedGtag:window[r]}}function pi(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(pn)&&n.src.includes(e))return n;return null}const gi=30,yi=1e3;class bi{constructor(t={},n=yi){this.throttleMetadata=t,this.intervalMillis=n}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,n){this.throttleMetadata[t]=n}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}}const Qa=new bi;function wi(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function vi(e){const{appId:t,apiKey:n}=e,a={method:"GET",headers:wi(n)},r=oi.replace("{app-id}",t),o=await fetch(r,a);if(o.status!==200&&o.status!==304){let s="";try{const i=await o.json();i.error?.message&&(s=i.error.message)}catch{}throw K.create("config-fetch-failed",{httpStatus:o.status,responseMessage:s})}return o.json()}async function _i(e,t=Qa,n){const{appId:a,apiKey:r,measurementId:o}=e.options;if(!a)throw K.create("no-app-id");if(!r){if(o)return{measurementId:o,appId:a};throw K.create("no-api-key")}const s=t.getThrottleMetadata(a)||{backoffCount:0,throttleEndTimeMillis:Date.now()},i=new ki;return setTimeout(async()=>{i.abort()},ri),Za({appId:a,apiKey:r,measurementId:o},s,i,t)}async function Za(e,{throttleEndTimeMillis:t,backoffCount:n},a,r=Qa){const{appId:o,measurementId:s}=e;try{await Ei(a,t)}catch(i){if(s)return H.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${s} provided in the "measurementId" field in the local Firebase config. [${i?.message}]`),{appId:o,measurementId:s};throw i}try{const i=await vi(e);return r.deleteThrottleMetadata(o),i}catch(i){const l=i;if(!Ii(l)){if(r.deleteThrottleMetadata(o),s)return H.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${s} provided in the "measurementId" field in the local Firebase config. [${l?.message}]`),{appId:o,measurementId:s};throw i}const c=Number(l?.customData?.httpStatus)===503?Vt(n,r.intervalMillis,gi):Vt(n,r.intervalMillis),u={throttleEndTimeMillis:Date.now()+c,backoffCount:n+1};return r.setThrottleMetadata(o,u),H.debug(`Calling attemptFetch again in ${c} millis`),Za(e,u,a,r)}}function Ei(e,t){return new Promise((n,a)=>{const r=Math.max(t-Date.now(),0),o=setTimeout(n,r);e.addEventListener(()=>{clearTimeout(o),a(K.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function Ii(e){if(!(e instanceof be)||!e.customData)return!1;const t=Number(e.customData.httpStatus);return t===429||t===500||t===503||t===504}class ki{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach(t=>t())}}async function Ti(e,t,n,a,r){if(r&&r.global){e("event",n,a);return}else{const o=await t,s={...a,send_to:o};e("event",n,s)}}async function Li(e,t,n,a){if(a&&a.global){const r={};for(const o of Object.keys(n))r[`user_properties.${o}`]=n[o];return e("set",r),Promise.resolve()}else{const r=await t;e("config",r,{update:!0,user_properties:n})}}async function Si(){if(vt())try{await La()}catch(e){return H.warn(K.create("indexeddb-unavailable",{errorInfo:e?.toString()}).message),!1}else return H.warn(K.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Ai(e,t,n,a,r,o,s){const i=_i(e);i.then(h=>{n[h.measurementId]=h.appId,e.options.measurementId&&h.measurementId!==e.options.measurementId&&H.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${h.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(h=>H.error(h)),t.push(i);const l=Si().then(h=>{if(h)return a.getId()}),[c,u]=await Promise.all([i,l]);pi(o)||li(o,c.measurementId),r("js",new Date);const f=s?.config??{};return f[ai]="firebase",f.update=!0,u!=null&&(f[ni]=u),r("config",c.measurementId,f),c.measurementId}class xi{constructor(t){this.app=t}_delete(){return delete $e[this.app.options.appId],Promise.resolve()}}let $e={},Gn=[];const Kn={};let Pt="dataLayer",Ci="gtag",Yn,gn,Jn=!1;function Ri(){const e=[];if(Qr()&&e.push("This is a browser extension environment."),Zr()||e.push("Cookies are not available."),e.length>0){const t=e.map((a,r)=>`(${r+1}) ${a}`).join(" "),n=K.create("invalid-analytics-context",{errorInfo:t});H.warn(n.message)}}function Bi(e,t,n){Ri();const a=e.options.appId;if(!a)throw K.create("no-app-id");if(!e.options.apiKey)if(e.options.measurementId)H.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw K.create("no-api-key");if($e[a]!=null)throw K.create("already-exists",{id:a});if(!Jn){di(Pt);const{wrappedGtag:o,gtagCore:s}=hi($e,Gn,Kn,Pt,Ci);gn=o,Yn=s,Jn=!0}return $e[a]=Ai(e,Gn,Kn,t,Yn,Pt,n),new xi(e)}function Di(e=dn()){e=Xe(e);const t=xe(e,pt);return t.isInitialized()?t.getImmediate():Mi(e)}function Mi(e,t={}){const n=xe(e,pt);if(n.isInitialized()){const r=n.getImmediate();if(ft(t,n.getOptions()))return r;throw K.create("already-initialized")}return n.initialize({options:t})}function $i(e,t,n){e=Xe(e),Li(gn,$e[e.app.options.appId],t,n).catch(a=>H.error(a))}function Oi(e,t,n,a){e=Xe(e),Ti(gn,$e[e.app.options.appId],t,n,a).catch(r=>H.error(r))}const Xn="@firebase/analytics",Qn="0.10.19";function Pi(){se(new Z(pt,(t,{options:n})=>{const a=t.getProvider("app").getImmediate(),r=t.getProvider("installations-internal").getImmediate();return Bi(a,r,n)},"PUBLIC")),se(new Z("analytics-internal",e,"PRIVATE")),Q(Xn,Qn),Q(Xn,Qn,"esm2020");function e(t){try{const n=t.getProvider(pt).getImmediate();return{logEvent:(a,r,o)=>Oi(n,a,r,o),setUserProperties:(a,r)=>$i(n,a,r)}}catch(n){throw K.create("interop-component-reg-failed",{reason:n})}}}Pi();const Qt=new Map,er={activated:!1,tokenObservers:[]},Ni={initialized:!1,enabled:!1};function $(e){return Qt.get(e)||{...er}}function Fi(e,t){return Qt.set(e,t),Qt.get(e)}function kt(){return Ni}const tr="https://content-firebaseappcheck.googleapis.com/v1",ji="exchangeRecaptchaV3Token",Hi="exchangeDebugToken",Zn={RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:960*1e3},Ui=1440*60*1e3;class qi{constructor(t,n,a,r,o){if(this.operation=t,this.retryPolicy=n,this.getWaitDuration=a,this.lowerBound=r,this.upperBound=o,this.pending=null,this.nextErrorWaitInterval=r,r>o)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(t){this.stop();try{this.pending=new ze,this.pending.promise.catch(n=>{}),await Wi(this.getNextRun(t)),this.pending.resolve(),await this.pending.promise,this.pending=new ze,this.pending.promise.catch(n=>{}),await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(n){this.retryPolicy(n)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(t){if(t)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const n=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),n}}}function Wi(e){return new Promise(t=>{setTimeout(t,e)})}const Vi={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},W=new Je("appCheck","AppCheck",Vi);function ea(e=!1){return e?self.grecaptcha?.enterprise:self.grecaptcha}function yn(e){if(!$(e).activated)throw W.create("use-before-activation",{appName:e.name})}function nr(e){const t=Math.round(e/1e3),n=Math.floor(t/(3600*24)),a=Math.floor((t-n*3600*24)/3600),r=Math.floor((t-n*3600*24-a*3600)/60),o=t-n*3600*24-a*3600-r*60;let s="";return n&&(s+=rt(n)+"d:"),a&&(s+=rt(a)+"h:"),s+=rt(r)+"m:"+rt(o)+"s",s}function rt(e){return e===0?"00":e>=10?e.toString():"0"+e}async function bn({url:e,body:t},n){const a={"Content-Type":"application/json"},r=n.getImmediate({optional:!0});if(r){const f=await r.getHeartbeatsHeader();f&&(a["X-Firebase-Client"]=f)}const o={method:"POST",body:JSON.stringify(t),headers:a};let s;try{s=await fetch(e,o)}catch(f){throw W.create("fetch-network-error",{originalErrorMessage:f?.message})}if(s.status!==200)throw W.create("fetch-status-error",{httpStatus:s.status});let i;try{i=await s.json()}catch(f){throw W.create("fetch-parse-error",{originalErrorMessage:f?.message})}const l=i.ttl.match(/^([\d.]+)(s)$/);if(!l||!l[2]||isNaN(Number(l[1])))throw W.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${i.ttl}`});const c=Number(l[1])*1e3,u=Date.now();return{token:i.token,expireTimeMillis:u+c,issuedAtTimeMillis:u}}function zi(e,t){const{projectId:n,appId:a,apiKey:r}=e.options;return{url:`${tr}/projects/${n}/apps/${a}:${ji}?key=${r}`,body:{recaptcha_v3_token:t}}}function ar(e,t){const{projectId:n,appId:a,apiKey:r}=e.options;return{url:`${tr}/projects/${n}/apps/${a}:${Hi}?key=${r}`,body:{debug_token:t}}}const Gi="firebase-app-check-database",Ki=1,Ke="firebase-app-check-store",rr="debug-token";let ot=null;function or(){return ot||(ot=new Promise((e,t)=>{try{const n=indexedDB.open(Gi,Ki);n.onsuccess=a=>{e(a.target.result)},n.onerror=a=>{t(W.create("storage-open",{originalErrorMessage:a.target.error?.message}))},n.onupgradeneeded=a=>{const r=a.target.result;switch(a.oldVersion){case 0:r.createObjectStore(Ke,{keyPath:"compositeKey"})}}}catch(n){t(W.create("storage-open",{originalErrorMessage:n?.message}))}}),ot)}function Yi(e){return ir(cr(e))}function Ji(e,t){return sr(cr(e),t)}function Xi(e){return sr(rr,e)}function Qi(){return ir(rr)}async function sr(e,t){const a=(await or()).transaction(Ke,"readwrite"),o=a.objectStore(Ke).put({compositeKey:e,value:t});return new Promise((s,i)=>{o.onsuccess=l=>{s()},a.onerror=l=>{i(W.create("storage-set",{originalErrorMessage:l.target.error?.message}))}})}async function ir(e){const n=(await or()).transaction(Ke,"readonly"),r=n.objectStore(Ke).get(e);return new Promise((o,s)=>{r.onsuccess=i=>{const l=i.target.result;o(l?l.value:void 0)},n.onerror=i=>{s(W.create("storage-get",{originalErrorMessage:i.target.error?.message}))}})}function cr(e){return`${e.options.appId}-${e.name}`}const me=new _t("@firebase/app-check");async function Zi(e){if(vt()){let t;try{t=await Yi(e)}catch(n){me.warn(`Failed to read token from IndexedDB. Error: ${n}`)}return t}}function Nt(e,t){return vt()?Ji(e,t).catch(n=>{me.warn(`Failed to write token to IndexedDB. Error: ${n}`)}):Promise.resolve()}async function ec(){let e;try{e=await Qi()}catch{}if(e)return e;{const t=crypto.randomUUID();return Xi(t).catch(n=>me.warn(`Failed to persist debug token to IndexedDB. Error: ${n}`)),t}}function wn(){return kt().enabled}async function vn(){const e=kt();if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}function tc(){const e=ka(),t=kt();if(t.initialized=!0,typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN!="string"&&e.FIREBASE_APPCHECK_DEBUG_TOKEN!==!0)return;t.enabled=!0;const n=new ze;t.token=n,typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN=="string"?n.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve(ec())}const nc={error:"UNKNOWN_ERROR"};function ac(e){return cn.encodeString(JSON.stringify(e),!1)}async function Zt(e,t=!1,n=!1){const a=e.app;yn(a);const r=$(a);let o=r.token,s;if(o&&!De(o)&&(r.token=void 0,o=void 0),!o){const c=await r.cachedTokenPromise;c&&(De(c)?o=c:await Nt(a,void 0))}if(!t&&o&&De(o))return{token:o.token};let i=!1;if(wn())try{r.exchangeTokenPromise||(r.exchangeTokenPromise=bn(ar(a,await vn()),e.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),i=!0);const c=await r.exchangeTokenPromise;return await Nt(a,c),r.token=c,{token:c.token}}catch(c){return c.code==="appCheck/throttled"||c.code==="appCheck/initial-throttle"?me.warn(c.message):n&&me.error(c),Ft(c)}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),i=!0),o=await $(a).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"||c.code==="appCheck/initial-throttle"?me.warn(c.message):n&&me.error(c),s=c}let l;return o?s?De(o)?l={token:o.token,internalError:s}:l=Ft(s):(l={token:o.token},r.token=o,await Nt(a,o)):l=Ft(s),i&&ur(a,l),l}async function rc(e){const t=e.app;yn(t);const{provider:n}=$(t);if(wn()){const a=await vn(),{token:r}=await bn(ar(t,a),e.heartbeatServiceProvider);return{token:r}}else{const{token:a}=await n.getToken();return{token:a}}}function lr(e,t,n,a){const{app:r}=e,o=$(r),s={next:n,error:a,type:t};if(o.tokenObservers=[...o.tokenObservers,s],o.token&&De(o.token)){const i=o.token;Promise.resolve().then(()=>{n({token:i.token}),ta(e)}).catch(()=>{})}o.cachedTokenPromise.then(()=>ta(e))}function dr(e,t){const n=$(e),a=n.tokenObservers.filter(r=>r.next!==t);a.length===0&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),n.tokenObservers=a}function ta(e){const{app:t}=e,n=$(t);let a=n.tokenRefresher;a||(a=oc(e),n.tokenRefresher=a),!a.isRunning()&&n.isTokenAutoRefreshEnabled&&a.start()}function oc(e){const{app:t}=e;return new qi(async()=>{const n=$(t);let a;if(n.token?a=await Zt(e,!0):a=await Zt(e),a.error)throw a.error;if(a.internalError)throw a.internalError},()=>!0,()=>{const n=$(t);if(n.token){let a=n.token.issuedAtTimeMillis+(n.token.expireTimeMillis-n.token.issuedAtTimeMillis)*.5+3e5;const r=n.token.expireTimeMillis-300*1e3;return a=Math.min(a,r),Math.max(0,a-Date.now())}else return 0},Zn.RETRIAL_MIN_WAIT,Zn.RETRIAL_MAX_WAIT)}function ur(e,t){const n=$(e).tokenObservers;for(const a of n)try{a.type==="EXTERNAL"&&t.error!=null?a.error(t.error):a.next(t)}catch{}}function De(e){return e.expireTimeMillis-Date.now()>0}function Ft(e){return{token:ac(nc),error:e}}class sc{constructor(t,n){this.app=t,this.heartbeatServiceProvider=n}_delete(){const{tokenObservers:t}=$(this.app);for(const n of t)dr(this.app,n.next);return Promise.resolve()}}function ic(e,t){return new sc(e,t)}function cc(e){return{getToken:t=>Zt(e,t),getLimitedUseToken:()=>rc(e),addTokenListener:t=>lr(e,"INTERNAL",t),removeTokenListener:t=>dr(e.app,t)}}const lc="@firebase/app-check",dc="0.11.0";const uc="https://www.google.com/recaptcha/api.js";function fc(e,t){const n=new ze,a=$(e);a.reCAPTCHAState={initialized:n};const r=mc(e),o=ea(!1);return o?na(e,t,o,r,n):gc(()=>{const s=ea(!1);if(!s)throw new Error("no recaptcha");na(e,t,s,r,n)}),n.promise}function na(e,t,n,a,r){n.ready(()=>{pc(e,t,n,a),r.resolve(n)})}function mc(e){const t=`fire_app_check_${e.name}`,n=document.createElement("div");return n.id=t,n.style.display="none",document.body.appendChild(n),t}async function hc(e){yn(e);const n=await $(e).reCAPTCHAState.initialized.promise;return new Promise((a,r)=>{const o=$(e).reCAPTCHAState;n.ready(()=>{a(n.execute(o.widgetId,{action:"fire_app_check"}))})})}function pc(e,t,n,a){const r=n.render(a,{sitekey:t,size:"invisible",callback:()=>{$(e).reCAPTCHAState.succeeded=!0},"error-callback":()=>{$(e).reCAPTCHAState.succeeded=!1}}),o=$(e);o.reCAPTCHAState={...o.reCAPTCHAState,widgetId:r}}function gc(e){const t=document.createElement("script");t.src=uc,t.onload=e,document.head.appendChild(t)}class _n{constructor(t){this._siteKey=t,this._throttleData=null}async getToken(){bc(this._throttleData);const t=await hc(this._app).catch(a=>{throw W.create("recaptcha-error")});if(!$(this._app).reCAPTCHAState?.succeeded)throw W.create("recaptcha-error");let n;try{n=await bn(zi(this._app,t),this._heartbeatServiceProvider)}catch(a){throw a.code?.includes("fetch-status-error")?(this._throttleData=yc(Number(a.customData?.httpStatus),this._throttleData),W.create("initial-throttle",{time:nr(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):a}return this._throttleData=null,n}initialize(t){this._app=t,this._heartbeatServiceProvider=xe(t,"heartbeat"),fc(t,this._siteKey).catch(()=>{})}isEqual(t){return t instanceof _n?this._siteKey===t._siteKey:!1}}function yc(e,t){if(e===404||e===403)return{backoffCount:1,allowRequestsAfter:Date.now()+Ui,httpStatus:e};{const n=t?t.backoffCount:0,a=Vt(n,1e3,2);return{backoffCount:n+1,allowRequestsAfter:Date.now()+a,httpStatus:e}}}function bc(e){if(e&&Date.now()-e.allowRequestsAfter<=0)throw W.create("throttled",{time:nr(e.allowRequestsAfter-Date.now()),httpStatus:e.httpStatus})}function wc(e=dn(),t){e=Xe(e);const n=xe(e,"app-check");if(kt().initialized||tc(),wn()&&vn().then(r=>console.log(`App Check debug token: ${r}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),n.isInitialized()){const r=n.getImmediate(),o=n.getOptions();if(o.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&o.provider.isEqual(t.provider))return r;throw W.create("already-initialized",{appName:e.name})}const a=n.initialize({options:t});return vc(e,t.provider,t.isTokenAutoRefreshEnabled),$(e).isTokenAutoRefreshEnabled&&lr(a,"INTERNAL",()=>{}),a}function vc(e,t,n=!1){const a=Fi(e,{...er});a.activated=!0,a.provider=t,a.cachedTokenPromise=Zi(e).then(r=>(r&&De(r)&&(a.token=r,ur(e,{token:r.token})),r)),a.isTokenAutoRefreshEnabled=n&&e.automaticDataCollectionEnabled,!e.automaticDataCollectionEnabled&&n&&me.warn("`isTokenAutoRefreshEnabled` is true but `automaticDataCollectionEnabled` was set to false during `initializeApp()`. This blocks automatic token refresh."),a.provider.initialize(e)}const _c="app-check",aa="app-check-internal";function Ec(){se(new Z(_c,e=>{const t=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat");return ic(t,n)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(aa).initialize()})),se(new Z(aa,e=>{const t=e.getProvider("app-check").getImmediate();return cc(t)},"PUBLIC").setInstantiationMode("EXPLICIT")),Q(lc,dc)}Ec();var ra="@firebase/ai",en="2.6.0";const Fe="AI",oa="us-central1",Ic="firebasevertexai.googleapis.com",gt="v1beta",sa=en,kc="gl-js",Tc=180*1e3,Lc="gemini-2.0-flash-lite";class k extends be{constructor(t,n,a){const r=Fe,o=`${r}/${t}`,s=`${r}: ${n} (${o})`;super(t,s),this.code=t,this.customErrorData=a,Error.captureStackTrace&&Error.captureStackTrace(this,k),Object.setPrototypeOf(this,k.prototype),this.toString=()=>s}}const ia=["user","model","function","system"],fr={HARM_SEVERITY_UNSUPPORTED:"HARM_SEVERITY_UNSUPPORTED"},ca={SAFETY:"SAFETY",RECITATION:"RECITATION"},ke={PREFER_ON_DEVICE:"prefer_on_device",ONLY_ON_DEVICE:"only_on_device",ONLY_IN_CLOUD:"only_in_cloud",PREFER_IN_CLOUD:"prefer_in_cloud"},ue={ON_DEVICE:"on_device",IN_CLOUD:"in_cloud"};const I={ERROR:"error",REQUEST_ERROR:"request-error",RESPONSE_ERROR:"response-error",FETCH_ERROR:"fetch-error",SESSION_CLOSED:"session-closed",INVALID_CONTENT:"invalid-content",API_NOT_ENABLED:"api-not-enabled",INVALID_SCHEMA:"invalid-schema",NO_API_KEY:"no-api-key",NO_APP_ID:"no-app-id",NO_MODEL:"no-model",NO_PROJECT_ID:"no-project-id",PARSE_FAILED:"parse-failed",UNSUPPORTED:"unsupported"};const ce={VERTEX_AI:"VERTEX_AI",GOOGLE_AI:"GOOGLE_AI"};class mr{constructor(t){this.backendType=t}}class Tt extends mr{constructor(){super(ce.GOOGLE_AI)}_getModelPath(t,n){return`/${gt}/projects/${t}/${n}`}_getTemplatePath(t,n){return`/${gt}/projects/${t}/templates/${n}`}}class En extends mr{constructor(t=oa){super(ce.VERTEX_AI),t?this.location=t:this.location=oa}_getModelPath(t,n){return`/${gt}/projects/${t}/locations/${this.location}/${n}`}_getTemplatePath(t,n){return`/${gt}/projects/${t}/locations/${this.location}/templates/${n}`}}function Sc(e){if(e instanceof Tt)return`${Fe}/googleai`;if(e instanceof En)return`${Fe}/vertexai/${e.location}`;throw new k(I.ERROR,`Invalid backend: ${JSON.stringify(e.backendType)}`)}function Ac(e){const t=e.split("/");if(t[0]!==Fe)throw new k(I.ERROR,`Invalid instance identifier, unknown prefix '${t[0]}'`);switch(t[1]){case"vertexai":const a=t[2];if(!a)throw new k(I.ERROR,`Invalid instance identifier, unknown location '${e}'`);return new En(a);case"googleai":return new Tt;default:throw new k(I.ERROR,`Invalid instance identifier string: '${e}'`)}}const q=new _t("@firebase/vertexai");var _e;(function(e){e.UNAVAILABLE="unavailable",e.DOWNLOADABLE="downloadable",e.DOWNLOADING="downloading",e.AVAILABLE="available"})(_e||(_e={}));const jt=[{type:"image"}];class X{constructor(t,n,a){this.languageModelProvider=t,this.mode=n,this.isDownloading=!1,this.onDeviceParams={createOptions:{expectedInputs:jt}},a&&(this.onDeviceParams=a,this.onDeviceParams.createOptions?this.onDeviceParams.createOptions.expectedInputs||(this.onDeviceParams.createOptions.expectedInputs=jt):this.onDeviceParams.createOptions={expectedInputs:jt})}async isAvailable(t){if(!this.mode)return q.debug("On-device inference unavailable because mode is undefined."),!1;if(this.mode===ke.ONLY_IN_CLOUD)return q.debug('On-device inference unavailable because mode is "only_in_cloud".'),!1;const n=await this.downloadIfAvailable();if(this.mode===ke.ONLY_ON_DEVICE){if(n===_e.UNAVAILABLE)throw new k(I.API_NOT_ENABLED,"Local LanguageModel API not available in this environment.");return(n===_e.DOWNLOADABLE||n===_e.DOWNLOADING)&&(q.debug("Waiting for download of LanguageModel to complete."),await this.downloadPromise),!0}return n!==_e.AVAILABLE?(q.debug(`On-device inference unavailable because availability is "${n}".`),!1):X.isOnDeviceRequest(t)?!0:(q.debug("On-device inference unavailable because request is incompatible."),!1)}async generateContent(t){const n=await this.createSession(),a=await Promise.all(t.contents.map(X.toLanguageModelMessage)),r=await n.prompt(a,this.onDeviceParams.promptOptions);return X.toResponse(r)}async generateContentStream(t){const n=await this.createSession(),a=await Promise.all(t.contents.map(X.toLanguageModelMessage)),r=n.promptStreaming(a,this.onDeviceParams.promptOptions);return X.toStreamResponse(r)}async countTokens(t){throw new k(I.REQUEST_ERROR,"Count Tokens is not yet available for on-device model.")}static isOnDeviceRequest(t){if(t.contents.length===0)return q.debug("Empty prompt rejected for on-device inference."),!1;for(const n of t.contents){if(n.role==="function")return q.debug('"Function" role rejected for on-device inference.'),!1;for(const a of n.parts)if(a.inlineData&&X.SUPPORTED_MIME_TYPES.indexOf(a.inlineData.mimeType)===-1)return q.debug(`Unsupported mime type "${a.inlineData.mimeType}" rejected for on-device inference.`),!1}return!0}async downloadIfAvailable(){const t=await this.languageModelProvider?.availability(this.onDeviceParams.createOptions);return t===_e.DOWNLOADABLE&&this.download(),t}download(){this.isDownloading||(this.isDownloading=!0,this.downloadPromise=this.languageModelProvider?.create(this.onDeviceParams.createOptions).finally(()=>{this.isDownloading=!1}))}static async toLanguageModelMessage(t){const n=await Promise.all(t.parts.map(X.toLanguageModelMessageContent));return{role:X.toLanguageModelMessageRole(t.role),content:n}}static async toLanguageModelMessageContent(t){if(t.text)return{type:"text",value:t.text};if(t.inlineData){const a=await(await fetch(`data:${t.inlineData.mimeType};base64,${t.inlineData.data}`)).blob();return{type:"image",value:await createImageBitmap(a)}}throw new k(I.REQUEST_ERROR,"Processing of this Part type is not currently supported.")}static toLanguageModelMessageRole(t){return t==="model"?"assistant":"user"}async createSession(){if(!this.languageModelProvider)throw new k(I.UNSUPPORTED,"Chrome AI requested for unsupported browser version.");const t=await this.languageModelProvider.create(this.onDeviceParams.createOptions);return this.oldSession&&this.oldSession.destroy(),this.oldSession=t,t}static toResponse(t){return{json:async()=>({candidates:[{content:{parts:[{text:t}]}}]})}}static toStreamResponse(t){const n=new TextEncoder;return{body:t.pipeThrough(new TransformStream({transform(a,r){const o=JSON.stringify({candidates:[{content:{role:"model",parts:[{text:a}]}}]});r.enqueue(n.encode(`data: ${o}

`))}}))}}}X.SUPPORTED_MIME_TYPES=["image/jpeg","image/png"];function xc(e,t,n){if(typeof t<"u"&&e)return new X(t.LanguageModel,e,n)}class Cc{constructor(t,n,a,r,o){this.app=t,this.backend=n,this.chromeAdapterFactory=o;const s=r?.getImmediate({optional:!0}),i=a?.getImmediate({optional:!0});this.auth=i||null,this.appCheck=s||null,n instanceof En?this.location=n.location:this.location=""}_delete(){return Promise.resolve()}set options(t){this._options=t}get options(){return this._options}}function Rc(e,{instanceIdentifier:t}){if(!t)throw new k(I.ERROR,"AIService instance identifier is undefined.");const n=Ac(t),a=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),o=e.getProvider("app-check-internal");return new Cc(a,n,r,o,xc)}function Bc(e){if(e.app?.options?.apiKey)if(e.app?.options?.projectId){if(!e.app?.options?.appId)throw new k(I.NO_APP_ID,'The "appId" field is empty in the local Firebase config. Firebase AI requires this field to contain a valid app ID.')}else throw new k(I.NO_PROJECT_ID,'The "projectId" field is empty in the local Firebase config. Firebase AI requires this field to contain a valid project ID.');else throw new k(I.NO_API_KEY,'The "apiKey" field is empty in the local Firebase config. Firebase AI requires this field to contain a valid API key.');const t={apiKey:e.app.options.apiKey,project:e.app.options.projectId,appId:e.app.options.appId,automaticDataCollectionEnabled:e.app.automaticDataCollectionEnabled,location:e.location,backend:e.backend};if(ns(e.app)&&e.app.settings.appCheckToken){const n=e.app.settings.appCheckToken;t.getAppCheckToken=()=>Promise.resolve({token:n})}else e.appCheck&&(e.options?.useLimitedUseAppCheckTokens?t.getAppCheckToken=()=>e.appCheck.getLimitedUseToken():t.getAppCheckToken=()=>e.appCheck.getToken());return e.auth&&(t.getAuthToken=()=>e.auth.getToken()),t}class Ue{constructor(t,n){this._apiSettings=Bc(t),this.model=Ue.normalizeModelName(n,this._apiSettings.backend.backendType)}static normalizeModelName(t,n){return n===ce.GOOGLE_AI?Ue.normalizeGoogleAIModelName(t):Ue.normalizeVertexAIModelName(t)}static normalizeGoogleAIModelName(t){return`models/${t}`}static normalizeVertexAIModelName(t){let n;return t.includes("/")?t.startsWith("models/")?n=`publishers/google/${t}`:n=t:n=`publishers/google/models/${t}`,n}}class Dc{constructor(t){this.params=t}toString(){const t=new URL(this.baseUrl);return t.pathname=this.pathname,t.search=this.queryParams.toString(),t.toString()}get pathname(){return this.params.templateId?`${this.params.apiSettings.backend._getTemplatePath(this.params.apiSettings.project,this.params.templateId)}:${this.params.task}`:`${this.params.apiSettings.backend._getModelPath(this.params.apiSettings.project,this.params.model)}:${this.params.task}`}get baseUrl(){return this.params.requestOptions?.baseUrl??`https://${Ic}`}get queryParams(){const t=new URLSearchParams;return this.params.stream&&t.set("alt","sse"),t}}function Mc(){const e=[];return e.push(`${kc}/${sa}`),e.push(`fire/${sa}`),e.join(" ")}async function $c(e){const t=new Headers;if(t.append("Content-Type","application/json"),t.append("x-goog-api-client",Mc()),t.append("x-goog-api-key",e.params.apiSettings.apiKey),e.params.apiSettings.automaticDataCollectionEnabled&&t.append("X-Firebase-Appid",e.params.apiSettings.appId),e.params.apiSettings.getAppCheckToken){const n=await e.params.apiSettings.getAppCheckToken();n&&(t.append("X-Firebase-AppCheck",n.token),n.error&&q.warn(`Unable to obtain a valid App Check token: ${n.error.message}`))}if(e.params.apiSettings.getAuthToken){const n=await e.params.apiSettings.getAuthToken();n&&t.append("Authorization",`Firebase ${n.accessToken}`)}return t}async function In(e,t){const n=new Dc(e);let a,r;try{const o={method:"POST",headers:await $c(n),body:t},s=e.requestOptions?.timeout!=null&&e.requestOptions.timeout>=0?e.requestOptions.timeout:Tc,i=new AbortController;if(r=setTimeout(()=>i.abort(),s),o.signal=i.signal,a=await fetch(n.toString(),o),!a.ok){let l="",c;try{const u=await a.json();l=u.error.message,u.error.details&&(l+=` ${JSON.stringify(u.error.details)}`,c=u.error.details)}catch{}throw a.status===403&&c&&c.some(u=>u.reason==="SERVICE_DISABLED")&&c.some(u=>u.links?.[0]?.description.includes("Google developers console API activation"))?new k(I.API_NOT_ENABLED,`The Firebase AI SDK requires the Firebase AI API ('firebasevertexai.googleapis.com') to be enabled in your Firebase project. Enable this API by visiting the Firebase Console at https://console.firebase.google.com/project/${n.params.apiSettings.project}/genai/ and clicking "Get started". If you enabled this API recently, wait a few minutes for the action to propagate to our systems and then retry.`,{status:a.status,statusText:a.statusText,errorDetails:c}):new k(I.FETCH_ERROR,`Error fetching from ${n}: [${a.status} ${a.statusText}] ${l}`,{status:a.status,statusText:a.statusText,errorDetails:c})}}catch(o){let s=o;throw o.code!==I.FETCH_ERROR&&o.code!==I.API_NOT_ENABLED&&o instanceof Error&&(s=new k(I.ERROR,`Error fetching from ${n.toString()}: ${o.message}`),s.stack=o.stack),s}finally{r&&clearTimeout(r)}return a}function st(e){if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&q.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),hr(e.candidates[0]))throw new k(I.RESPONSE_ERROR,`Response error: ${Te(e)}. Response body stored in error.response`,{response:e});return!0}else return!1}function yt(e,t=ue.IN_CLOUD){e.candidates&&!e.candidates[0].hasOwnProperty("index")&&(e.candidates[0].index=0);const n=Oc(e);return n.inferenceSource=t,n}function Oc(e){return e.text=()=>{if(st(e))return la(e,t=>!t.thought);if(e.promptFeedback)throw new k(I.RESPONSE_ERROR,`Text not available. ${Te(e)}`,{response:e});return""},e.thoughtSummary=()=>{if(st(e)){const t=la(e,n=>!!n.thought);return t===""?void 0:t}else if(e.promptFeedback)throw new k(I.RESPONSE_ERROR,`Thought summary not available. ${Te(e)}`,{response:e})},e.inlineDataParts=()=>{if(st(e))return Nc(e);if(e.promptFeedback)throw new k(I.RESPONSE_ERROR,`Data not available. ${Te(e)}`,{response:e})},e.functionCalls=()=>{if(st(e))return Pc(e);if(e.promptFeedback)throw new k(I.RESPONSE_ERROR,`Function call not available. ${Te(e)}`,{response:e})},e}function la(e,t){const n=[];if(e.candidates?.[0].content?.parts)for(const a of e.candidates?.[0].content?.parts)a.text&&t(a)&&n.push(a.text);return n.length>0?n.join(""):""}function Pc(e){const t=[];if(e.candidates?.[0].content?.parts)for(const n of e.candidates?.[0].content?.parts)n.functionCall&&t.push(n.functionCall);if(t.length>0)return t}function Nc(e){const t=[];if(e.candidates?.[0].content?.parts)for(const n of e.candidates?.[0].content?.parts)n.inlineData&&t.push(n);if(t.length>0)return t}const Fc=[ca.RECITATION,ca.SAFETY];function hr(e){return!!e.finishReason&&Fc.some(t=>t===e.finishReason)}function Te(e){let t="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)t+="Response was blocked",e.promptFeedback?.blockReason&&(t+=` due to ${e.promptFeedback.blockReason}`),e.promptFeedback?.blockReasonMessage&&(t+=`: ${e.promptFeedback.blockReasonMessage}`);else if(e.candidates?.[0]){const n=e.candidates[0];hr(n)&&(t+=`Candidate was blocked due to ${n.finishReason}`,n.finishMessage&&(t+=`: ${n.finishMessage}`))}return t}function pr(e){if(e.safetySettings?.forEach(t=>{if(t.method)throw new k(I.UNSUPPORTED,"SafetySetting.method is not supported in the the Gemini Developer API. Please remove this property.")}),e.generationConfig?.topK){const t=Math.round(e.generationConfig.topK);t!==e.generationConfig.topK&&(q.warn("topK in GenerationConfig has been rounded to the nearest integer to match the format for requests to the Gemini Developer API."),e.generationConfig.topK=t)}return e}function kn(e){return{candidates:e.candidates?Hc(e.candidates):void 0,prompt:e.promptFeedback?Uc(e.promptFeedback):void 0,usageMetadata:e.usageMetadata}}function jc(e,t){return{generateContentRequest:{model:t,...e}}}function Hc(e){const t=[];let n;return t&&e.forEach(a=>{let r;if(a.citationMetadata&&(r={citations:a.citationMetadata.citationSources}),a.safetyRatings&&(n=a.safetyRatings.map(s=>({...s,severity:s.severity??fr.HARM_SEVERITY_UNSUPPORTED,probabilityScore:s.probabilityScore??0,severityScore:s.severityScore??0}))),a.content?.parts?.some(s=>s?.videoMetadata))throw new k(I.UNSUPPORTED,"Part.videoMetadata is not supported in the Gemini Developer API. Please remove this property.");const o={index:a.index,content:a.content,finishReason:a.finishReason,finishMessage:a.finishMessage,safetyRatings:n,citationMetadata:r,groundingMetadata:a.groundingMetadata,urlContextMetadata:a.urlContextMetadata};t.push(o)}),t}function Uc(e){const t=[];return e.safetyRatings.forEach(a=>{t.push({category:a.category,probability:a.probability,severity:a.severity??fr.HARM_SEVERITY_UNSUPPORTED,probabilityScore:a.probabilityScore??0,severityScore:a.severityScore??0,blocked:a.blocked})}),{blockReason:e.blockReason,safetyRatings:t,blockReasonMessage:e.blockReasonMessage}}const da=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function qc(e,t,n){const a=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),r=zc(a),[o,s]=r.tee();return{stream:Vc(o,t,n),response:Wc(s,t,n)}}async function Wc(e,t,n){const a=[],r=e.getReader();for(;;){const{done:o,value:s}=await r.read();if(o){let i=Gc(a);return t.backend.backendType===ce.GOOGLE_AI&&(i=kn(i)),yt(i,n)}a.push(s)}}async function*Vc(e,t,n){const a=e.getReader();for(;;){const{value:r,done:o}=await a.read();if(o)break;let s;t.backend.backendType===ce.GOOGLE_AI?s=yt(kn(r),n):s=yt(r,n);const i=s.candidates?.[0];!i?.content?.parts&&!i?.finishReason&&!i?.citationMetadata&&!i?.urlContextMetadata||(yield s)}}function zc(e){const t=e.getReader();return new ReadableStream({start(a){let r="";return o();function o(){return t.read().then(({value:s,done:i})=>{if(i){if(r.trim()){a.error(new k(I.PARSE_FAILED,"Failed to parse stream"));return}a.close();return}r+=s;let l=r.match(da),c;for(;l;){try{c=JSON.parse(l[1])}catch{a.error(new k(I.PARSE_FAILED,`Error parsing JSON response: "${l[1]}`));return}a.enqueue(c),r=r.substring(l[0].length),l=r.match(da)}return o()})}}})}function Gc(e){const n={promptFeedback:e[e.length-1]?.promptFeedback};for(const a of e)if(a.candidates)for(const r of a.candidates){const o=r.index||0;n.candidates||(n.candidates=[]),n.candidates[o]||(n.candidates[o]={index:r.index}),n.candidates[o].citationMetadata=r.citationMetadata,n.candidates[o].finishReason=r.finishReason,n.candidates[o].finishMessage=r.finishMessage,n.candidates[o].safetyRatings=r.safetyRatings,n.candidates[o].groundingMetadata=r.groundingMetadata;const s=r.urlContextMetadata;if(typeof s=="object"&&s!==null&&Object.keys(s).length>0&&(n.candidates[o].urlContextMetadata=s),r.content){if(!r.content.parts)continue;n.candidates[o].content||(n.candidates[o].content={role:r.content.role||"user",parts:[]});for(const i of r.content.parts){const l={...i};i.text!==""&&Object.keys(l).length>0&&n.candidates[o].content.parts.push(l)}}}return n}const Kc=[I.FETCH_ERROR,I.ERROR,I.API_NOT_ENABLED];async function gr(e,t,n,a){if(!t)return{response:await a(),inferenceSource:ue.IN_CLOUD};switch(t.mode){case ke.ONLY_ON_DEVICE:if(await t.isAvailable(e))return{response:await n(),inferenceSource:ue.ON_DEVICE};throw new k(I.UNSUPPORTED,"Inference mode is ONLY_ON_DEVICE, but an on-device model is not available.");case ke.ONLY_IN_CLOUD:return{response:await a(),inferenceSource:ue.IN_CLOUD};case ke.PREFER_IN_CLOUD:try{return{response:await a(),inferenceSource:ue.IN_CLOUD}}catch(r){if(r instanceof k&&Kc.includes(r.code))return{response:await n(),inferenceSource:ue.ON_DEVICE};throw r}case ke.PREFER_ON_DEVICE:return await t.isAvailable(e)?{response:await n(),inferenceSource:ue.ON_DEVICE}:{response:await a(),inferenceSource:ue.IN_CLOUD};default:throw new k(I.ERROR,`Unexpected infererence mode: ${t.mode}`)}}async function Yc(e,t,n,a){return e.backend.backendType===ce.GOOGLE_AI&&(n=pr(n)),In({task:"streamGenerateContent",model:t,apiSettings:e,stream:!0,requestOptions:a},JSON.stringify(n))}async function yr(e,t,n,a,r){const o=await gr(n,a,()=>a.generateContentStream(n),()=>Yc(e,t,n,r));return qc(o.response,e)}async function Jc(e,t,n,a){return e.backend.backendType===ce.GOOGLE_AI&&(n=pr(n)),In({model:t,task:"generateContent",apiSettings:e,stream:!1,requestOptions:a},JSON.stringify(n))}async function br(e,t,n,a,r){const o=await gr(n,a,()=>a.generateContent(n),()=>Jc(e,t,n,r)),s=await Xc(o.response,e);return{response:yt(s,o.inferenceSource)}}async function Xc(e,t){const n=await e.json();return t.backend.backendType===ce.GOOGLE_AI?kn(n):n}function wr(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function tn(e){let t=[];if(typeof e=="string")t=[{text:e}];else for(const n of e)typeof n=="string"?t.push({text:n}):t.push(n);return Qc(t)}function Qc(e){const t={role:"user",parts:[]},n={role:"function",parts:[]};let a=!1,r=!1;for(const o of e)"functionResponse"in o?(n.parts.push(o),r=!0):(t.parts.push(o),a=!0);if(a&&r)throw new k(I.INVALID_CONTENT,"Within a single message, FunctionResponse cannot be mixed with other type of Part in the request for sending chat message.");if(!a&&!r)throw new k(I.INVALID_CONTENT,"No Content is provided for sending chat message.");return a?t:n}function Ht(e){let t;return e.contents?t=e:t={contents:[tn(e)]},e.systemInstruction&&(t.systemInstruction=wr(e.systemInstruction)),t}const ua=["text","inlineData","functionCall","functionResponse","thought","thoughtSignature"],Zc={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","thought","thoughtSignature"],system:["text"]},fa={user:["model"],function:["model"],model:["user","function"],system:[]};function el(e){let t=null;for(const n of e){const{role:a,parts:r}=n;if(!t&&a!=="user")throw new k(I.INVALID_CONTENT,`First Content should be with role 'user', got ${a}`);if(!ia.includes(a))throw new k(I.INVALID_CONTENT,`Each item should include role field. Got ${a} but valid roles are: ${JSON.stringify(ia)}`);if(!Array.isArray(r))throw new k(I.INVALID_CONTENT,"Content should have 'parts' property with an array of Parts");if(r.length===0)throw new k(I.INVALID_CONTENT,"Each Content should have at least one part");const o={text:0,inlineData:0,functionCall:0,functionResponse:0,thought:0,thoughtSignature:0,executableCode:0,codeExecutionResult:0};for(const i of r)for(const l of ua)l in i&&(o[l]+=1);const s=Zc[a];for(const i of ua)if(!s.includes(i)&&o[i]>0)throw new k(I.INVALID_CONTENT,`Content with role '${a}' can't contain '${i}' part`);if(t&&!fa[a].includes(t.role))throw new k(I.INVALID_CONTENT,`Content with role '${a}' can't follow '${t.role}'. Valid previous roles: ${JSON.stringify(fa)}`);t=n}}const ma="SILENT_ERROR";class tl{constructor(t,n,a,r,o){this.model=n,this.chromeAdapter=a,this.params=r,this.requestOptions=o,this._history=[],this._sendPromise=Promise.resolve(),this._apiSettings=t,r?.history&&(el(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(t){await this._sendPromise;const n=tn(t),a={safetySettings:this.params?.safetySettings,generationConfig:this.params?.generationConfig,tools:this.params?.tools,toolConfig:this.params?.toolConfig,systemInstruction:this.params?.systemInstruction,contents:[...this._history,n]};let r={};return this._sendPromise=this._sendPromise.then(()=>br(this._apiSettings,this.model,a,this.chromeAdapter,this.requestOptions)).then(o=>{if(o.response.candidates&&o.response.candidates.length>0){this._history.push(n);const s={parts:o.response.candidates?.[0].content.parts||[],role:o.response.candidates?.[0].content.role||"model"};this._history.push(s)}else{const s=Te(o.response);s&&q.warn(`sendMessage() was unsuccessful. ${s}. Inspect response object for details.`)}r=o}),await this._sendPromise,r}async sendMessageStream(t){await this._sendPromise;const n=tn(t),a={safetySettings:this.params?.safetySettings,generationConfig:this.params?.generationConfig,tools:this.params?.tools,toolConfig:this.params?.toolConfig,systemInstruction:this.params?.systemInstruction,contents:[...this._history,n]},r=yr(this._apiSettings,this.model,a,this.chromeAdapter,this.requestOptions);return this._sendPromise=this._sendPromise.then(()=>r).catch(o=>{throw new Error(ma)}).then(o=>o.response).then(o=>{if(o.candidates&&o.candidates.length>0){this._history.push(n);const s={...o.candidates[0].content};s.role||(s.role="model"),this._history.push(s)}else{const s=Te(o);s&&q.warn(`sendMessageStream() was unsuccessful. ${s}. Inspect response object for details.`)}}).catch(o=>{o.message!==ma&&q.error(o)}),r}}async function nl(e,t,n,a){let r="";if(e.backend.backendType===ce.GOOGLE_AI){const s=jc(n,t);r=JSON.stringify(s)}else r=JSON.stringify(n);return(await In({model:t,task:"countTokens",apiSettings:e,stream:!1,requestOptions:a},r)).json()}async function al(e,t,n,a,r){if(a?.mode===ke.ONLY_ON_DEVICE)throw new k(I.UNSUPPORTED,"countTokens() is not supported for on-device models.");return nl(e,t,n,r)}class rl extends Ue{constructor(t,n,a,r){super(t,n.model),this.chromeAdapter=r,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=wr(n.systemInstruction),this.requestOptions=a||{}}async generateContent(t){const n=Ht(t);return br(this._apiSettings,this.model,{generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,...n},this.chromeAdapter,this.requestOptions)}async generateContentStream(t){const n=Ht(t);return yr(this._apiSettings,this.model,{generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,...n},this.chromeAdapter,this.requestOptions)}startChat(t){return new tl(this._apiSettings,this.model,this.chromeAdapter,{tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,generationConfig:this.generationConfig,safetySettings:this.safetySettings,...t},this.requestOptions)}async countTokens(t){const n=Ht(t);return al(this._apiSettings,this.model,n,this.chromeAdapter)}}function ol(e=dn(),t){e=Xe(e);const n=xe(e,Fe),a=t?.backend??new Tt,r={useLimitedUseAppCheckTokens:t?.useLimitedUseAppCheckTokens??!1},o=Sc(a),s=n.getImmediate({identifier:o});return s.options=r,s}function sl(e,t,n){const a=t;let r;if(a.mode?r=a.inCloudParams||{model:Lc}:r=t,!r.model)throw new k(I.NO_MODEL,"Must provide a model name. Example: getGenerativeModel({ model: 'my-model-name' })");const o=e.chromeAdapterFactory?.(a.mode,typeof window>"u"?void 0:window,a.onDeviceParams);return new rl(e,r,n,o)}function il(){se(new Z(Fe,Rc,"PUBLIC").setMultipleInstances(!0)),Q(ra,en),Q(ra,en,"esm2020")}il();const cl={apiKey:"AIzaSyCmAiYHJ77vZCNzP1juaeU4xQ_KV6kc5h4",authDomain:"watchlist-b2fd0.firebaseapp.com",projectId:"watchlist-b2fd0",storageBucket:"watchlist-b2fd0.firebasestorage.app",messagingSenderId:"917010956394",appId:"1:917010956394:web:6ed1aa6e057ceced48ca13",measurementId:"G-ZZFBMG2K1G"},Tn=Ca(cl);Di(Tn);typeof window<"u"&&wc(Tn,{provider:new _n("6LdRTRQsAAAAAK07rxxw0rG2s7iBlrx_zLaLs4u5"),isTokenAutoRefreshEnabled:!0});const ll=ol(Tn,{backend:new Tt}),vr=sl(ll,{model:"gemini-2.5-flash"}),dl="25e3d089cc8e37a56bf6a1984daf3c5c";async function ul(){console.log("Performing a hard reset. Deleting all media data...");const{error:e}=await y.from("media").delete().neq("id",0);if(e){console.error("CRITICAL: Failed to delete data. Check your RLS policies.",e);return}console.log("All existing media has been deleted.");const t=await ml();if(t.length){console.log(`Starting to seed ${t.length} items from watchednotes.json...`);for(const n of t){const a=await fl(n.title);if(a){const{error:r}=await y.from("media").insert({title:n.title,type:n.type,tmdb_id:a,source:"fetched"});r&&console.error(`Error inserting '${n.title}':`,r)}}console.log("Database hard reset and seeding complete.")}}async function fl(e){const t=`https://api.themoviedb.org/3/search/multi?api_key=${dl}&query=${encodeURIComponent(e)}`;try{const a=await(await fetch(t)).json();if(a.results&&a.results.length>0){const r=a.results.find(o=>o.media_type==="movie"||o.media_type==="tv");if(r)return r.id}return console.warn(`TMDB ID not found for: ${e}`),null}catch(n){return console.error(`Error fetching TMDB ID for ${e}:`,n),null}}async function ml(){try{const e=await fetch("/watchednotes.json");if(!e.ok)throw new Error("Failed to fetch watchednotes.json");return await e.json()}catch(e){return console.error("Error fetching local media data:",e),[]}}async function hl(){const{data:e,error:t}=await y.from("flairs").select("*").order("name");return t?(console.error("Error fetching flairs:",t),[]):e}async function pl(e){const{data:t,error:n}=await y.from("media_flairs").select(`
            flair_id,
            flairs (
                id,
                name,
                color,
                icon,
                description
            )
        `).eq("media_id",e);return n?(console.error("Error fetching media flairs:",n),[]):t.map(a=>a.flairs)}async function gl(e){const{data:t,error:n}=await y.from("flairs").insert([e]).select().single();return n?(console.error("Error creating flair:",n),null):t}async function yl(e,t){const n=await pl(e);if(n.length>=2)return{success:!1,message:"Max 2 flairs per media item."};if(n.find(r=>r.id===t))return{success:!1,message:"Flair already assigned."};const{error:a}=await y.from("media_flairs").insert([{media_id:e,flair_id:t}]);return a?(console.error("Error assigning flair:",a),{success:!1,message:"Failed to assign flair."}):{success:!0,message:"Flair assigned."}}async function bl(e,t){const{error:n}=await y.from("media_flairs").delete().eq("media_id",e).eq("flair_id",t);return n?(console.error("Error removing flair:",n),!1):!0}function fe(e,t="text-xs px-2 py-0.5"){let n="";return e.icon&&(e.icon.startsWith("fa")?n=`<i class="${e.icon}"></i>`:n=`<span>${e.icon}</span>`),`
        <span class="inline-flex items-center gap-1 rounded-full font-semibold shadow-sm ${t} transform transition-transform hover:scale-105 cursor-default border border-white/20" 
              style="background-color: ${e.color}; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.5);">
            ${n}
            <span>${e.name}</span>
        </span>
    `}async function ha(e,t,n){const a=`Summarize Juainny and Erick's opinions on "${e.title||e.name}" based on:

**Juainny:** ${t.user1||"No rating"}/5 - ${n.user1||"No notes"}
**Erick:** ${t.user2||"No rating"}/5 - ${n.user2||"No notes"}

**Overview:** ${e.overview}

Rules:
- Use **markdown** formatting (bold, italic, lists)
- Be concise (max 80 words)
- Highlight agreement or disagreement
- Skip greetings/introductions
- Be insightful and engaging`;try{return(await(await vr.generateContent(a)).response).text()}catch(r){return console.error("Error generating summary:",r),"Willow is having trouble thinking right now. check back later!"}}async function wl(e,t){const n=t.map(r=>({title:r.title||r.name,type:r.type,year:r.release_year,rating:r.content_rating,runtime:r.runtime,watched:r.watched,want_to_watch:r.want_to_watch,currently_watching:r.currently_watching,favorited_by:r.favorited_by,ratings:{juainny:r.user1_rating,erick:r.user2_rating},notes:{juainny:r.user1_notes,erick:r.user2_notes},reactions:{juainny:r.juainny_reaction,erick:r.erick_reaction}})),a=`You're Willow, Juainny and Erick's watchlist AI.

**Database:** ${JSON.stringify(n,null,2)}

**Question:** ${e}

**Rules:**
- Answer directly using the database
- Use **markdown** (bold, lists, etc.)
- Be concise and informative
- Skip introductions (no "Hey!" or "As Willow...")
- Recommend from want_to_watch list when relevant
- If not in database, say so briefly then use general knowledge`;try{return(await(await vr.generateContent(a)).response).text()}catch(r){return console.error("Error chatting with Willow:",r),"I'm feeling a bit overwhelmed with all this data. Ask me again in a moment!"}}const ye="25e3d089cc8e37a56bf6a1984daf3c5c";async function vl(e){console.log("Starting TMDB data synchronization...");const t=10;let n=[],a=0,r=0;for(let o=0;o<e.length;o+=t){const i=e.slice(o,o+t).map(async c=>{if(!c.tmdb_id||!c.type)return c;const h=`https://api.themoviedb.org/3/${c.type==="movie"?"movie":"tv"}/${c.tmdb_id}?api_key=${ye}&append_to_response=release_dates,content_ratings,external_ids`;try{const m=await fetch(h);if(!m.ok)return console.error(`Error fetching TMDB data for ${c.title} (ID: ${c.tmdb_id}): ${m.status}`),r++,c;const d=await m.json(),p=d.title||d.name,_={};c.poster_path!==d.poster_path&&(_.poster_path=d.poster_path),c.title!==p&&(_.title=p);const T=d.release_date||d.first_air_date||"",L=T?parseInt(T.split("-")[0]):null;L&&(!c.release_year||c.release_year!==L)&&(_.release_year=L);let E=d.runtime||(d.episode_run_time&&d.episode_run_time.length>0?d.episode_run_time[0]:0);const b=c.type==="tv"||c.type==="series";b&&!E&&(d.last_episode_to_air&&d.last_episode_to_air.runtime?E=d.last_episode_to_air.runtime:d.next_episode_to_air&&d.next_episode_to_air.runtime&&(E=d.next_episode_to_air.runtime)),E&&(c.runtime===0||!c.runtime||c.runtime!==E)&&(_.runtime=E);let w="N/A";if(c.type==="movie"&&d.release_dates){const B=d.release_dates.results.find(O=>O.iso_3166_1==="US");if(B){const O=B.release_dates.find(ee=>ee.certification!=="");O&&(w=O.certification)}}else if(b&&d.content_ratings&&d.content_ratings.results){const B=d.content_ratings.results.find(O=>O.iso_3166_1==="US");B?w=B.rating:d.content_ratings.results.length>0&&(w=d.content_ratings.results[0].rating)}w!=="N/A"&&(!c.content_rating||c.content_rating==="N/A"||c.content_rating!==w)&&(_.content_rating=w);const S=d.external_ids?.imdb_id;if(S&&(!c.imdb_id||c.imdb_id!==S)&&(_.imdb_id=S),Object.keys(_).length>0){const{error:B}=await y.from("media").update(_).eq("id",c.id);return B?(console.error(`Error updating Supabase for ${c.title}:`,B),r++,c):(console.log(` Updated ${c.title}:`,Object.keys(_).join(", ")),a++,{...c,..._})}return c}catch(m){return console.error(`Error during TMDB sync for ${c.title}:`,m),r++,c}}),l=await Promise.all(i);n=n.concat(l)}return console.log(`TMDB sync complete. Updated: ${a}/${e.length}. Errors: ${r}`),n}let A=[],Oe=[],P=[],ne="all",nn="grid",bt="default",ve=[],D=new Map;async function _l(e){if(!e||e.trim()==="")return[];const t=`https://api.themoviedb.org/3/search/multi?api_key=${ye}&query=${encodeURIComponent(e)}`;try{let r=(await(await fetch(t)).json()).results.filter(s=>s.media_type==="movie"||s.media_type==="tv");const{data:o}=await y.from("settings").select("hide_search_results_without_images").single();return o?.hide_search_results_without_images&&(r=r.filter(s=>s.poster_path)),o?.hide_search_results_without_images&&(r=r.filter(s=>s.poster_path)),console.log("TMDB Search Results:",r.length),r}catch(n){return console.error("Error searching TMDB:",n),[]}}function V(){console.log("Rendering content. Current Filter:",ne,"Media Count:",Oe.length);const e=document.getElementById("movie-grid"),t=document.getElementById("movie-list");if(ne==="all"?P=Oe:P=Oe.filter(n=>{const a=n.type||n.media_type;return ne==="movie"?a==="movie":ne==="tv"?a==="tv"||a==="series":ne==="watched"?n.watched===!0:ne==="rejected"?n.rejected===!0:!1}),Ml(),nn==="grid"){if(e.innerHTML="",t.innerHTML="",e.style.display="grid",t.style.display="none",P.length===0){e.innerHTML='<p class="text-text-muted col-span-full text-center">No results found.</p>';return}for(const n of P){const a=n.poster_path?`https://image.tmdb.org/t/p/w500${n.poster_path}`:"https://placehold.co/500x750?text=No+Image",r=n.title||n.name,o=n.type||n.media_type,s=n.tmdb_id||n.id;El(e,r,o,s,a,n.watched)}}else{if(e.innerHTML="",t.innerHTML="",e.style.display="none",t.style.display="block",P.length===0){t.innerHTML='<p class="text-text-muted text-center">No results found.</p>';return}const n=document.createElement("div");n.className="bg-bg-secondary p-4 md:p-6 rounded-lg shadow-lg",P.forEach(a=>{const r=a.title||a.name,o=a.type||a.media_type,s=a.tmdb_id||a.id,i=document.createElement("div");i.className="flex items-center py-1",i.innerHTML=`
                <span class="text-text-muted mr-2">-</span>
                <a href="#" class="text-text-primary hover:text-accent-primary underline transition-colors" data-tmdb-id="${s}" data-type="${o}">${r}</a>
            `,i.querySelector("a").addEventListener("click",l=>{l.preventDefault(),Lt(s,o)}),n.appendChild(i)}),t.appendChild(n)}}function El(e,t,n,a,r,o){const s=document.createElement("div");s.className="movie-card relative rounded-lg shadow-lg overflow-hidden cursor-pointer group",o&&s.classList.add("watched"),s.dataset.tmdbId=a,s.dataset.type=n;const i=A.find(c=>c.tmdb_id==a)?.favorited_by||[];i.length>1?s.classList.add("super-favorite-glow"):i.length>0&&s.classList.add("favorite-glow"),s.innerHTML=`
        <img src="${r}" alt="${t}" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
        
        <!-- Reactions Overlay -->
        <div class="absolute top-2 left-2 flex flex-col gap-1 z-10">
            ${A.find(c=>c.tmdb_id==a)?.juainny_reaction?`
                <div class="relative w-8 h-8 group/reaction cursor-pointer reaction-item" data-user="Juainny" data-reaction="${A.find(c=>c.tmdb_id==a).juainny_reaction}">
                    <img src="moods/${A.find(c=>c.tmdb_id==a).juainny_reaction}" class="w-full h-full object-contain drop-shadow-md">
                    <div class="absolute -bottom-1 -right-1 w-4 h-4">
                        ${G("juainny","w-full h-full")}
                    </div>
                </div>
            `:""}
            ${A.find(c=>c.tmdb_id==a)?.erick_reaction?`
                <div class="relative w-8 h-8 group/reaction cursor-pointer reaction-item" data-user="Erick" data-reaction="${A.find(c=>c.tmdb_id==a).erick_reaction}">
                    <img src="moods/${A.find(c=>c.tmdb_id==a).erick_reaction}" class="w-full h-full object-contain drop-shadow-md">
                    <div class="absolute -bottom-1 -right-1 w-4 h-4">
                        ${G("erick","w-full h-full")}
                    </div>
                </div>
            `:""}
        </div>

        <div class="absolute bottom-2 left-2 flex flex-col gap-1 z-10 items-start pointer-events-none">
            <!-- Flairs Container -->
             ${(D.get(A.find(c=>c.tmdb_id==a)?.id)||[]).map(c=>fe(c,"text-[10px] px-1.5 py-0.5 shadow-md")).join("")}
        </div>
        <div class="absolute bottom-0 left-0 right-0 p-4">
            <!-- Title removed as per user request -->
        </div>
        <button class="bookmark-icon absolute bottom-2 right-2 text-white text-2xl opacity-0 group-hover:opacity-100 transition-opacity">
            <i class="fas fa-bookmark"></i>
        </button>
    `,s.querySelectorAll(".reaction-item").forEach(c=>{c.addEventListener("mouseenter",u=>{At(u.currentTarget)}),c.addEventListener("mouseleave",()=>{Qe()}),c.addEventListener("click",u=>{Sn(u.currentTarget,u)})});const l=s.querySelector(".bookmark-icon");l.addEventListener("click",async c=>{c.stopPropagation();const u=r.includes("image.tmdb.org")?r.replace("https://image.tmdb.org/t/p/w500",""):null,f=await Pe(a,n,t,u);if(!f)return;D.has(f.id)||D.set(f.id,[]);const h=!f.want_to_watch,m={want_to_watch:h};h&&(m.currently_watching=!1);const{error:d}=await y.from("media").update(m).eq("id",item.id);d?console.error("Error updating bookmark from grid:",d):l.classList.toggle("text-accent-primary",h)}),s.addEventListener("click",c=>{console.log("Movie card clicked:",t),Lt(a,n)}),e.appendChild(s)}async function qe(){const{data:e,error:t}=await y.from("media").select("*").eq("currently_watching",!0);if(t)return console.error("Error fetching currently watching media:",t),[];if(!e||e.length===0)return[];const n=e.map(s=>s.id),{data:a,error:r}=await y.from("activity_log").select("media_id, created_at").in("media_id",n).order("created_at",{ascending:!1});if(r)return console.error("Error fetching activity logs for sorting:",r),e;const o={};return a.forEach(s=>{o[s.media_id]||(o[s.media_id]=new Date(s.created_at).getTime())}),e.sort((s,i)=>{const l=o[s.id]||0;return(o[i.id]||0)-l})}async function We(){const{data:e,error:t}=await y.from("media").select("*").eq("want_to_watch",!0).order("created_at",{ascending:!1});return t?(console.error("Error fetching want to watch media:",t),[]):e}function ae(e,t){const n=document.getElementById(e);if(!n)return;if(n.className="relative group/carousel w-full overflow-hidden",n.innerHTML="",t.length===0){n.innerHTML='<p class="text-text-muted text-center w-full">Nothing here yet!</p>';return}const a=document.createElement("div");a.className="flex gap-4 scroll-smooth pb-4 px-1 scrollbar-hide snap-x snap-mandatory",a.style.cssText="overflow-x: auto; scrollbar-width: none; -ms-overflow-style: none; max-width: 100%; width: 100%;";const r=document.createElement("style");r.textContent=`
        #${e} .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
    `,n.appendChild(r);const o=document.createElement("div");o.className="absolute left-0 top-0 bottom-0 z-20 flex items-center px-2 opacity-0 group-hover/carousel:opacity-100 transition-opacity";const s=document.createElement("button");s.type="button",s.className="bg-black/50 hover:bg-black/80 text-white p-2 rounded-full cursor-pointer transition-colors",s.innerHTML='<i class="fas fa-chevron-left"></i>',s.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation();const u=a.clientWidth*.8;a.scrollTo({left:a.scrollLeft-u,behavior:"smooth"})}),o.appendChild(s);const i=document.createElement("div");i.className="absolute right-0 top-0 bottom-0 z-20 flex items-center px-2 opacity-0 group-hover/carousel:opacity-100 transition-opacity";const l=document.createElement("button");l.type="button",l.className="bg-black/50 hover:bg-black/80 text-white p-2 rounded-full cursor-pointer transition-colors",l.innerHTML='<i class="fas fa-chevron-right"></i>',l.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation();const u=a.clientWidth*.8;a.scrollTo({left:a.scrollLeft+u,behavior:"smooth"})}),i.appendChild(l),n.appendChild(o),n.appendChild(a),n.appendChild(i),t.forEach(c=>{const u=c.poster_path?`https://image.tmdb.org/t/p/w500${c.poster_path}`:"https://placehold.co/500x750?text=No+Image",f=c.title||c.name,h=c.type||c.media_type,m=c.tmdb_id||c.id,d=document.createElement("div");d.className="flex-shrink-0 w-32 sm:w-36 md:w-44 lg:w-48 movie-card relative rounded-lg shadow-lg overflow-hidden cursor-pointer group snap-start",d.style.cssText="flex-shrink: 0;",d.dataset.tmdbId=m,d.dataset.type=h;let p=c.favorited_by||[];if(typeof p=="string")try{p=JSON.parse(p)}catch{p=[]}const _=p.includes("user1"),T=p.includes("user2");_&&T?d.classList.add("rainbow-glow"):(_||T)&&d.classList.add("favorite-glow"),d.innerHTML=`
            <img src="${u}" alt="${f}" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
            <!-- Removed gradient overlay as per request -->
            
            <!-- Reactions Overlay -->
            <div class="absolute top-2 left-2 flex flex-col gap-1 z-10">
                ${c.juainny_reaction?`
                    <div class="relative w-8 h-8 group/reaction cursor-pointer reaction-item" data-user="Juainny" data-reaction="${c.juainny_reaction}">
                        <img src="moods/${c.juainny_reaction}" class="w-full h-full object-contain drop-shadow-md">
                        <div class="absolute -bottom-1 -right-1 w-4 h-4">
                            ${G("juainny","w-full h-full")}
                        </div>
                    </div>
                `:""}
                ${c.erick_reaction?`
                    <div class="relative w-8 h-8 group/reaction cursor-pointer reaction-item" data-user="Erick" data-reaction="${c.erick_reaction}">
                        <img src="moods/${c.erick_reaction}" class="w-full h-full object-contain drop-shadow-md">
                        <div class="absolute -bottom-1 -right-1 w-4 h-4">
                            ${G("erick","w-full h-full")}
                        </div>
                    </div>
                `:""}
            </div>

            <div class="absolute bottom-0 left-0 right-0 p-2">
                 <!-- Title removed -->
            </div>
            
            <div class="absolute bottom-2 left-2 flex flex-col gap-1 z-10 items-start pointer-events-none">
                <!-- Flairs Container -->
                 ${(D.get(c.id)||[]).map(L=>fe(L,"text-[10px] px-1.5 py-0.5 shadow-md")).join("")}
            </div>
        `,d.querySelectorAll(".reaction-item").forEach(L=>{L.addEventListener("mouseenter",E=>{At(E.currentTarget)}),L.addEventListener("mouseleave",()=>{Qe()}),L.addEventListener("click",E=>{Sn(E.currentTarget,E)})}),d.addEventListener("click",()=>Lt(m,h)),a.appendChild(d)})}let g=null;async function Lt(e,t){const n=document.getElementById("movie-modal");if(!n)return;let a;document.body.style.overflow="hidden";const r=document.querySelector("footer");r&&r.classList.add("hidden");const o=document.getElementById("tv-progress-section"),s=document.getElementById("tv-warning-section"),i=p=>p?p.watched||p.currently_watching||p.want_to_watch:!1,l=A.find(p=>p.tmdb_id==e),c=i(l);if(console.log("OpenModal - TMDB ID:",e,"Tracked Item:",l,"Is Tracked:",c),t==="tv"||t==="series"){if(o.classList.remove("hidden"),!s){const p=document.createElement("div");p.id="tv-warning-section",p.className="hidden text-center py-8 px-4 bg-yellow-500/10 rounded-lg border border-yellow-500/20 my-4",p.innerHTML=`
                <i class="fas fa-lock text-yellow-500 text-3xl mb-3"></i>
                <p class="text-text-primary font-semibold">Episode Guide Locked</p>
                <p class="text-text-muted text-sm mt-2">You can't see the episode carousel until you add this as "Watched", "Watching", or "Want to Watch".</p>
             `,o.parentNode.insertBefore(p,o.nextSibling)}if(c){o.classList.remove("hidden");const p=document.getElementById("tv-warning-section");p&&p.classList.add("hidden");const L=`https://api.themoviedb.org/3/${t==="movie"?"movie":"tv"}/${e}?api_key=${ye}&append_to_response=credits,images,videos,release_dates,external_ids`,b=await(await fetch(L)).json();await Er(e,b.seasons)}else{o.classList.add("hidden");const p=document.getElementById("tv-warning-section");p&&p.classList.remove("hidden")}}else{o.classList.add("hidden");const p=document.getElementById("tv-warning-section");p&&p.classList.add("hidden")}n.dataset.tmdbId=e;const u=A.find(p=>p.tmdb_id==e)||(g&&g.tmdb_id==e?g:null);if(u){document.getElementById("modal-overview").textContent=u.overview||"Loading...",document.getElementById("modal-title").textContent=u.title||u.name||"Loading...";const p=u.release_date||u.first_air_date||"";document.getElementById("modal-release-year").textContent=p.substring(0,4),n.classList.remove("hidden"),n.classList.remove("modal-hidden"),n.classList.add("flex")}const m=`https://api.themoviedb.org/3/${t==="movie"?"movie":"tv"}/${e}?api_key=${ye}&append_to_response=credits,images,videos,release_dates,external_ids,content_ratings`;let d;try{const p=await fetch(m);if(!p.ok)throw new Error("Failed to fetch modal data.");d=await p.json(),document.getElementById("modal-overview").textContent=d.overview;const _=document.getElementById("modal-title");_.innerHTML="";const T=d.images?.logos?.find(v=>v.iso_639_1==="en"&&!v.file_path.endsWith(".svg"))||d.images?.logos?.[0];if(T){const v=`https://image.tmdb.org/t/p/w500${T.file_path}`;_.innerHTML=`<img src="${v}" alt="${d.title||d.name} Logo" class="max-h-20 object-contain" style="max-width: 14.4rem;">`}else _.textContent=d.title||d.name;const L=d.release_date||d.first_air_date||"",E=u?.release_year||L.substring(0,4);document.getElementById("modal-release-year").textContent=E;let b=u?.runtime||d.runtime||(d.episode_run_time&&d.episode_run_time.length>0?d.episode_run_time[0]:0);t==="tv"&&!b&&(d.last_episode_to_air&&d.last_episode_to_air.runtime?b=d.last_episode_to_air.runtime:d.next_episode_to_air&&d.next_episode_to_air.runtime&&(b=d.next_episode_to_air.runtime)),document.getElementById("modal-runtime").textContent=Tl(b),Ll(b);let w=u?.content_rating||"N/A";if(w==="N/A"){if(t==="movie"&&d.release_dates){const v=d.release_dates.results.find(C=>C.iso_3166_1==="US");if(v){const C=v.release_dates.find(R=>R.certification!=="");C&&(w=C.certification)}}else if(t==="tv"&&d.content_ratings&&d.content_ratings.results){const v=d.content_ratings.results.find(C=>C.iso_3166_1==="US");v?w=v.rating:d.content_ratings.results.length>0&&(w=d.content_ratings.results[0].rating)}}document.getElementById("modal-content-rating").textContent=w;const S=document.getElementById("title-tooltip");if(S){const v=u?.title||u?.name||d.title||d.name;S.setAttribute("title",v)}const B=d.external_ids.imdb_id,O=d.vote_average?d.vote_average.toFixed(1):"N/A";document.getElementById("modal-score").textContent=O;const ee=document.getElementById("modal-imdb-link");if(B?(ee.href=`https://www.imdb.com/title/${B}`,ee.style.display="flex"):ee.style.display="none",c&&l&&l.id){const v={},C=document.getElementById("willow-summary-section"),R=document.getElementById("willow-summary-text"),te=document.getElementById("regenerate-summary-btn");C.classList.remove("hidden"),l.ai_summary?R.innerHTML=dt(l.ai_summary):(async()=>{R.innerHTML='<i class="fas fa-spinner fa-spin"></i> Willow is thinking...';const U=document.querySelector("#juainny-rating-container .stars")?.dataset.rating||l.user1_rating,F=document.getElementById("juainny-notes").innerText,J=document.querySelector("#erick-rating-container .stars")?.dataset.rating||l.user2_rating,de=document.getElementById("erick-notes").innerText,xt=await ha(l,{user1:U,user2:J},{user1:F,user2:de});R.innerHTML=dt(xt),await y.from("media").update({ai_summary:xt}).eq("tmdb_id",e),l.ai_summary=xt})(),te.onclick=async()=>{R.innerHTML='<i class="fas fa-spinner fa-spin"></i> Willow is thinking...';const z=document.querySelector("#juainny-rating-container .stars")?.dataset.rating||l.user1_rating,U=document.getElementById("juainny-notes").innerText,F=document.querySelector("#erick-rating-container .stars")?.dataset.rating||l.user2_rating,J=document.getElementById("erick-notes").innerText,at=await ha(l,{user1:z,user2:F},{user1:U,user2:J});R.innerHTML=dt(at),await y.from("media").update({ai_summary:at}).eq("tmdb_id",e),l.ai_summary=at}}else document.getElementById("willow-summary-section").classList.add("hidden");if(c&&l&&l.id){const v={};!l.release_year&&E&&(v.release_year=parseInt(E)),!l.runtime&&b&&(v.runtime=b),(!l.content_rating||l.content_rating==="N/A")&&w!=="N/A"&&(v.content_rating=w),!l.imdb_id&&B&&(v.imdb_id=B),Object.keys(v).length>0&&y.from("media").update(v).eq("tmdb_id",e).then(({error:C})=>{C&&console.error("Error auto-saving metadata:",C)})}const Ce=d.backdrop_path?`https://image.tmdb.org/t/p/w780${d.backdrop_path}`:"https://placehold.co/800x400?text=No+Image";document.getElementById("modal-backdrop-image").src=Ce;const{data:Y,error:Re}=await y.from("media").select("*").eq("tmdb_id",e).maybeSingle();Re&&Re.code!=="PGRST116"&&console.error("Error fetching media item for ratings:",Re),g=Y||{tmdb_id:e,type:t,title:d.title||d.name,poster_path:d.poster_path,favorited_by:[],watched:!1,juainny_rating:null,erick_rating:null,juainny_notes:null,erick_notes:null},await Bn("juainny-rating-container",g?.juainny_rating||0,an),await Bn("erick-rating-container",g?.erick_rating||0,an);const Ze=(v,C)=>{const R=document.getElementById(C);if(R){const te=G(v,"w-10 h-10 mr-3"),z=document.createElement("div");z.innerHTML=te;const U=z.firstElementChild;U.id=C,R.replaceWith(U)}};Ze("juainny","juainny-avatar"),Ze("erick","erick-avatar"),rn(g),He(g);const An=(v,C)=>{const R=document.getElementById(C);if(!R)return;const te=R.previousElementSibling;te&&te.classList.contains("notes-toolbar")&&te.remove();const z=document.createElement("div");z.className="flex gap-2 mb-2 notes-toolbar",z.innerHTML=`
                <button type="button" data-format="bold" class="p-2 hover:bg-gray-700 rounded text-white" style="font-weight: bold;">B</button>
                <button type="button" data-format="italic" class="p-2 hover:bg-gray-700 rounded text-white" style="font-style: italic;">I</button>
                <button type="button" data-format="underline" class="p-2 hover:bg-gray-700 rounded text-white" style="text-decoration: underline;">U</button>
            `,R.parentNode.insertBefore(z,R),z.querySelectorAll("button").forEach(F=>{F.addEventListener("click",J=>{J.preventDefault();const de=F.dataset.format;de==="bold"&&document.execCommand("bold",!1,null),de==="italic"&&document.execCommand("italic",!1,null),de==="underline"&&document.execCommand("underline",!1,null),R.focus()})});const U=g?.[`${v}_notes`]||"";R.innerHTML=U};if(An("juainny","juainny-notes"),An("erick","erick-notes"),document.getElementById("notes-section").classList.remove("hidden"),Y&&d.backdrop_path&&Y.backdrop_path!==d.backdrop_path){const{error:v}=await y.from("media").update({backdrop_path:d.backdrop_path}).eq("tmdb_id",e);v&&console.error("Error updating backdrop path:",v)}St();const xn=document.getElementById("add-mood-btn");xn&&(xn.onclick=v=>{v.preventDefault(),zl(e)});const Cn=document.getElementById("modal-flairs-container");if(Cn){const v=Y&&D.get(Y.id)||[];Cn.innerHTML=v.map(C=>fe(C,"text-xs px-2 py-1")).join("")}a=document.getElementById("manage-flairs-btn"),a&&(c?(a.classList.remove("hidden"),a.onclick=async v=>{v.preventDefault();const C=await Pe(e,t,d.title||d.name,d.poster_path);C&&Il(C.id)}):a.classList.add("hidden"));const Lr="45991eb5-21e1-40ee-8bde-5beee11a7dff",Sr=(Y&&D.get(Y.id)||[]).some(v=>v.id===Lr||v.name==="MCU"),le=document.getElementById("marvel-marathon-display"),et=document.getElementById("normal-modal-content"),tt=document.getElementById("mood-controls");Sr?(le&&le.classList.remove("hidden"),le&&le.classList.add("flex"),et&&et.classList.add("hidden"),tt&&tt.classList.add("hidden")):(le&&le.classList.add("hidden"),le&&le.classList.remove("flex"),et&&et.classList.remove("hidden"),tt&&tt.classList.remove("hidden")),n.classList.remove("hidden"),n.classList.remove("modal-hidden"),n.classList.add("flex");const nt=document.getElementById("movie-modal-scrollable-content");if(nt&&a){const v=()=>{nt.scrollTop>20?(a.style.opacity="0",a.style.pointerEvents="none"):(a.style.opacity="1",a.style.pointerEvents="auto")};nt.removeEventListener("scroll",v),nt.addEventListener("scroll",v)}const Rn=document.getElementById("modal-stats-pill");if(Rn){let v=0,C=null;Rn.onclick=async()=>{if(v++,v===1)C=setTimeout(()=>{v=0},500);else if(v===3){clearTimeout(C),v=0;let R=d.runtime||(d.episode_run_time&&d.episode_run_time.length>0?d.episode_run_time[0]:0);t==="tv"&&!R&&(d.last_episode_to_air&&d.last_episode_to_air.runtime?R=d.last_episode_to_air.runtime:d.next_episode_to_air&&d.next_episode_to_air.runtime&&(R=d.next_episode_to_air.runtime));const te=d.release_date||d.first_air_date||"",z=te?parseInt(te.split("-")[0]):null;let U="N/A";if(t==="movie"&&d.release_dates){const F=d.release_dates.results.find(J=>J.iso_3166_1==="US");if(F){const J=F.release_dates.find(de=>de.certification!=="");J&&(U=J.certification)}}else if(t==="tv"&&d.content_ratings&&d.content_ratings.results){const F=d.content_ratings.results.find(J=>J.iso_3166_1==="US");F?U=F.rating:d.content_ratings.results.length>0&&(U=d.content_ratings.results[0].rating)}if(confirm(`Update database with:
Year: ${z}
Runtime: ${R}m
Rating: ${U}`)){const{error:F}=await y.from("media").update({release_year:z,runtime:R,content_rating:U}).eq("tmdb_id",e);F?(alert("Failed to update stats."),console.error(F)):alert("Updated database with runtime, year date, and rating.")}}}}}catch(p){console.error("Error opening movie modal:",p)}}async function Il(e){const t=document.getElementById("flair-modal"),n=document.getElementById("close-flair-modal-btn"),a=document.getElementById("current-flairs-list"),r=document.getElementById("available-flairs-list"),o=document.getElementById("toggle-create-flair-btn"),s=document.getElementById("create-flair-form"),i=document.getElementById("save-new-flair-btn");if(!t)return;s.classList.add("hidden");const l=document.getElementById("delete-flair-btn"),c=document.getElementById("cancel-edit-flair-btn"),u=document.getElementById("flair-form-title"),f=document.getElementById("edit-flair-id"),h=document.getElementById("new-flair-name"),m=document.getElementById("new-flair-color"),d=document.getElementById("new-flair-icon"),p=()=>{s.classList.add("hidden"),f.value="",h.value="",m.value="#ef4444",d.value="",u.textContent="NEW FLAIR",i.textContent="Create Flair",l.classList.add("hidden"),c.classList.add("hidden")},_=()=>{a.innerHTML="";const T=D.get(e)||[];T.forEach(L=>{const E=document.createElement("div");E.className="relative group cursor-pointer",E.innerHTML=fe(L,"text-sm px-3 py-1");const b=document.createElement("div");b.className="absolute inset-0 bg-black/60 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs",b.innerHTML='<i class="fas fa-times"></i>',b.onclick=async w=>{w.stopPropagation(),await bl(e,L.id);const S=D.get(e).filter(O=>O.id!==L.id);D.set(e,S),_(),V();const B=document.getElementById("modal-flairs-container");B&&(B.innerHTML=S.map(O=>fe(O,"text-xs px-2 py-1")).join(""))},E.appendChild(b),a.appendChild(E)}),r.innerHTML="",ve.forEach(L=>{if(T.find(S=>S.id===L.id))return;const E=document.createElement("div");E.className="flex items-center gap-2 group";const b=document.createElement("div");b.className="cursor-pointer hover:opacity-80",b.innerHTML=fe(L,"text-sm px-3 py-1"),b.onclick=async()=>{if(T.length>=2){alert("Max 2 flairs per item!");return}const S=await yl(e,L.id);if(S.success){D.has(e)||D.set(e,[]),D.get(e).push(L),_(),V();const B=document.getElementById("modal-flairs-container");if(B){const O=D.get(e);B.innerHTML=O.map(ee=>fe(ee,"text-xs px-2 py-1")).join("")}}else alert(S.message)};const w=document.createElement("button");w.className="text-xs text-text-muted hover:text-accent-primary opacity-0 group-hover:opacity-100 transition-opacity",w.innerHTML='<i class="fas fa-pencil-alt"></i>',w.onclick=S=>{S.stopPropagation(),f.value=L.id,h.value=L.name,m.value=L.color,d.value=L.icon||"",u.textContent="EDIT FLAIR",i.textContent="Update Flair",l.classList.remove("hidden"),c.classList.remove("hidden"),s.classList.remove("hidden")},E.appendChild(b),E.appendChild(w),r.appendChild(E)})};_(),n.onclick=()=>{t.classList.add("hidden"),t.classList.add("modal-hidden"),p()},t.onclick=T=>{T.target===t&&(t.classList.add("hidden"),t.classList.add("modal-hidden"),p())},o.onclick=()=>{!s.classList.contains("hidden")&&!f.value?s.classList.add("hidden"):(p(),s.classList.remove("hidden"))},c.onclick=()=>{p()},l.onclick=async()=>{const T=f.value;if(T&&confirm("Are you sure you want to delete this flair? This will remove it from all media items."))if(await deleteFlair(T)){ve=ve.filter(E=>E.id!==T);for(let[E,b]of D)D.set(E,b.filter(w=>w.id!==T));p(),_(),V()}else alert("Failed to delete flair.")},i.onclick=async()=>{const T=h.value.trim(),L=m.value,E=d.value.trim(),b=f.value;if(!T){alert("Name is required");return}if(b){const w=await updateFlair(b,{name:T,color:L,icon:E});if(w){const S=ve.findIndex(Ce=>Ce.id===b);S!==-1&&(ve[S]=w);for(let[Ce,Y]of D){const Re=Y.findIndex(Ze=>Ze.id===b);Re!==-1&&(Y[Re]=w)}p(),_(),V();const[B,O]=await Promise.all([qe(),We()]);ae("currently-watching-carousel",B),ae("want-to-watch-carousel",O);const ee=document.getElementById("modal-flairs-container");if(ee){const Ce=D.get(e)||[];ee.innerHTML=Ce.map(Y=>fe(Y,"text-xs px-2 py-1")).join("")}}else alert("Failed to update flair.")}else{const w=await gl({name:T,color:L,icon:E});w?(ve.push(w),p(),_()):alert("Failed to create flair.")}},t.classList.remove("hidden"),t.classList.remove("modal-hidden"),t.classList.add("flex")}function kl(){const e=document.getElementById("close-modal-btn"),t=document.getElementById("movie-modal"),n=()=>{t.classList.add("hidden"),t.classList.add("modal-hidden"),t.classList.remove("flex"),document.body.style.overflow="";const a=document.querySelector("footer");a&&a.classList.remove("hidden");const r=document.getElementById("iron-man-walker");r&&(r.classList.remove("walk"),r.classList.add("hidden"))};e&&(e.onclick=n),t&&(t.onclick=a=>{a.target===t&&n()})}function Tl(e){if(!e||e===0)return"N/A";const t=Math.floor(e/60),n=e%60;let a="";return t>0&&(a+=`${t}h `),n>0&&(a+=`${n}m`),a.trim()}function Ll(e){const t=document.getElementById("start-time-hour"),n=document.getElementById("start-time-minute"),a=document.getElementById("end-time"),r=document.getElementById("end-time-calculator");if(!e||e===0){r.classList.add("hidden");return}r.classList.remove("hidden");let o=new Date,s=o.getHours(),i=o.getMinutes();const l=()=>{const c=new Date;c.setHours(s,i,0,0),c.setMinutes(c.getMinutes()+e);const u=c.getHours().toString().padStart(2,"0"),f=c.getMinutes().toString().padStart(2,"0");a.textContent=`${u}:${f}`,t.textContent=s.toString().padStart(2,"0"),n.textContent=i.toString().padStart(2,"0")};t.onclick=()=>{s=(s+1)%24,l()},n.onclick=()=>{i=(i+1)%60,l()},l()}let N=[],je=[],j=1,he=!1,_r=null,re=null;async function Er(e,t){const n=document.getElementById("tv-progress-container");n.innerHTML='<div class="text-center">Loading progress...</div>',je=t.filter(a=>a.season_number>0&&a.episode_count>0),_r=e;try{const{data:a,error:r}=await y.from("media").select("id").eq("tmdb_id",e).single();if(r){console.log("Media not in DB. Executing Plan 2: Fetch and Save.");try{const i=await fetch(`https://api.themoviedb.org/3/tv/${e}?api_key=${ye}&append_to_response=content_ratings`);if(!i.ok)throw new Error("Failed to fetch TV details from TMDB");const l=await i.json(),c=l.first_air_date?parseInt(l.first_air_date.split("-")[0]):null;let u="N/A";if(l.content_ratings&&l.content_ratings.results){const m=l.content_ratings.results.find(d=>d.iso_3166_1==="US");m?u=m.rating:l.content_ratings.results.length>0&&(u=l.content_ratings.results[0].rating)}const{data:f,error:h}=await y.from("media").insert({tmdb_id:e,type:"series",title:l.name,poster_path:l.poster_path,backdrop_path:l.backdrop_path,release_year:c,source:"fetched",runtime:l.episode_run_time?.[0]||0,content_rating:u}).select("id").single();if(h)throw h;re=f.id,console.log("Plan 2 Successful: Media saved to DB with ID:",re)}catch(i){console.error("Plan 2 Failed:",i),n.innerHTML=`
                    <div class="text-center py-8 px-4">
                        <i class="fas fa-exclamation-circle text-danger text-3xl mb-3"></i>
                        <p class="text-text-muted">Failed to sync TV show data.</p>
                        <p class="text-text-muted text-sm mt-2">Please try adding it to your watchlist manually first.</p>
                    </div>
                `;return}}else re=a.id;const[o,s]=await Promise.all([y.from("episode_progress").select("*").eq("media_id",re).eq("viewer","user1"),y.from("episode_progress").select("*").eq("media_id",re).eq("viewer","user2")]);if(o.error)throw o.error;if(s.error)throw s.error;if(N=[...o.data||[],...s.data||[]],n.innerHTML=`
            <div class="flex justify-between items-center sticky top-0 z-40 bg-bg-tertiary/95 backdrop-blur-md py-3 px-4 border-b border-white/5 mb-4 rounded-t-lg">
                <div class="relative group">
                    <select id="season-select" class="appearance-none bg-black/20 hover:bg-black/40 text-text-primary py-2 pl-4 pr-10 rounded-full font-semibold focus:outline-none focus:ring-2 focus:ring-accent-primary cursor-pointer transition-all border border-white/10">
                        ${je.map(i=>`<option value="${i.season_number}">Season ${i.season_number}</option>`).join("")}
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-text-muted group-hover:text-text-primary transition-colors">
                        <i class="fas fa-chevron-down text-xs"></i>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                     <button id="mark-season-watched-btn" class="text-xs py-2 px-4 rounded-full bg-accent-secondary/20 text-accent-secondary hover:bg-accent-secondary hover:text-white border border-accent-secondary/50 transition font-semibold flex items-center gap-2">
                        <i class="fas fa-check"></i> Season Watched
                    </button>
                    <button id="edit-episodes-btn" class="text-text-muted hover:text-text-primary transition p-2 rounded-full hover:bg-white/10" title="Edit Watched Status">
                        <i class="fas fa-pencil-alt"></i>
                    </button>
                </div>
            </div>

            <div id="episodes-carousel-wrapper" class="relative pb-4" style="overflow: hidden;">
                <!-- Episodes carousel will be loaded here -->
                <div class="text-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-accent-primary mx-auto"></div></div>
            </div>
        `,document.getElementById("season-select").addEventListener("change",i=>{j=parseInt(i.target.value),wt(j)}),document.getElementById("mark-season-watched-btn").addEventListener("click",()=>Sl()),document.getElementById("edit-episodes-btn").addEventListener("click",xl),je.length>0){let i=je[0].season_number;const{data:l}=await y.from("activity_log").select("details").eq("media_id",re).eq("action_type","watched_episode").order("created_at",{ascending:!1}).limit(1).maybeSingle();if(l&&l.details&&l.details.season){const u=l.details.season;je.some(f=>f.season_number===u)&&(i=u)}j=i;const c=document.getElementById("season-select");c&&(c.value=j),await wt(j)}else n.innerHTML='<div class="text-center">No seasons found.</div>'}catch(a){console.error("Error rendering TV progress:",a),n.innerHTML='<div class="text-center text-danger">Failed to load progress.</div>'}}async function wt(e){const t=document.getElementById("episodes-carousel-wrapper");if(t){t.innerHTML='<div class="text-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-accent-primary mx-auto"></div></div>';try{const n=await fetch(`https://api.themoviedb.org/3/tv/${_r}/season/${e}?api_key=${ye}`);if(!n.ok)throw new Error("Failed to fetch season details");const a=await n.json();if(!a||!a.episodes){t.innerHTML='<div class="text-center">No episodes found.</div>';return}t.innerHTML=`
            <div class="episodes-carousel-container relative px-2 sm:px-12" style="position: relative;">
                <button class="episodes-nav-btn episodes-nav-left absolute left-0 sm:left-2 top-1/2 -translate-y-1/2 z-10 bg-black/70 hover:bg-black/90 text-white p-2 sm:p-3 rounded-full transition-all shadow-lg hidden sm:block" style="position: absolute;">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div id="episodes-carousel" class="flex overflow-x-auto gap-3 sm:gap-4 pb-4 px-1 sm:px-2 scroll-smooth snap-x snap-mandatory" style="touch-action: pan-x; overscroll-behavior-x: contain; overscroll-behavior-y: none;">
                    <!-- Episodes will be inserted here -->
                </div>
                <button class="episodes-nav-btn episodes-nav-right absolute right-0 sm:right-2 top-1/2 -translate-y-1/2 z-10 bg-black/70 hover:bg-black/90 text-white p-2 sm:p-3 rounded-full transition-all shadow-lg hidden sm:block" style="position: absolute;">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        `;const r=document.getElementById("episodes-carousel");r.addEventListener("wheel",i=>{if(Math.abs(i.deltaY)>Math.abs(i.deltaX)){const c=i.deltaY;r.scrollLeft+=c,i.preventDefault(),i.stopPropagation()}else i.stopPropagation()},{passive:!1}),a.episodes.forEach(i=>{const l=N.some(d=>d.season_number===e&&d.episode_number===i.episode_number&&d.viewer==="user1"&&d.watched),c=N.some(d=>d.season_number===e&&d.episode_number===i.episode_number&&d.viewer==="user2"&&d.watched),u=l&&c,f=i.still_path?`https://image.tmdb.org/t/p/w500${i.still_path}`:"https://placehold.co/500x281?text=No+Image",h=document.createElement("div");h.className=`episode-card flex-shrink-0 w-[calc(100vw-4rem)] sm:w-72 md:w-80 relative rounded-lg overflow-hidden shadow-md bg-bg-primary cursor-pointer snap-start ${u&&he?"shake":""}`,h.style.maxWidth="400px",h.dataset.episodeNumber=i.episode_number,h.dataset.seasonNumber=e,h.innerHTML=`
                <div class="relative aspect-video">
                    <img src="${f}" alt="${i.name}" class="w-full h-full object-cover transition-opacity duration-300 ${u?"opacity-50":"opacity-100"}">
                    <div class="absolute top-0 left-0 bg-black/80 text-white text-xs font-bold px-2 py-1 rounded-br-lg z-20">
                        E${i.episode_number}
                    </div>
                    ${u?`
                        <div class="absolute inset-0 flex items-center justify-center pointer-events-none z-10">
                            <i class="fas fa-check text-success text-4xl drop-shadow-lg"></i>
                        </div>
                    `:""}
                    <button class="unwatch-btn absolute top-2 right-2 bg-danger text-white rounded-full w-7 h-7 flex items-center justify-center hover:bg-red-700 transition z-30 ${u&&he?"":"hidden"}">
                        <i class="fas fa-times text-xs"></i>
                    </button>
                </div>
                <div class="p-3">
                    <h4 class="font-semibold text-sm truncate" title="${i.name}">${i.name}</h4>
                    <p class="text-xs text-text-muted line-clamp-2 mt-1">${i.overview||"No description available."}</p>
                </div>
            `,h.addEventListener("click",d=>{d.target.closest(".unwatch-btn")||he||u||pa(e,i.episode_number,!0)}),h.querySelector(".unwatch-btn").addEventListener("click",d=>{d.stopPropagation(),pa(e,i.episode_number,!1)}),r.appendChild(h)});const o=t.querySelector(".episodes-nav-left"),s=t.querySelector(".episodes-nav-right");o.addEventListener("click",()=>{r.scrollBy({left:-r.clientWidth,behavior:"smooth"})}),s.addEventListener("click",()=>{r.scrollBy({left:r.clientWidth,behavior:"smooth"})}),Ir(a.episodes.length)}catch(n){console.error("Error rendering season episodes:",n),t.innerHTML='<div class="text-center text-danger">Failed to load episodes.</div>'}}}async function pa(e,t,n){["user1","user2"].forEach(o=>{const s=N.findIndex(i=>i.season_number===e&&i.episode_number===t&&i.viewer===o);s>=0?N[s].watched=n:N.push({media_id:re,season_number:e,episode_number:t,watched:n,viewer:o})}),Cl(e,t,n),Ir(document.querySelectorAll(".episode-card").length);const a=["user1","user2"].map(o=>({media_id:re,viewer:o,season_number:e,episode_number:t,watched:n})),{error:r}=await y.from("episode_progress").upsert(a,{onConflict:"media_id,viewer,season_number,episode_number"});r?(console.error("Error updating episode progress:",r),wt(j)):n&&await oe("watched_episode","both",g,{season:e,episode:t})}async function Sl(){const e=document.querySelectorAll(".episode-card");if(e.length===0)return;const n=!Array.from(e).every(o=>{const s=parseInt(o.dataset.episodeNumber),i=N.some(c=>c.season_number===j&&c.episode_number===s&&c.viewer==="user1"&&c.watched),l=N.some(c=>c.season_number===j&&c.episode_number===s&&c.viewer==="user2"&&c.watched);return i&&l}),a=[];e.forEach(o=>{const s=parseInt(o.dataset.episodeNumber);["user1","user2"].forEach(i=>{const l=N.findIndex(c=>c.season_number===j&&c.episode_number===s&&c.viewer===i);l>=0?N[l].watched=n:N.push({media_id:re,season_number:j,episode_number:s,watched:n,viewer:i}),a.push({media_id:re,viewer:i,season_number:j,episode_number:s,watched:n})})}),wt(j);const{error:r}=await y.from("episode_progress").upsert(a,{onConflict:"media_id,viewer,season_number,episode_number"});r&&console.error("Error updating season progress:",r)}async function Al(e){try{const{data:t,error:n}=await y.from("media").select("id").eq("tmdb_id",e).single();if(n)throw console.error("Error fetching media for markAllEpisodesWatched:",n),new Error("Could not find media in database");const a=t.id,r=await fetch(`https://api.themoviedb.org/3/tv/${e}?api_key=${ye}`);if(!r.ok)throw new Error("Failed to fetch TV series details");const o=await r.json(),s=[];for(const i of o.seasons)if(i.season_number>0&&i.episode_count>0){const l=await fetch(`https://api.themoviedb.org/3/tv/${e}/season/${i.season_number}?api_key=${ye}`);if(!l.ok)throw new Error(`Failed to fetch season ${i.season_number} details`);(await l.json()).episodes.forEach(u=>{["user1","user2"].forEach(f=>{s.push({media_id:a,viewer:f,season_number:i.season_number,episode_number:u.episode_number,watched:!0})})})}if(s.length>0){const{error:i}=await y.from("episode_progress").upsert(s,{onConflict:"media_id,viewer,season_number,episode_number"});i?console.error("Error marking all episodes watched:",i):(console.log("All episodes marked as watched successfully."),await Er(e,o.seasons))}}catch(t){console.error("Error in markAllEpisodesWatched:",t)}}function xl(){he=!he;const e=document.getElementById("edit-episodes-btn");he?e.classList.add("text-accent-primary","animate-pulse"):e.classList.remove("text-accent-primary","animate-pulse"),document.querySelectorAll(".episode-card").forEach(n=>{const a=parseInt(n.dataset.episodeNumber),r=parseInt(n.dataset.seasonNumber),o=N.some(c=>c.season_number===r&&c.episode_number===a&&c.viewer==="user1"&&c.watched),s=N.some(c=>c.season_number===r&&c.episode_number===a&&c.viewer==="user2"&&c.watched),i=o&&s,l=n.querySelector(".unwatch-btn");i&&he?(n.classList.add("shake"),l.classList.remove("hidden")):(n.classList.remove("shake"),l.classList.add("hidden"))})}function Cl(e,t,n){const a=document.querySelector(`.episode-card[data-season-number="${e}"][data-episode-number="${t}"]`);if(!a)return;const r=a.querySelector("img"),o=a.querySelector(".fa-check")?.parentElement,s=a.querySelector(".unwatch-btn");if(n){if(r.classList.remove("opacity-100"),r.classList.add("opacity-50"),!o){const i=document.createElement("div");i.className="absolute inset-0 flex items-center justify-center pointer-events-none",i.innerHTML='<i class="fas fa-check text-success text-4xl drop-shadow-lg"></i>',a.querySelector(".aspect-video").appendChild(i)}he&&(a.classList.add("shake"),s.classList.remove("hidden"))}else r.classList.remove("opacity-50"),r.classList.add("opacity-100"),o&&o.remove(),a.classList.remove("shake"),s.classList.add("hidden")}function Ir(e){const t=document.getElementById("mark-season-watched-btn");if(!t)return;[...new Set(N.filter(r=>r.season_number===j&&r.watched).map(r=>r.episode_number))].filter(r=>{const o=N.some(i=>i.season_number===j&&i.episode_number===r&&i.viewer==="user1"&&i.watched),s=N.some(i=>i.season_number===j&&i.episode_number===r&&i.viewer==="user2"&&i.watched);return o&&s}).length===e&&e>0?(t.textContent="Season Watched",t.classList.remove("bg-accent-secondary"),t.classList.add("bg-success")):(t.textContent="Mark Season Watched",t.classList.remove("bg-success"),t.classList.add("bg-accent-secondary","text-white"),t.classList.remove("text-accent-secondary"))}function kr(e,t){let n;return function(...a){const r=this;clearTimeout(n),n=setTimeout(()=>e.apply(r,a),t)}}const an=kr(Rl,500);async function Rl(){const t=document.getElementById("movie-modal").dataset.tmdbId;if(!t){console.error("saveRatingsAndNotes: tmdbId not found on modal");return}const n=document.querySelector("#juainny-rating-container .rating-input-hidden").value,a=document.querySelector("#erick-rating-container .rating-input-hidden").value,r={juainny_rating:parseFloat(n)||null,juainny_notes:document.getElementById("juainny-notes").innerHTML||null,erick_rating:parseFloat(a)||null,erick_notes:document.getElementById("erick-notes").innerHTML||null};if(!t){console.error("saveRatingsAndNotes: tmdbId is missing!");return}const{data:o,error:s}=await y.from("media").select("tmdb_id").eq("tmdb_id",t).single();if(s&&s.code!=="PGRST116"){console.error("Error checking for existing media:",s);return}let i;if(o)i=await y.from("media").update(r).eq("tmdb_id",t).select().single();else{console.log("Ratings and notes not saved: item not in database. Add to watchlist first.");return}const{data:l,error:c}=i;c?console.error("Error saving ratings and notes:",c):(g&&(r.juainny_rating!==g.juainny_rating&&r.juainny_rating!==null&&await oe("rate","juainny",l,{rating:r.juainny_rating}),r.juainny_notes!==g.juainny_notes&&r.juainny_notes!==""&&await oe("note_added","juainny",l),r.erick_rating!==g.erick_rating&&r.erick_rating!==null&&await oe("rate","erick",l,{rating:r.erick_rating}),r.erick_notes!==g.erick_notes&&r.erick_notes!==""&&await oe("note_added","erick",l)),g=l)}function Bl(){["juainny-notes","erick-notes"].forEach(t=>{const n=document.getElementById(t);n&&n.addEventListener("input",an)})}function Dl(){const e=document.getElementById("random-movie-btn");e&&e.addEventListener("click",()=>{if(P.length===0){console.log("No movies to choose from!");return}const t=P[Math.floor(Math.random()*P.length)],n=t.tmdb_id||t.id,a=t.type||t.media_type;Lt(n,a)})}function Ml(){switch(bt){case"popularity":P.sort((n,a)=>a.popularity-n.popularity);break;case"alphabetical":P.sort((n,a)=>(n.title||n.name).localeCompare(a.title||a.name));break;case"release_date":P.sort((n,a)=>{const r=new Date(n.release_date||n.first_air_date);return new Date(a.release_date||a.first_air_date)-r});break;case"length":P.sort((n,a)=>(a.runtime||a.episode_run_time?.[0]||0)-(n.runtime||n.episode_run_time?.[0]||0));break;case"default":default:const e=P.filter(n=>n.source==="fetched").sort((n,a)=>n.id-a.id);P=[...P.filter(n=>n.source!=="fetched").sort((n,a)=>{const r=new Date(n.release_date||n.first_air_date);return new Date(a.release_date||a.first_air_date)-r}),...e];break}}function $l(){document.getElementById("sort-select").addEventListener("change",t=>{bt=t.target.value,V()})}function Ol(){const e=document.getElementById("filter-controls");e.addEventListener("click",t=>{if(t.target.matches(".filter-btn")){const n=t.target.dataset.filter;if(n===ne)return;ne=n,e.querySelectorAll(".filter-btn").forEach(a=>{a.classList.remove("btn-active")}),t.target.classList.add("btn-active"),V()}})}function rn(e){const t=document.querySelector(".movie-modal-content"),n=document.querySelector(`.movie-card[data-tmdb-id="${e.tmdb_id}"]`),a=e.favorited_by||[],r=a.includes("user1"),o=a.includes("user2");[t,n].forEach(s=>{s&&(s.classList.remove("favorite-glow","rainbow-glow"),r&&o?s.classList.add("rainbow-glow"):(r||o)&&s.classList.add("favorite-glow"))})}async function oe(e,t,n,a={}){try{if(!n||!n.id){console.warn("Cannot log activity: Missing media ID");return}const{error:r}=await y.from("activity_log").insert({media_id:n.id,tmdb_id:n.tmdb_id,action_type:e,user_id:t,details:a});r?console.error("Error logging activity:",r):console.log(`Activity logged: ${e} by ${t}`)}catch(r){console.error("Unexpected error logging activity:",r)}}function Pl(){const e=document.getElementById("favorite-btn"),t=document.getElementById("user-selection-menu");e.addEventListener("click",()=>{t.classList.toggle("hidden")}),t.addEventListener("click",async n=>{if(n.target.matches("button")){const a=n.target.id.replace("-btn",""),r=g.tmdb_id,o=g.type||g.media_type,s=g.title||g.name,i=g.poster_path,l=await Pe(r,o,s,i);if(!l){console.error("Failed to ensure media item exists"),t.classList.add("hidden");return}if(a==="remove-all"){const{error:c}=await y.from("media").update({favorited_by:[]}).eq("tmdb_id",r);c?console.error("Error removing all favorites:",c):(g.favorited_by=[],rn(g))}else{const c=a,u=c==="user1"?"juainny":"erick",{data:f,error:h}=await y.from("media").select("id, tmdb_id, title, poster_path, favorited_by").contains("favorited_by",[c]);if(h){console.error("Error checking favorite count:",h),t.classList.add("hidden");return}if(f&&f.length>=3&&!f.some(T=>T.tmdb_id===r)){const T=await Nl(f);if(!T){t.classList.add("hidden");return}const L=f.find(E=>E.tmdb_id===T);if(L){const E=(L.favorited_by||[]).filter(w=>w!==c);await y.from("media").update({favorited_by:E}).eq("tmdb_id",T);const b=A.findIndex(w=>w.tmdb_id==T);b>-1&&(A[b].favorited_by=E)}}let m=l.favorited_by||[];if(typeof m=="string")try{m=JSON.parse(m)}catch{m=[]}m.includes(c)?m=m.filter(_=>_!==c):m.push(c);const{data:d,error:p}=await y.from("media").update({favorited_by:m}).eq("tmdb_id",r).select().single();if(p)console.error("Error updating favorites:",p);else{g=d,rn(g);const _=A.findIndex(T=>T.tmdb_id===r);_>-1&&(A[_]=d),m.includes(c)&&await oe("favorite",u,d)}}V(),t.classList.add("hidden")}})}async function Nl(e,t){return new Promise(n=>{const a=document.getElementById("favorite-removal-modal"),r=document.getElementById("favorite-removal-list"),o=document.getElementById("cancel-favorite-removal-btn");r.innerHTML="",e.forEach(i=>{const l=document.createElement("div");l.className="flex items-center gap-3 p-3 rounded-lg border border-border-primary hover:bg-bg-tertiary cursor-pointer transition";const c=i.poster_path?`https://image.tmdb.org/t/p/w92${i.poster_path}`:"https://placehold.co/92x138?text=No+Image";l.innerHTML=`
                <img src="${c}" class="w-12 h-18 object-cover rounded" alt="${i.title}">
                <span class="flex-grow text-text-primary font-semibold">${i.title}</span>
                <button class="remove-favorite-btn text-danger hover:text-red-400 px-3 py-1 border border-danger rounded transition" data-tmdb-id="${i.tmdb_id}">
                    <i class="fas fa-times"></i> Remove
                </button>
            `,l.querySelector(".remove-favorite-btn").addEventListener("click",()=>{a.classList.add("hidden"),a.classList.remove("flex"),n(i.tmdb_id)}),r.appendChild(l)});const s=()=>{a.classList.add("hidden"),a.classList.remove("flex"),n(null)};o.removeEventListener("click",s),o.addEventListener("click",s),a.classList.remove("hidden"),a.classList.add("flex")})}function He(e){const t=document.getElementById("toggle-watched-btn"),n=document.getElementById("currently-watching-btn"),a=document.getElementById("remove-currently-watching-btn"),r=document.getElementById("bookmark-btn");n.classList.add("hidden"),a.classList.add("hidden"),t.classList.remove("hidden"),e.watched?(t.textContent="Mark as Unwatched",t.classList.replace("bg-success","bg-gray-600")):e.currently_watching?(t.textContent="Mark as Watched",t.classList.replace("bg-gray-600","bg-success"),a.classList.remove("hidden")):(t.textContent="Mark as Watched",t.classList.replace("bg-gray-600","bg-success"),n.classList.remove("hidden")),e.want_to_watch?r.classList.add("text-accent-primary"):r.classList.remove("text-accent-primary")}async function Pe(e,t,n,a=null){let r=t;r==="tv"&&(r="series");let{data:o,error:s}=await y.from("media").select("*").eq("tmdb_id",e).single();if(s&&s.code!=="PGRST116")return console.error("Error checking for media item:",s),null;if(o){if(a&&!o.poster_path){const{data:c,error:u}=await y.from("media").update({poster_path:a}).eq("tmdb_id",e).select().single();return u?(console.error("Error updating poster path:",u),o):c}return o}const{data:i,error:l}=await y.from("media").insert({tmdb_id:e,type:r,title:n,poster_path:a,source:"added"}).select().single();return l?(console.error("Error creating new media item:",l),null):i}function Fl(){const e=document.getElementById("toggle-watched-btn"),t=document.getElementById("toggle-rejected-btn"),n=document.getElementById("currently-watching-btn"),a=document.getElementById("remove-currently-watching-btn"),r=document.getElementById("bookmark-btn"),o=async s=>{const{tmdb_id:i,type:l,title:c,poster_path:u}=g;if(!await Pe(i,l,c,u))return;if((l==="tv"||l==="series")&&!g.watched&&!s){const _=await Kl("Mark Series Watched?","How would you like to mark this series?");if(_==="cancel")return;_==="all-episodes"&&await Al(i)}const h=s?!1:!g.watched;let m={watched:h};s&&(m.currently_watching=!1,m.source=null),h&&(m.currently_watching=!1,m.want_to_watch=!1);const{data:d,error:p}=await y.from("media").update(m).eq("tmdb_id",i).select().single();if(p)console.error("Error updating watched status:",p);else{g=d,He(g);const _=A.findIndex(T=>T.tmdb_id===i);_>-1?A[_]=d:A.push(d),h&&!s&&await oe("watched","both",d),V()}};a.addEventListener("click",async()=>{const{tmdb_id:s}=g,{data:i,error:l}=await y.from("media").update({currently_watching:!1}).eq("tmdb_id",s).select().single();l?console.error("Error removing from currently watching:",l):(g=i,He(g))}),n.addEventListener("click",async()=>{const{tmdb_id:s,type:i,title:l,poster_path:c}=g;if(!await Pe(s,i,l,c))return;const f={currently_watching:!0,want_to_watch:!1,watched:!1},{data:h,error:m}=await y.from("media").update(f).eq("tmdb_id",s).select().single();m?console.error("Error setting currently watching:",m):(g=h,He(g),await oe("currently_watching","both",h))}),r.addEventListener("click",async()=>{const{tmdb_id:s,type:i,title:l,poster_path:c}=g;if(!await Pe(s,i,l,c))return;const f=!g.want_to_watch;let h={want_to_watch:f};f&&(h.currently_watching=!1);const{data:m,error:d}=await y.from("media").update(h).eq("tmdb_id",s).select().single();d?console.error("Error updating bookmark:",d):(g=m,He(g),f&&await oe("want_to_watch","both",m))}),e.addEventListener("click",()=>o(!1)),t.addEventListener("click",()=>o(!0))}function jl(){const e=document.getElementById("tooltip");document.addEventListener("mouseover",t=>{if(t.target.matches("[title]")){const n=t.target.getAttribute("title");t.target.setAttribute("data-original-title",n),t.target.removeAttribute("title"),e.textContent=n,e.classList.remove("hidden");const a=t.target.getBoundingClientRect();e.style.left=`${a.left+a.width/2-e.offsetWidth/2}px`,e.style.top=`${a.top-e.offsetHeight-5}px`}}),document.addEventListener("mouseout",t=>{t.target.matches("[data-original-title]")&&(t.target.setAttribute("title",t.target.getAttribute("data-original-title")),t.target.removeAttribute("data-original-title"),e.classList.add("hidden"))})}function Hl(){const e=document.getElementById("view-controls");e.addEventListener("click",t=>{const n=t.target.closest(".view-btn");if(n){const a=n.dataset.view;if(a===nn)return;nn=a,e.querySelectorAll(".view-btn").forEach(r=>{r.classList.remove("btn-active")}),n.classList.add("btn-active"),V()}})}async function Ul(){try{console.log("App Initializing... v2.1"),ve=await hl();const{data:e,error:t}=await y.from("media_flairs").select("media_id, flairs(*)");!t&&e&&e.forEach(b=>{D.has(b.media_id)||D.set(b.media_id,[]),D.get(b.media_id).push(b.flairs)});const n=await qe();ae("currently-watching-carousel",n);const a=await We();ae("want-to-watch-carousel",a),y.channel("media-carousels").on("postgres_changes",{event:"*",schema:"public",table:"media"},async b=>{const[w,S]=await Promise.all([qe(),We()]);ae("currently-watching-carousel",w),ae("want-to-watch-carousel",S)}).subscribe(),y.channel("media").on("postgres_changes",{event:"*",schema:"public",table:"media"},async b=>{const[w,S]=await Promise.all([qe(),We()]);ae("currently-watching-carousel",w),ae("want-to-watch-carousel",S)}).subscribe(),new URLSearchParams(window.location.search).get("hardrefresh")==="true"&&(await ul(),window.history.replaceState({},document.title,window.location.pathname));const s=document.getElementById("loading-spinner");s&&(s.style.display="flex");const{data:i,error:l}=await y.from("media").select("*");if(l){console.error("Error fetching all media:",l);return}A=await vl(i),Oe=A.filter(b=>b.watched),V(),s&&(s.style.display="none");const c=document.getElementById("search-bar");c.setAttribute("autocomplete","off"),c.setAttribute("data-lpignore","true"),c.setAttribute("data-form-type","other"),c.setAttribute("spellcheck","false");const u=document.getElementById("sort-select"),f=document.getElementById("home-btn"),h=document.getElementById("logo-container"),m=document.getElementById("currently-watching-section"),d=document.getElementById("want-to-watch-section"),p=()=>{c.value="",Oe=A,ne="watched",u.value="default",bt="default",u.disabled=!1,f.classList.add("hidden"),m.classList.remove("hidden"),d.classList.remove("hidden");const b=document.getElementById("watched-items-header");b&&b.classList.remove("hidden"),V(),on()},T=kr(async b=>{console.log("Search input event:",b.target.value);try{const w=b.target.value.trim();if(w==="")p();else{f.classList.remove("hidden"),m.classList.add("hidden"),d.classList.add("hidden");const S=document.getElementById("watched-items-header");S&&S.classList.add("hidden"),console.log("Executing search for:",w),Oe=await _l(w),bt="popularity",ne="all",u.disabled=!0,V()}}catch(w){console.error("Error in search handler:",w)}},300);c.addEventListener("input",T),f.addEventListener("click",p),h.addEventListener("click",p),kl(),Bl(),Ol(),Hl(),Dl(),jl(),Pl(),Fl(),$l(),Or(),await Ye(),ql(),Wl(),on();const L=document.getElementById("notification-btn");L&&L.addEventListener("click",()=>{alert("Notifications Coming Soon!")});const E=document.getElementById("avatar-toggle");E&&E.addEventListener("change",b=>{document.body.classList.toggle("show-avatars",b.target.checked)}),ut(),document.addEventListener("click",b=>{const w=document.getElementById("reaction-tooltip");w&&!w.classList.contains("hidden")&&(b.target.closest(".reaction-item")||Qe())})}catch(e){console.error("Error during app initialization:",e)}}function ql(){const e=document.getElementById("user-menu-btn"),t=document.getElementById("user-menu");e&&t&&e.addEventListener("click",()=>{t.classList.toggle("hidden")})}function Wl(){const e={"currently-watching":document.getElementById("edit-currently-watching-btn"),"want-to-watch":document.getElementById("edit-want-to-watch-btn")},t={"currently-watching":document.getElementById("currently-watching-carousel"),"want-to-watch":document.getElementById("want-to-watch-carousel")};let n={"currently-watching":!1,"want-to-watch":!1};const a=r=>{n[r]=!n[r];const o=t[r],s=e[r];n[r]?(s.classList.add("text-accent-primary"),o.querySelectorAll(".movie-card").forEach(i=>{i.classList.add("shake");const l=document.createElement("button");l.className="absolute inset-0 bg-black bg-opacity-50 text-white flex items-center justify-center text-4xl",l.innerHTML='<i class="fas fa-times"></i>',l.onclick=async()=>{const c=i.dataset.tmdbId,u=r==="currently-watching"?{currently_watching:!1}:{want_to_watch:!1},{error:f}=await y.from("media").update(u).eq("tmdb_id",c);f?console.error(`Error removing from ${r}:`,f):i.remove()},i.appendChild(l)})):(s.classList.remove("text-accent-primary"),o.querySelectorAll(".movie-card").forEach(i=>{i.classList.remove("shake"),i.querySelector("button")?.remove()}))};e["currently-watching"].addEventListener("click",()=>a("currently-watching")),e["want-to-watch"].addEventListener("click",()=>a("want-to-watch"))}document.addEventListener("DOMContentLoaded",Ul);const Vl=["24klabubu.png","afraid.png","amazed.png","angry.png","bored.png","celebratory.png","crazy.png","crying.png","disgusted.png","happy.png","melted.png","neutral.png","not-a-fan.png","sad.png","satisfied.png","sexy.png","surprised.png","thinking.png","tea.png","lol.png"],Tr={"tea.png":"Das Tea","lol.png":"Laughter","24klabubu.png":"24k Labubu","not-a-fan.png":"Not A Fan"};function zl(e){const t=document.getElementById("mood-modal-container");if(!t){console.error("mood-modal-container not found!");return}t.style.cssText=`
        position: fixed;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 99999;
    `,Ee=null,Me=null,t.innerHTML=`
        <div class="mood-modal" style="background-color: #1a1a1a; color: white; border-radius: 1rem; width: 95%; max-width: 40rem; max-height: 80vh; overflow-y: auto; position: relative; border: 1px solid #404040; display: flex; flex-direction: column; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);">
            <button id="close-mood-modal-btn" style="position: absolute; top: 1rem; right: 1rem; background: rgba(255,255,255,0.1); border-radius: 50%; padding: 0.5rem; cursor: pointer; color: white;">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <div style="padding: 1.5rem;">
                <h2 class="text-2xl font-bold mb-6 text-center">How did this movie make you react?</h2>
                
                <div class="flex justify-center mb-8 gap-4">
                    <button class="user-select-btn" data-user="juainny">
                        <div class="user-avatar-preview user1-avatar-preview">J</div>
                        <span class="font-semibold">Juainny</span>
                    </button>
                    <button class="user-select-btn" data-user="erick">
                        <div class="user-avatar-preview user2-avatar-preview">E</div>
                        <span class="font-semibold">Erick</span>
                    </button>
                </div>

                <div id="mood-grid-container" class="mood-grid grayscale transition-all duration-300" style="opacity: 0.5; pointer-events: none;">
                    ${Vl.map(r=>{const o=Tr[r]||r.replace(".png","").replace(/-/g," ").replace(/_/g," ");return`
                        <div class="mood-option" data-mood="${r}" role="button" aria-label="${o}">
                            <img src="moods/${r}" alt="${o}">
                            <span class="mood-label">${o}</span>
                        </div>
                    `}).join("")}
                </div>

                <div class="mt-8 text-center">
                    <button id="mood-done-btn" class="bg-accent-primary hover:bg-accent-secondary text-text-on-accent font-bold py-2 px-8 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>Done</button>
                </div>
            </div>
        </div >
        `,document.getElementById("close-mood-modal-btn").addEventListener("click",closeReactionSelector),t.addEventListener("click",r=>{r.target===t&&closeReactionSelector()});const n=t.querySelectorAll(".user-select-btn");n.forEach(r=>{r.addEventListener("click",()=>{n.forEach(s=>s.classList.remove("selected")),r.classList.add("selected"),Ee=r.dataset.user;const o=document.getElementById("mood-grid-container");o.classList.remove("grayscale"),o.style.opacity="1",o.style.pointerEvents="auto",ga()})});const a=t.querySelectorAll(".mood-option");a.forEach(r=>{r.addEventListener("click",()=>{Ee&&(a.forEach(o=>o.classList.remove("selected")),r.classList.add("selected"),Me=r.dataset.mood,ga())})}),document.getElementById("mood-done-btn").addEventListener("click",()=>{Ee&&Me&&(Gl(e,Ee,Me),closeReactionSelector())})}let Ee=null,Me=null;function ga(){const e=document.getElementById("mood-done-btn");Ee&&Me?e.disabled=!1:e.disabled=!0}window.closeReactionSelector=function(){const e=document.getElementById("mood-modal-container");e&&(e.innerHTML="",e.style.cssText=""),Ee=null,Me=null};async function Gl(e,t,n){const a={};if((t==="user1"||t==="juainny")&&(a.juainny_reaction=n),(t==="user2"||t==="erick")&&(a.erick_reaction=n),g&&g.tmdb_id==e)g.title||g.name,g.poster_path,g.type||g.title;else{const i=A.find(l=>l.tmdb_id==e);i&&(i.title||i.name,i.poster_path,i.type)}g&&g.tmdb_id==e&&(t==="user1"&&(g.juainny_reaction=n),t==="user2"&&(g.erick_reaction=n),St());const r=A.findIndex(i=>i.tmdb_id==e);if(r>-1){A[r]={...A[r],...a},V();const i=await qe();ae("currently-watching-carousel",i);const l=await We();ae("want-to-watch-carousel",l)}const{data:o,error:s}=await y.from("media").update(a).eq("tmdb_id",e).select().single();s?(console.error("Error saving reaction:",s),alert("Failed to save reaction. Please try again.")):(console.log("Reaction saved successfully to DB for TMDB ID:",e),o&&n&&await oe("reaction",t==="user1"||t==="juainny"?"juainny":"erick",o,{reaction:n}))}function St(){const e=document.getElementById("modal-mood-display"),t=document.getElementById("remove-mood-btn");if(!e)return;e.innerHTML="";let n=!1;g?.juainny_reaction&&(n=!0,e.innerHTML+=`
        <div class="relative group" title="Juainny's Reaction">
            <img src="moods/${g.juainny_reaction}" class="w-10 h-10 object-contain drop-shadow-md">
                <div class="absolute -bottom-1 -right-1 w-4 h-4">
                    ${G("juainny","w-full h-full")}
                </div>
            </div>
    `),g?.erick_reaction&&(n=!0,e.innerHTML+=`
        <div class="relative group" title="Erick's Reaction">
            <img src="moods/${g.erick_reaction}" class="w-10 h-10 object-contain drop-shadow-md">
                <div class="absolute -bottom-1 -right-1 w-4 h-4">
                    ${G("erick","w-full h-full")}
                </div>
            </div>
    `),n?(t.classList.remove("hidden"),t.onclick=async()=>{if(confirm("Remove all reactions for this item?")){const a={juainny_reaction:null,erick_reaction:null};g.juainny_reaction=null,g.erick_reaction=null,St(),await y.from("media").update(a).eq("tmdb_id",g.tmdb_id),V()}}):t.classList.add("hidden")}function on(){document.querySelectorAll(".movie-card").forEach(e=>{const t=e.dataset.tmdbId,n=A.find(a=>a.tmdb_id==t);if(n){const a=e.querySelector(".absolute.top-2.left-2");if(a){let r="";n.juainny_reaction&&(r+=`
                        <div class="relative w-8 h-8 group/reaction cursor-pointer reaction-item" data-user="Juainny" data-reaction="${n.juainny_reaction}">
                            <img src="moods/${n.juainny_reaction}" class="w-full h-full object-contain drop-shadow-md">
                            <div class="absolute -bottom-1 -right-1 w-4 h-4">
                                ${G("juainny","w-full h-full")}
                            </div>
                        </div>
                    `),n.erick_reaction&&(r+=`
                        <div class="relative w-8 h-8 group/reaction cursor-pointer reaction-item" data-user="Erick" data-reaction="${n.erick_reaction}">
                            <img src="moods/${n.erick_reaction}" class="w-full h-full object-contain drop-shadow-md">
                            <div class="absolute -bottom-1 -right-1 w-4 h-4">
                                ${G("erick","w-full h-full")}
                            </div>
                        </div>
                    `),a.innerHTML=r,a.querySelectorAll(".reaction-item").forEach(o=>{o.addEventListener("mouseenter",s=>{At(s.currentTarget)}),o.addEventListener("mouseleave",()=>{Qe()}),o.addEventListener("click",s=>{Sn(s.currentTarget,s)})})}}}),g&&St()}let Ln=null;function At(e){const t=document.getElementById("reaction-tooltip"),n=document.getElementById("tooltip-avatar"),a=document.getElementById("tooltip-text");if(!t||!n||!a)return;const r=e.dataset.user,o=e.dataset.reaction;let s=Tr[o];s||(s=o.replace(".png","").replace(/_/g," ").replace(/-/g," ").split(" ").map(u=>u.charAt(0).toUpperCase()+u.slice(1)).join(" ")),n.innerHTML=G(r.toLowerCase(),"w-6 h-6"),a.textContent=`${r} reacted with ${s}`;const i=e.getBoundingClientRect(),l=window.pageYOffset||document.documentElement.scrollTop,c=window.pageXOffset||document.documentElement.scrollLeft;t.style.position="absolute",t.style.left=`${i.left+c+i.width/2}px`,t.style.top=`${i.bottom+l+8}px`,t.style.transform="translateX(-50%)",t.classList.remove("hidden"),Ln=e}function Qe(){const e=document.getElementById("reaction-tooltip");e&&(e.classList.add("hidden"),Ln=null)}function Sn(e,t){t.stopPropagation(),Ln===e?Qe():At(e)}function Kl(e,t){return new Promise(n=>{const a=document.getElementById("confirmation-modal"),r=document.getElementById("confirmation-title"),o=document.getElementById("confirmation-message"),s=document.getElementById("confirm-series-only-btn"),i=document.getElementById("confirm-all-episodes-btn"),l=document.getElementById("cancel-confirmation-btn");r.textContent=e,o.textContent=t,i&&i.classList.remove("hidden"),a.classList.remove("hidden"),a.classList.add("flex");const c=()=>{a.classList.add("hidden"),a.classList.remove("flex"),s.onclick=null,i&&(i.onclick=null),l.onclick=null};s.onclick=()=>{c(),n("series-only")},i&&(i.onclick=()=>{c(),n("all-episodes")}),l.onclick=()=>{c(),n("cancel")}})}const ya=document.getElementById("willow-fab"),Ut=document.getElementById("willow-chat-modal"),it=document.getElementById("willow-chat-container"),ba=document.getElementById("willow-chat-form"),Be=document.getElementById("willow-chat-input"),Ne=document.getElementById("willow-chat-messages");window.toggleWillowChat=function(){Ut.classList.contains("hidden")?(Ut.classList.remove("hidden"),setTimeout(()=>{it.classList.remove("translate-y-full"),it.classList.add("translate-y-0")},10),Be.focus()):(it.classList.remove("translate-y-0"),it.classList.add("translate-y-full"),setTimeout(()=>{Ut.classList.add("hidden")},300))};ya&&ya.addEventListener("click",window.toggleWillowChat);ba&&ba.addEventListener("submit",async e=>{e.preventDefault();const t=Be.value.trim();if(!t)return;wa(t,"user"),Be.value="",Be.disabled=!0;const n=Yl(),a=await wl(t,A);Jl(n),wa(a,"ai"),Be.disabled=!1,Be.focus()});function dt(e){return e.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/^- (.+)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>)/s,'<ul class="list-disc pl-4 space-y-1">$1</ul>').replace(/\n/g,"<br>")}function wa(e,t){const n=document.createElement("div");n.className=`flex items-start gap-2 ${t==="user"?"flex-row-reverse":""}`;const a=t==="ai"?'<div class="w-10 h-10 flex-shrink-0 flex items-center justify-center overflow-hidden"><img src="/willow-logo.png" class="w-full h-full object-contain"></div>':"",r=t==="ai"?"bg-bg-tertiary text-text-primary rounded-tl-none":"bg-teal-600 text-white rounded-tr-none",o=t==="ai"?dt(e):e;return n.innerHTML=`
        ${a}
        <div class="${r} p-3 rounded-2xl text-sm shadow-sm max-w-[85%] markdown-content">
            ${o}
        </div>
    `,Ne.appendChild(n),Ne.scrollTop=Ne.scrollHeight,n.id="msg-"+Date.now()}function Yl(){const e=document.createElement("div");return e.id="typing-"+Date.now(),e.className="flex items-start gap-2",e.innerHTML=`
        <div class="w-10 h-10 flex-shrink-0 flex items-center justify-center overflow-hidden"><img src="/willow-logo.png" class="w-full h-full object-contain"></div>
        <div class="bg-bg-tertiary p-3 rounded-2xl rounded-tl-none text-text-primary text-sm shadow-sm">
            <div class="flex space-x-1">
                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
            </div>
        </div>
    `,Ne.appendChild(e),Ne.scrollTop=Ne.scrollHeight,e.id}function Jl(e){const t=document.getElementById(e);t&&t.remove()}const Xl=Object.freeze(Object.defineProperty({__proto__:null,refreshAllReactionAvatars:on},Symbol.toStringTag,{value:"Module"}));
