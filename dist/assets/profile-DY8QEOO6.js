import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as y}from"./supabase-client-BH5LktKS.js";let p="juainny";const x=new URLSearchParams(window.location.search),v=x.get("user");v&&(v==="juainny"||v==="erick")&&(p=v);let g={juainny:null,erick:null};async function L(){const{data:e}=await y.from("settings").select("*").eq("id",1).single();if(e){const t=e.theme||"night";document.documentElement.setAttribute("data-theme",t);const a=document.getElementById("wallpaper-overlay");e.wallpaper_url&&(document.body.style.backgroundImage=`url('${e.wallpaper_url}')`,document.body.style.backgroundSize="cover",document.body.style.backgroundPosition="center",document.body.style.backgroundRepeat="no-repeat",document.body.style.backgroundAttachment="fixed",a&&(a.style.display=t==="smiling-friends"?"none":"block")),e.juainny_avatar&&(g.juainny=typeof e.juainny_avatar=="string"?JSON.parse(e.juainny_avatar):e.juainny_avatar),e.erick_avatar&&(g.erick=typeof e.erick_avatar=="string"?JSON.parse(e.erick_avatar):e.erick_avatar);const n=localStorage.getItem("device_name"),r=document.getElementById("device-name");r&&(r.textContent=n||"User")}return e}function f(e,t=""){const a=g[e];if(!a)return`<div class="${t} rounded-full ${e==="juainny"?"bg-purple-500":"bg-blue-500"} flex items-center justify-center text-white font-bold">${e[0].toUpperCase()}</div>`;const{type:n,color1:r,color2:c,icon:l,imageUrl:o}=a;return n==="image"&&o?`
            <div class="${t} rounded-full relative overflow-hidden">
                <img src="${o}" class="w-full h-full object-cover">
            </div>
        `:`
        <div class="${t} rounded-full flex items-center justify-center relative overflow-hidden"
             style="background: linear-gradient(135deg, ${r}, ${c});">
            <img src="avatars/${l}" class="w-[60%] h-[60%] object-contain drop-shadow-sm">
        </div>
    `}document.addEventListener("DOMContentLoaded",async()=>{await L(),j(),B(),await k(p)});let b=[];function B(){const e=document.getElementById("edit-banner-btn"),t=document.getElementById("banner-modal"),a=document.getElementById("close-banner-modal"),n=document.getElementById("banner-search");e.addEventListener("click",async()=>{t.classList.remove("hidden"),await I()}),a.addEventListener("click",()=>{t.classList.add("hidden")}),t.addEventListener("click",r=>{r.target===t&&t.classList.add("hidden")}),n.addEventListener("input",r=>{$(r.target.value)})}async function I(){if(b.length===0){const{data:e,error:t}=await y.from("media").select("title, backdrop_path");if(t){console.error("Error fetching media for banners:",t);return}b=e.filter(a=>a.backdrop_path)}E(b)}function E(e){const t=document.getElementById("banner-grid");t.innerHTML="",e.forEach(a=>{const n=document.createElement("div");n.className="cursor-pointer rounded-lg overflow-hidden transition hover:scale-105",n.style.border="2px solid var(--color-border-primary)";const r=`https://image.tmdb.org/t/p/w500${a.backdrop_path}`;n.innerHTML=`
            <img src="${r}" class="w-full h-24 object-cover">
            <div class="p-2" style="background-color: var(--color-bg-tertiary);">
                <p class="text-sm font-semibold truncate" style="color: var(--color-text-primary);">${a.title}</p>
            </div>
        `,n.addEventListener("click",async()=>{await _(r)}),t.appendChild(n)})}function $(e){const t=b.filter(a=>a.title.toLowerCase().includes(e.toLowerCase()));E(t)}async function _(e){const t=`${p}_banner`,a={};a[t]=e;const{error:n}=await y.from("settings").update(a).eq("id",1);if(n){console.error("Error saving banner:",n),alert("Failed to save banner.");return}const r=document.getElementById("profile-banner"),c=document.getElementById("profile-banner-placeholder");r.src=e,r.classList.remove("hidden"),c.classList.add("hidden"),document.getElementById("banner-modal").classList.add("hidden")}function j(){const e=document.getElementById("view-juainny-btn"),t=document.getElementById("view-erick-btn");e.addEventListener("click",()=>w("juainny")),t.addEventListener("click",()=>w("erick"))}async function w(e){p!==e&&(p=e,await k(e))}async function k(e){const t=document.getElementById("view-juainny-btn"),a=document.getElementById("view-erick-btn");e==="juainny"?(t.classList.add("bg-accent-primary","text-white","border-transparent"),t.classList.remove("bg-bg-tertiary","text-text-primary","border-border-primary"),a.classList.remove("bg-accent-primary","text-white","border-transparent"),a.classList.add("bg-bg-tertiary","text-text-primary","border-border-primary")):(a.classList.add("bg-accent-primary","text-white","border-transparent"),a.classList.remove("bg-bg-tertiary","text-text-primary","border-border-primary"),t.classList.remove("bg-accent-primary","text-white","border-transparent"),t.classList.add("bg-bg-tertiary","text-text-primary","border-border-primary"));const n=document.getElementById("profile-name"),r=document.getElementById("profile-bio"),c=document.getElementById("profile-avatar-container"),l=document.getElementById("profile-banner"),o=document.getElementById("profile-banner-placeholder");n.textContent=e==="juainny"?"Juainny":"Erick";const{data:i}=await y.from("settings").select("*").eq("id",1).single();if(i){const u=e==="juainny"?i.juainny_bio:i.erick_bio;r.textContent=u||`No bio yet for ${e==="juainny"?"Juainny":"Erick"}.`;const m=e==="juainny"?i.juainny_banner:i.erick_banner;m?(l.src=m,l.classList.remove("hidden"),o.classList.add("hidden")):(l.classList.add("hidden"),o.classList.remove("hidden"))}const s=document.getElementById("user1-avatar-nav"),d=document.getElementById("user2-avatar-nav");s&&(s.innerHTML=f("juainny","w-full h-full")),d&&(d.innerHTML=f("erick","w-full h-full")),c.innerHTML=f(e,"w-full h-full"),C(e),await N(e)}function C(e){const t=document.getElementById("edit-bio-btn"),a=document.getElementById("bio-display-container"),n=document.getElementById("bio-edit-container"),r=document.getElementById("bio-input"),c=document.getElementById("cancel-bio-btn"),l=document.getElementById("save-bio-btn"),o=document.getElementById("profile-bio");a.classList.remove("hidden"),n.classList.add("hidden");const i=t.cloneNode(!0);t.parentNode.replaceChild(i,t);const s=l.cloneNode(!0);l.parentNode.replaceChild(s,l);const d=c.cloneNode(!0);c.parentNode.replaceChild(d,c),i.addEventListener("click",()=>{r.value=o.textContent.trim()===`No bio yet for ${e==="juainny"?"Juainny":"Erick"}.`?"":o.textContent.trim(),a.classList.add("hidden"),n.classList.remove("hidden"),r.focus()}),d.addEventListener("click",()=>{a.classList.remove("hidden"),n.classList.add("hidden")}),s.addEventListener("click",async()=>{const u=r.value.trim();o.textContent=u||`No bio yet for ${e==="juainny"?"Juainny":"Erick"}.`,a.classList.remove("hidden"),n.classList.add("hidden");const m={};m[`${e}_bio`]=u;const{error:h}=await y.from("settings").update(m).eq("id",1);h&&(console.error("Error saving bio:",h),alert("Failed to save bio. Please try again."))})}async function N(e){const t=document.getElementById("activity-feed");t.innerHTML='<div class="p-8 text-center text-text-muted"><i class="fas fa-spinner fa-spin text-2xl mb-2"></i><p>Loading activity...</p></div>';const{data:a,error:n}=await y.from("activity_log").select(`
            *,
            media:media_id (
                title, poster_path, backdrop_path, type
            )
        `).or(`user_id.eq.${e},user_id.eq.both`).order("created_at",{ascending:!1}).limit(20);if(n){console.error("Error fetching activity:",n),t.innerHTML='<div class="p-4 text-center text-danger">Failed to load activity.</div>';return}if(!a||a.length===0){t.innerHTML='<div class="p-8 text-center text-text-muted">No recent activity.</div>';return}t.innerHTML="",a.forEach(r=>{const c=M(r,e);t.appendChild(c)})}function M(e,t){const{action_type:a,details:n,created_at:r,media:c}=e,l=new Date(r).toLocaleDateString(void 0,{month:"short",day:"numeric"}),o=document.createElement("div");o.className="p-4 transition flex gap-4 items-start",o.style.borderBottom="1px solid var(--color-border-primary)",o.addEventListener("mouseenter",()=>{o.style.backgroundColor="var(--color-bg-tertiary)"}),o.addEventListener("mouseleave",()=>{o.style.backgroundColor=""});let i="fa-circle",s="var(--color-text-muted)",d="did something with";switch(a){case"watched":i="fa-check-circle",s="var(--color-success)",d="watched";break;case"want_to_watch":i="fa-bookmark",s="var(--color-accent-primary)",d="wants to watch";break;case"favorite":i="fa-star",s="#facc15",d="favorited";break;case"reaction":i="fa-face-smile",s="var(--color-accent-primary)",d="reacted to";break;case"note_added":i="fa-sticky-note",s="#f59e0b",d="added a note to";break;case"rate":i="fa-star-half-alt",s="#fb923c",d="rated";break}const u=c.poster_path?`https://image.tmdb.org/t/p/w92${c.poster_path}`:"https://placehold.co/92x138?text=No+Image",m=c.title||"Unknown Title";return o.innerHTML=`
        <div class="flex-shrink-0 mt-1">
            <i class="fas ${i} text-xl" style="color: ${s};"></i>
        </div>
        <div class="flex-grow">
            <div class="flex justify-between items-start">
                <p style="color: var(--color-text-primary);">
                    <span class="font-semibold">${t==="juainny"?"Juainny":"Erick"}</span>
                    <span style="color: var(--color-text-muted);">${d}</span>
                    <span class="font-semibold" style="color: var(--color-accent-primary);">${m}</span>
                </p>
                <span class="text-xs whitespace-nowrap ml-2" style="color: var(--color-text-muted);">${l}</span>
            </div>
            ${n&&n.reaction?`
                <div class="mt-2 p-2 rounded-lg inline-block" style="background-color: var(--color-bg-primary); border: 1px solid var(--color-border-primary);">
                    <img src="moods/${n.reaction}" class="w-8 h-8 object-contain" alt="Reaction">
                </div>
            `:""}
            ${n&&n.note?`
                <div class="mt-2 p-3 rounded-lg text-sm italic" style="background-color: var(--color-bg-primary); border: 1px solid var(--color-border-primary); color: var(--color-text-secondary);">
                    "${n.note}"
                </div>
            `:""}
             ${n&&n.rating?`
                <div class="mt-2 text-sm" style="color: var(--color-star-filled);">
                    ${"â˜…".repeat(Math.round(n.rating))} <span style="color: var(--color-text-muted);">(${n.rating}/5)</span>
                </div>
            `:""}
        </div>
        <div class="flex-shrink-0 w-12 h-18 rounded overflow-hidden shadow-sm ml-2">
            <img src="${u}" class="w-full h-full object-cover" alt="${m}">
        </div>
    `,o}
